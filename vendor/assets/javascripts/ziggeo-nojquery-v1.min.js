var Scoped=function(){function a(a){function b(a){return d.extend({route:null,parent:null,children:{},watchers:[],data:{},ready:!1,lazy:[]},a)}function c(a){if(!a.ready){if(a.parent&&!a.parent.ready)return c(a.parent),void 0;if(a.route in a.parent.data){a.data=a.parent.data[a.route],a.ready=!0;for(var b=0;b<a.watchers.length;++b)a.watchers[b].callback.call(a.watchers[b].context||this,a.data);a.watchers=[];for(var d in a.children)c(a.children[d])}}}function e(b){if(!b.ready){b.parent&&!b.parent.ready&&e(b.parent),b.ready=!0,a.tree&&"object"==typeof b.parent.data&&(b.parent.data[b.route]=b.data);for(var c=0;c<b.watchers.length;++c)b.watchers[c].callback.call(b.watchers[c].context||this,b.data);b.watchers=[]}}function f(a,b){if("object"==typeof b)for(var d in b)a.data[d]=b[d],a.children[d]&&(a.children[d].data=b[d]);else a.data=b;e(a);for(var f in a.children)c(a.children[f])}function g(a){if(a.ready&&a.data)for(var b in a.data)delete a.data[b]}function h(a){if(!a)return k;for(var d=a.split("."),e=k,f=0;f<d.length;++f)d[f]in e.children?e=e.children[d[f]]:(e.children[d[f]]=b({parent:e,route:d[f]}),e=e.children[d[f]],c(e));return e}function i(a,b,c){if(a.ready)b.call(c||this,a.data);else if(a.watchers.push({callback:b,context:c}),a.lazy.length>0){var d=function(a){if(a.lazy.length>0){var b=a.lazy.shift();b.callback.call(b.context||this,a.data),d(a)}};d(a)}}function j(a,b,c){a=a||k,c=c||[],a.ready||c.push(b);for(var d in a.children){var e=a.children[d],f=(b?b+".":"")+e.route;c=j(e,f,c)}return c}a=d.extend({tree:!1,global:!1,root:{}},a);var k=b({ready:!0}),l=null;if(a.tree){if(a.global){try{window&&(l=window)}catch(m){}try{global&&(l=global)}catch(m){}}else l=a.root;k.data=l}return{extend:function(a,b){f(h(a),b)},set:function(a,b){var c=h(a);c.data&&g(c),f(c,b)},lazy:function(a,b,c){var d=h(a);d.ready?b(c||this,d.data):d.lazy.push({callback:b,context:c})},digest:function(a){c(h(a))},obtain:function(a,b,c){i(h(a),b,c)},unresolvedWatchers:function(a){return j(h(a),a)}}}function b(e,f,g,h){var i=null,j=[],k=a({tree:!0}),l=a({tree:!1}),m={global:{namespace:h},root:{namespace:g},local:{namespace:k},"default":{namespace:l},parent:{namespace:f},scope:{namespace:k,readonly:!1}},n=function(a,b,c){var e=d.matchArgs(a,{options:"object",namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),f=d.extend({lazy:this.options.lazy},e.options||{}),g=this.resolve(e.namespaceLocator),h=function(){this.require(e.dependencies,e.hiddenDependencies,function(){if(arguments[arguments.length-1].ns=g,this.options.compile){for(var f=[],h=0;h<a.length;++h)f.push(d.stringify(a[h]));this.compiled+=this.options.ident+"."+b+"("+f.join(", ")+");\n\n"}var i=e.callback.apply(e.context||this,arguments);c.call(this,g,i)},this)};return f.lazy?g.namespace.lazy(g.path,h,this):h.apply(this),this};return{getGlobal:d.method(c,c.getPath),setGlobal:d.method(c,c.setPath),options:{lazy:!1,ident:"Scoped",compile:!1},compiled:"",nextScope:function(){return i||(i=b(this,k,g,h)),i},subScope:function(){var a=this.nextScope();return j.push(a),i=null,a},binding:function(b,c,e){if(!m[b]||!m[b].readonly){var f;f="string"!=d.typeOf(c)?{namespace:a({tree:!0,root:c}),path:null}:this.resolve(c),m[b]=d.extend(e,f)}return this},resolve:function(a){var b=a.split(":");if(1==b.length)return{namespace:l,path:b[0]};var c=m[b[0]];if(!c)throw"The namespace '"+b[0]+"' has not been defined (yet).";return{namespace:c.namespace,path:c.path&&b[1]?c.path+"."+b[1]:c.path||b[1]}},define:function(){return n.call(this,arguments,"define",function(a,b){a.namespace.set(a.path,b)})},extend:function(){return n.call(this,arguments,"extend",function(a,b){a.namespace.extend(a.path,b)})},condition:function(){return n.call(this,arguments,"condition",function(a,b){b&&a.namespace.set(a.path,b)})},require:function(){var a=d.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:"function",context:"object"});a.callback=a.callback||function(){};var b=a.dependencies||[],c=b.concat(a.hiddenDependencies||[]),e=c.length,f=[],g={};if(e)for(var h=function(b){this.i<f.length&&(f[this.i]=b),e--,0===e&&(f.push(g),a.callback.apply(a.context||this.ctx,f))},i=0;i<c.length;++i){var j=this.resolve(c[i]);i<b.length&&f.push(null),j.namespace.obtain(j.path,h,{ctx:this,i:i})}else f.push(g),a.callback.apply(a.context||this,f);return this},digest:function(a){var b=this.resolve(a);return b.namespace.digest(b.path),this},unresolved:function(a){var b=this.resolve(a);return b.namespace.unresolvedWatchers(b.path)}}}var c={get:function(a){return"undefined"!=typeof window?window[a]:"undefined"!=typeof global?global[a]:null},set:function(a,b){return"undefined"!=typeof window&&(window[a]=b),"undefined"!=typeof global&&(global[a]=b),b},setPath:function(a,b){var c=a.split(".");if(1==c.length)return this.set(a,b);for(var d=this.get(c[0])||this.set(c[0],{}),e=1;e<c.length-1;++e)c[e]in d||(d[c[e]]={}),d=d[c[e]];return d[c[c.length-1]]=b,b},getPath:function(a){var b=a.split(".");if(1==b.length)return this.get(a);for(var c=this.get(b[0]),d=1;d<b.length;++d){if(!c)return c;c=c[b[d]]}return c}},d={method:function(a,b){return function(){return b.apply(a,arguments)}},extend:function(a,b){a=a||{},b=b||{};for(var c in b)a[c]=b[c];return a},typeOf:function(a){return"[object Array]"===Object.prototype.toString.call(a)?"array":typeof a},isEmpty:function(a){if(null===a||"undefined"==typeof a)return!0;if("array"==this.typeOf(a))return 0===a.length;if("object"!=typeof a)return!1;for(var b in a)return!1;return!0},matchArgs:function(a,b){var c=0,d={};for(var e in b)b[e]===!0||this.typeOf(a[c])==b[e]?(d[e]=a[c],c++):"undefined"==this.typeOf(a[c])&&c++;return d},stringify:function(a){return"function"==this.typeOf(a)?""+a:JSON.stringify(a)}},e={__namespace:"Scoped",upgrade:function(a){var b=c.get(a||e.__namespace);if(b&&"object"==d.typeOf(b)&&b.guid==this.guid&&"string"==d.typeOf(b.version)){for(var f=this.version.split("."),g=b.version.split("."),h=!1,i=0;i<Math.min(f.length,g.length)&&(h=parseInt(f[i],10)>parseInt(g[i],10),f[i]==g[i]);++i);return h?this.attach(a):b}return this.attach(a)},attach:function(a){a&&(e.__namespace=a);var b=c.get(e.__namespace);return b==this?this:(e.__revert=b,c.set(e.__namespace,this),this)},detach:function(a){return a&&c.set(e.__namespace,null),"undefined"!=typeof e.__revert&&c.set(e.__namespace,e.__revert),delete e.__revert,this},exports:function(a,b,c){return a=a||("undefined"!=typeof module?module:null),"object"==typeof a&&a&&"exports"in a&&(c||a.exports==this||!a.exports||d.isEmpty(a.exports))&&(a.exports=b||this),this}},f=a({tree:!0,global:!0}),g=a({tree:!0}),h=b(null,g,g,f),i=d.extend(h,{guid:"4b6878ee-cb6a-46b3-94ac-27d91f58d666",version:"9.9436392609879",upgrade:e.upgrade,attach:e.attach,detach:e.detach,exports:e.exports});return i=i.upgrade(),i.exports(),i}.call(this);(function(){var a=this.subScope();a.binding("module","global:BetaJS"),a.define("module:",function(){return{guid:"71366f7a-7da3-4e55-9a0b-ea0e4e2a9e79",version:"407.1436393737004"}}),a.require(["module:"],function(a){this.exports("undefined"!=typeof module?module:null,a)},this),a.define("module:Async",["module:Types","module:Functions"],function(a,b){return{waitFor:function(){var a=b.matchArgs(arguments,{condition:!0,conditionCtx:"object",callback:!0,callbackCtx:"object",interval:"int"}),c=function(){try{return!!a.condition.apply(a.conditionCtx||a.callbackCtx||this)}catch(b){return!1}};if(c())a.callback.apply(a.callbackCtx||this);else var d=setInterval(function(){c()&&(clearInterval(d),a.callback.apply(a.callbackCtx||this))},a.interval||1)},eventually:function(){var a=b.matchArgs(arguments,{func:!0,params:"array",context:"object",time:"number"}),c=setTimeout(function(){clearTimeout(c),a.func.apply(a.context||this,a.params||[])},a.time||0)},eventuallyOnce:function(a,b,c){var d={func:a,params:b,context:c};for(var e in this.__eventuallyOnce){var f=this.__eventuallyOnce[e];if(f.func==a&&f.params==b&&f.context==c)return}this.__eventuallyOnceIdx++;var g=this.__eventuallyOnceIdx;this.__eventuallyOnce[g]=d,this.eventually(function(){delete this.__eventuallyOnce[g],a.apply(c||this,b||[])},this)},__eventuallyOnce:{},__eventuallyOnceIdx:1}}),a.define("module:Channels.Sender",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,{send:function(a,b){this.trigger("send",a,b),this._send(a,b)},_send:function(){}}])}),a.define("module:Channels.Receiver",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,{_receive:function(a,b){this.trigger("receive",a,b),this.trigger("receive:"+a,b)}}])}),a.define("module:Channels.ReceiverSender",["module:Channels.Sender"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__receiver=b},_send:function(a,b){this.__receiver._receive(a,b)}}})}),a.define("module:Channels.SenderMultiplexer",["module:Channels.Sender"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__sender=b,this.__prefix=c},_send:function(a,b){this.__sender.send(this.__prefix+":"+a,b)}}})}),a.define("module:Channels.ReceiverMultiplexer",["module:Channels.Receiver","module:Strings"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),this.__receiver=c,this.__prefix=d,this.__receiver.on("receive",function(a,c){b.starts_with(a,this.__prefix+":")&&this._receive(b.strip_start(a,this.__prefix+":"),c)},this)}}})}),a.define("module:Channels.TransportChannel",["module:Class","module:Objs","module:Timers.Timer","module:Time","module:Promise"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(d,e,f){a.constructor.call(this),this.__sender=d,this.__receiver=e,this.__options=b.extend(f,{timeout:1e4,tries:1,timer:500}),this.__receiver.on("receive:send",function(a){this.__reply(a)},this),this.__receiver.on("receive:reply",function(a){this.__complete(a)},this),this.__sent_id=0,this.__sent={},this.__received={},this.__timer=this._auto_destroy(new c({delay:this.__options.timer,context:this,fire:this.__maintenance}))},_reply:function(){},send:function(a,b,c){var f=e.create();return c=c||{},c.stateless?(this.__sender.send("send",{message:a,data:b,stateless:!0}),f.asyncSuccess(!0)):(this.__sent_id++,this.__sent[this.__sent_id]={message:a,data:b,tries:1,time:d.now(),id:this.__sent_id,promise:f},this.__sender.send("send",{message:a,data:b,id:this.__sent_id})),f},__reply:function(a){return a.stateless?(this._reply(a.message,a.data),void 0):(this.__received[a.id]?this.__received[a.id].returned&&this.__sender.send("reply",{id:a.id,reply:a.reply,success:a.success}):(this.__received[a.id]=a,this.__received[a.id].time=d.now(),this.__received[a.id].returned=!1,this.__received[a.id].success=!1,this._reply(a.message,a.data).success(function(b){this.__received[a.id].reply=b,this.__received[a.id].success=!0},this).error(function(b){this.__received[a.id].reply=b},this).callback(function(){this.__received[a.id].returned=!0,this.__sender.send("reply",{id:a.id,reply:a.reply,success:a.success})},this)),void 0)},__complete:function(a){if(this.__sent[a.id]){var b=this.__sent[a.id].promise;b[a.success?"asyncSuccess":"asyncError"](a.reply),delete this.__sent[a.id]}},__maintenance:function(){var a=d.now();for(var b in this.__received){var c=this.__received[b];c.time+this.__options.tries*this.__options.timeout<=a&&delete this.__received[b]}for(var e in this.__sent){var f=this.__sent[e];f.time+f.tries*this.__options.timeout<=a&&(f.tries<this.__options.tries?(f.tries++,this.__sender.send("send",{message:f.message,data:f.data,id:f.id})):(f.promise.asyncError({message:f.message,data:f.data}),delete this.__sent[e]))}}}})}),a.define("module:Class",["module:Types","module:Objs","module:Functions","module:Ids"],function(b,c,d,e){var f=function(){};return f.extend=function(d,e,f,g){e=e||[],b.is_array(e)||(e=[e]),f=f||[],b.is_array(f)||(f=[f]),g=g||[],b.is_array(g)||(g=[g]);var h=this;e=c.map(e,function(a){return b.is_function(a)&&(a=a(h.prototype)),a});var i;c.iter(e,function(a){a.hasOwnProperty("constructor")&&(i=a.constructor)});var j=b.is_defined(i);b.is_defined(i)||(i=function(){h.apply(this,arguments)}),c.extend(i,h),c.iter(f,function(a){a=b.is_function(a)?a(h):a;var d=i._extender;c.extend(i,a),a._extender&&(i._extender=c.extend(c.clone(d,1),a._extender))});var k={};if(h.__class_statics_keys)for(var l in h.__class_statics_keys)i[l]=c.clone(h[l],1);c.iter(g,function(a){c.extend(i,a),c.extend(k,c.keys(a,!0))}),h.__class_statics_keys&&c.extend(k,h.__class_statics_keys),i.__class_statics_keys=k,i.parent=h,i.children=[],i.extend=this.extend,h.children||(h.children=[]),h.children.push(i);var m=function(){};m.prototype=h.prototype,i.prototype=new m,i.prototype.cls=i,d=c.extend({},b.is_string(d)?{classname:d,register:!0}:d);var n=d.classname;return d.scoped&&(n=d.scoped.ns.path),i.classname=n,n&&d.register&&a.setGlobal(n,i),i.__notifications={},h.__notifications&&c.extend(i.__notifications,h.__notifications,1),c.iter(e,function(a){for(var b in a)i.prototype[b]=i._extender&&b in i._extender?i._extender[b](i.prototype[b],a[b]):a[b];if("constructor"in a&&(i.prototype.constructor=a.constructor),a._notifications)for(var c in a._notifications)i.__notifications[c]||(i.__notifications[c]=[]),i.__notifications[c].push(a._notifications[c])}),delete i.prototype._notifications,j||(i.prototype.constructor=h.prototype.constructor),i},c.extend(f,{classname:"Class",__class_guid:"0f5499f9-f0d1-4c6c-a561-ef026a1eee05",__notifications:{},ancestor_of:function(a){return this==a||this!=f&&this.parent.ancestor_of(a)},is_class:function(a){return a&&b.is_object(a)&&"__class_guid"in a&&a.__class_guid==this.__class_guid},is_class_instance:function(a){return a&&b.is_object(a)&&"__class_instance_guid"in a&&a.__class_instance_guid==this.prototype.__class_instance_guid},is_instance_of:function(a){return a&&this.is_class_instance(a)&&a.instance_of(this)},define:function(c,e){var f=d.getArguments(arguments,2);return b.is_object(c)?a.define(e,[],function(a){return f.unshift({scoped:a}),c.extend.apply(c,f)}):a.define(e,[c],function(a,b){return f.unshift({scoped:b}),a.extend.apply(a,f)})},_inherited:function(a,b){return a.parent[b].apply(this,Array.prototype.slice.apply(arguments,[2]))}}),f.prototype.__class_instance_guid="e6b0ed30-80ee-4b28-af02-7d52430ba45f",f.prototype.constructor=function(){this._notify("construct")},f.prototype.destroy=function(){if(this._notify("destroy"),this.__auto_destroy_list)for(var a=0;a<this.__auto_destroy_list.length;++a)"destroy"in this.__auto_destroy_list[a]&&this.__auto_destroy_list[a].destroy();var b=this.cid();for(var c in this)delete this[c];e.objectId(this,b),this.destroy=this.__destroyedDestroy},f.prototype.destroyed=function(){return this.destroy===this.__destroyedDestroy},f.prototype.weakDestroy=function(){this.destroyed()||this.destroy()},f.prototype.__destroyedDestroy=function(){throw"Trying to destroy destroyed object "+this.cid()+": "+this.cls.classname+"."},f.prototype.cid=function(){return e.objectId(this)},f.prototype.cls=f,f.prototype.as_method=function(a){return d.as_method(this[a],this)},f.prototype.auto_destroy=function(a){this.__auto_destroy_list||(this.__auto_destroy_list=[]);var c=a;b.is_array(c)||(c=[c]);for(var d=0;d<c.length;++d)this.__auto_destroy_list.push(c[d]);return a},f.prototype._notify=function(a){if(this.cls.__notifications){var d=Array.prototype.slice.call(arguments,1);c.iter(this.cls.__notifications[a],function(c){var e=b.is_function(c)?c:this[c];if(!e)throw this.cls.classname+": Could not find "+a+" notification handler "+c;e.apply(this,d)},this)}},f.prototype.instance_of=function(a){return this.cls.ancestor_of(a)},f.prototype._auto_destroy=function(a){return this.auto_destroy(a)},f.prototype._inherited=function(a,b){return a.parent.prototype[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},f}),a.define("module:Classes.InvokerMixin",["module:Objs","module:Types","module:Functions"],function(a,b,c){return{invoke_delegate:function(d,e){b.is_array(e)||(e=[e]),d=this[d];var f=this;a.iter(e,function(a){this[a]=function(a){return function(){var b=c.getArguments(arguments);return b.unshift(a),d.apply(f,b)}}.call(f,a)},this)}}}),a.define("module:Classes.ModuleMixin",["module:Objs"],function(a){return{_notifications:{construct:function(){this.__modules={}},destroy:function(){a.iter(this.__modules,this.remove_module,this)}},add_module:function(a){a.cid()in this.__modules||(this.__modules[a.cid()]=a,a.register(this),this._notify("add_module",a))},remove_module:function(a){a.cid()in this.__modules&&(delete this.__modules[a.cid()],a.unregister(this),this._notify("remove_module",a))}}}),a.define("module:Classes.Module",["module:Class","module:Objs","module:Ids","module:Types"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(b){a.constructor.call(this),this._objects={},this.__auto_destroy="auto_destroy"in b?b.auto_destroy:!0},destroy:function(){b.iter(this._objects,this.unregister,this),a.destroy.call(this)},register:function(a){var b=c.objectId(a);if(!(b in this._objects)){var d={};this._objects[b]={object:a,data:d},a.add_module(this),this._register(a,d)}},_register:function(){},unregister:function(a){var b=c.objectId(a);if(b in this._objects){var e=this._objects[b].data;this._unregister(a,e),delete this._objects[b],a.remove_module(this),"off"in a&&a.off(null,null,this),this.__auto_destroy&&d.is_empty(this._objects)&&this.destroy()}},_unregister:function(){},_data:function(a){return this._objects[c.objectId(a)].data}}},{__instance:null,singleton:function(){return this.__instance||(this.__instance=new this({auto_destroy:!1})),this.__instance}})}),a.define("module:Classes.HelperClassMixin",["module:Objs","module:Types","module:Functions","module:Promise"],function(a,b,c,d){return{addHelper:function(a,b){var c=new a(this,b);return this.__helpers=this.__helpers||[],this.__helpers.push(this._auto_destroy(c)),c},_helper:function(e){this.__helpers=this.__helpers||[],b.is_string(e)&&(e={method:e}),e=a.extend({fold_start:null,fold:function(a,b){return a||b}},e);for(var f=c.getArguments(arguments,1),g=e.async?d.create(e.fold_start):e.fold_start,h=0;h<this.__helpers.length;++h){var i=this.__helpers[h];e.method in i&&(g=e.async?d.func(e.fold,g,d.methodArgs(i,i[e.method],f)):e.fold(g,i[e.method].apply(i,f)))}return g}}}),a.define("module:Classes.PathResolver",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this._bindings=b||{}},extend:function(a,c){if(c)for(var d in a){for(var e=a[d],f=/\{([^}]+)\}/;;){var g=f.exec(e);if(!g)break;e=e.replace(f,c+"."+g[1])}this._bindings[c+"."+d]=e}else this._bindings=b.extend(this._bindings,a)},map:function(a){for(var b=[],c=0;c<a.length;++c)a[c]&&b.push(this.resolve(a[c]));return b},resolve:function(a){for(var b=/\{([^}]+)\}/;;){var c=b.exec(a);if(!c)break;a=a.replace(b,this._bindings[c[1]])}return this.simplify(a)},simplify:function(a){return a.replace(/[^\/]+\/\.\.\//,"").replace(/\/[^\/]+\/\.\./,"")}}})}),a.define("module:Classes.MultiDelegatable",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),b.iter(d,function(a){this[a]=function(){var d=arguments;return b.iter(c,function(b){b[a].apply(b,d)},this),this}},this)}}})}),a.define("module:Classes.ClassRegistry",["module:Class","module:Types","module:Functions"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){a.constructor.call(this),this._classes=b||{},this._lowercase=c},_sanitize:function(a){return this._lowercase?a.toLowerCase():a},register:function(a,b){this._classes[this._sanitize(a)]=b},get:function(a){return b.is_object(a)?a:this._classes[this._sanitize(a)]},create:function(a){var b=c.newClassFunc(this.get(a));return b.apply(this,c.getArguments(arguments,1))},classes:function(){return this._classes}}})}),a.define("module:Classes.ObjectIdScopeMixin",function(){return{__objects:{},get:function(a){return this.__objects[a]}}}),a.define("module:Classes.ObjectIdScope",["module:Class","module:Classes.ObjectIdScopeMixin"],function(a,b,c){return a.extend({scoped:c},b,{singleton:function(){return this.__singleton||(this.__singleton=new this),this.__singleton}})}),a.define("module:Classes.ObjectIdMixin",["module:Classes.ObjectIdScope","module:Objs","module:Ids"],function(a,b,c){return{_notifications:{construct:"__register_object_id",destroy:"__unregister_object_id"},__object_id_scope:function(){return this.object_id_scope?this.object_id_scope:a.singleton()},__register_object_id:function(){var a=this.__object_id_scope();a.__objects[c.objectId(this)]=this},__unregister_object_id:function(){var a=this.__object_id_scope();delete a.__objects[c.objectId(this)]}}}),a.define("module:Classes.ContextRegistry",["module:Class","module:Ids","module:Types","module:Iterators.MappedIterator","module:Iterators.ObjectValuesIterator"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(b,c){a.constructor.apply(this),this.__data={},this.__contexts={},this.__serializer=b||this.__defaultSerializer,this.__serializerContext=c||this},__defaultSerializer:function(a){return c.is_object(a)?b.objectId(a):a},_serializeContext:function(a){return a?b.objectId(a):null},_serializeData:function(a){return this.__serializer.call(this.__serializerContext,a)},get:function(a){var b=this._serializeData(a);return this.__data[b]},register:function(a,b){var c=this._serializeData(a),d=this._serializeContext(b),e=!1;return c in this.__data||(this.__data[c]={data:a,contexts:{}},e=!0),this.__data[c].contexts[d]=!0,e?this.__data[c]:null},unregister:function(a,b){var d=this.__serializer.call(this.__serializerContext,a);if(!this.__data[d])return null;if(b){var e=this._serializeContext(b);delete this.__data[d].contexts[e]}if(!b||c.is_empty(this.__data[d].contexts)){var f=this.__data[d];return f}return null},customIterator:function(){return new e(this.__data)},iterator:function(){return new d(this.customIterator(),function(a){return a.data})}}})}),a.define("module:Classes.ConditionalInstance",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this._options=this.cls._initializeOptions(b)}}},{_initializeOptions:function(a){return a},supported:function(){return!1}},{__registry:[],register:function(a,b){this.__registry.push({cls:a,priority:b})},match:function(a){a=this._initializeOptions(a);var c=null;return b.iter(this.__registry,function(b){(!c||c.priority<b.priority)&&b.cls.supported(a)&&(c=b)},this),c},create:function(a){var b=this.match(a);return b?new b.cls(a):null},anySupport:function(a){return null!==this.match(a)}})}),a.define("module:Collections.Collection",["module:Class","module:Events.EventsMixin","module:Objs","module:Functions","module:Lists.ArrayList","module:Ids","module:Properties.Properties","module:Iterators.ArrayIterator"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},[b,function(b){return{constructor:function(a){b.constructor.call(this),a=a||{},this.__indices={},a.indices&&c.iter(a.indices,this.add_secondary_index,this);var f={};"compare"in a&&(f.compare=a.compare),f.get_ident=d.as_method(this.get_ident,this),this.__data=new e([],f);var g=this;this.__data._ident_changed=function(a,b){g._index_changed(a,b)},this.__data._re_indexed=function(a){g._re_indexed(a)},this.__data._sorted=function(){g._sorted()},"objects"in a&&this.add_objects(a.objects)},add_secondary_index:function(a){this.__indices[a]={},this.iterate(function(b){this.__indices[a][b.get(a)]=b},this)},get_by_secondary_index:function(a,b){return this.__indices[a][b]},get_ident:function(a){return f.objectId(a)},set_compare:function(a){this.__data.set_compare(a)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(a){"off"in a&&a.off(null,null,this)},this),this.__data.destroy(),this.trigger("destroy"),b.destroy.call(this)},count:function(){return this.__data.count()},_index_changed:function(a,b){this.trigger("index",a,b)},_re_indexed:function(a){this.trigger("reindexed",a)},_sorted:function(){this.trigger("sorted")},_object_changed:function(a,b,c){this.trigger("update"),this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__data.re_index(this.getIndex(a))},add:function(b){if(a.is_class_instance(b)||(b=new g(b)),this.exists(b))return null;var d=this.__data.add(b);return null!==d&&(c.iter(this.__indices,function(a,c){a[b.get(c)]=b},this),this.trigger("add",b),this.trigger("update"),"on"in b&&b.on("change",function(a,c,d){this._object_changed(b,a,c,d)},this)),d},replace_objects:function(b){var d={};c.iter(b,function(b){var c=a.is_class_instance(b),e=c?b:new g(b);if(d[this.get_ident(e)]=!0,this.exists(e)){var f=this.getById(this.get_ident(e));c?(this.remove(f),this.add(e)):f.setAll(b)}else this.add(e)},this);for(var e=this.iterator();e.hasNext();){var f=e.next(),h=this.get_ident(f);h in d||this.remove(f)}e.destroy()},add_objects:function(a){var b=0;return c.iter(a,function(a){this.add(a)&&b++},this),b},exists:function(a){return this.__data.exists(a)},remove:function(a){if(!this.exists(a))return null;c.iter(this.__indices,function(b,c){delete b[a.get(c)]},this),this.trigger("remove",a),this.trigger("update");var b=this.__data.remove(a);return"off"in a&&a.off(null,null,this),b},getByIndex:function(a){return this.__data.get(a)},getById:function(a){return this.__data.get(this.__data.ident_by_id(a))},getIndex:function(a){return this.__data.get_ident(a)},iterate:function(a,b){this.__data.iterate(a,b)},iterator:function(){return h.byIterate(this.iterate,this)},clear:function(){this.iterate(function(a){this.remove(a)},this)}}}])}),a.define("module:Collections.FilteredCollection",["module:Collections.Collection"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){this.__parent=b,c=c||{},delete c.objects,c.compare=c.compare||b.get_compare(),a.constructor.call(this,c),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.__selfRemove,this),this.setFilter(c.filter,c.context)},filter:function(a){return!this.__filter||this.__filter.call(this.__filterContext||this,a)},setFilter:function(a,b){this.__filterContext=b,this.__filter=a,this.iterate(function(a){this.filter(a)||this.__selfRemove(a)},this),this.__parent.iterate(function(a){return!this.exists(a)&&this.filter(a)&&this.__selfAdd(a),!0},this)},_object_changed:function(b,c,d){a._object_changed.call(this,b,c,d),this.filter(b)||this.__selfRemove(b)},destroy:function(){this.__parent.off(null,null,this),a.destroy.call(this)},__selfAdd:function(b){return a.add.call(this,b)},add:function(a){if(this.exists(a)||!this.filter(a))return null;var b=this.__selfAdd(a);return this.__parent.add(a),b},__selfRemove:function(b){return a.remove.call(this,b)},remove:function(a){if(!this.exists(a))return null;var b=this.__selfRemove(a);return b?this.__parent.remove(a):null}}})}),a.define("module:Collections.MappedCollection",["module:Collections.Collection","module:Functions"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){this.__parent=c,this.__parentToThis={},this.__thisToParent={},d=d||{},delete d.objects,d.compare=b.as_method(this.__compareByParent,this),a.constructor.call(this,d),this._mapFunction=d.map,this._mapCtx=d.context,c.on("add",this.__parentAdd,this),c.on("remove",this.__parentRemove,this),c.on("change",this.__parentUpdate,this),c.iterate(this.__parentAdd,this)},destroy:function(){this.__parent.off(null,null,this),a.destroy.call(this)},__compareByParent:function(a,b){return this.__parent.getIndex(this.__thisToParent[a.cid()])-this.__parent.getIndex(this.__thisToParent[b.cid()])},__mapItem:function(a,b){return this._mapFunction.call(this._mapCtx||this,a,b)},__parentAdd:function(a){var b=this.__mapItem(a);this.__parentToThis[a.cid()]=b,this.__thisToParent[b.cid()]=a,this.add(b)},__parentUpdate:function(a){this.__mapItem(a,this.__parentToThis[a.cid()])},__parentRemove:function(a){var b=this.__parentToThis[a.cid()];delete this.__parentToThis[a.cid()],delete this.__thisToParent[b.cid()],this.remove(b)}}})}),a.define("module:Collections.ConcatCollection",["module:Collections.Collection","module:Objs","module:Functions"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d,e){this.__parents={},this.__itemToParent={},e=e||{},delete e.objects,e.compare=c.as_method(this.__compareByParent,this),a.constructor.call(this,e);var f=0;b.iter(d,function(a){this.__parents[a.cid()]={idx:f,parent:a},a.iterate(function(b){this.__parentAdd(a,b)},this),a.on("add",function(b){this.__parentAdd(a,b)},this),a.on("remove",function(b){this.__parentRemove(a,b)},this),f++},this)},destroy:function(){b.iter(this.__parents,function(a){a.parent.off(null,null,this)},this),a.destroy.call(this)},__parentAdd:function(a,b){this.__itemToParent[b.cid()]=a,this.add(b)},__parentRemove:function(a,b){delete this.__itemToParent[b.cid()],this.remove(b)},__compareByParent:function(a,b){var c=this.__itemToParent[a.cid()],d=this.__itemToParent[b.cid()];return c===d?c.getIndex(a)-d.getIndex(b):this.__parents[c.cid()].idx-this.__parents[d.cid()].idx}}})}),a.define("module:Comparators",["module:Types","module:Properties.Properties"],function(a,b){return{byObject:function(a){var c=this;return function(d,e){for(var f in a){var g=0;if(g=b.is_class_instance(d)&&b.is_class_instance(e)?c.byValue(d.get(f)||null,e.get(f)||null):c.byValue(d[f]||null,e[f]||null),0!==g)return g*a[f]}return 0}},byValue:function(b,c){return a.is_string(b)?b.localeCompare(c):c>b?-1:b>c?1:0},deepEqual:function(b,c,d){if(0===d)return!0;if(1===d)return b===c;if(a.is_array(b)&&a.is_array(c)){if(b.length!==c.length)return!1;for(var e=0;e<b.length;++e)if(!this.deepEqual(b[e],c[e],d-1))return!1;return!0}if(a.is_object(b)&&a.is_object(c)){for(var f in b)if(!this.deepEqual(b[f],c[f],d-1))return!1;for(f in c)if(!(f in b))return!1;return!0}return b===c},listEqual:function(a,b){return this.deepEqual(a,b,2)}}}),a.define("module:Events.EventsMixin",["module:Timers.Timer","module:Async","module:Lists.LinkedList","module:Functions","module:Types","module:Objs"],function(a,b,c,d,e,f){return{EVENT_SPLITTER:/\s+/,__create_event_object:function(b,c,d){d=d||{};var e={callback:b,context:c};return d.eventually&&(e.eventually=d.eventually),d.min_delay&&(e.min_delay=new a({delay:d.min_delay,once:!0,start:!1,context:this,fire:function(){e.max_delay&&e.max_delay.stop(),e.callback.apply(e.context||this,e.params)}})),d.max_delay&&(e.max_delay=new a({delay:d.max_delay,once:!0,start:!1,context:this,fire:function(){e.min_delay&&e.min_delay.stop(),e.callback.apply(e.context||this,e.params)}})),e},__destroy_event_object:function(a){a.min_delay&&a.min_delay.destroy(),a.max_delay&&a.max_delay.destroy()},__call_event_object:function(a,c){a.min_delay&&a.min_delay.restart(),a.max_delay&&a.max_delay.start(),a.min_delay||a.max_delay?a.params=c:a.eventually?b.eventually(a.callback,c,a.context||this):a.callback.apply(a.context||this,c)},on:function(a,b,d,e){this.__events_mixin_events=this.__events_mixin_events||{},a=a.split(this.EVENT_SPLITTER);for(var f;;){if(f=a.shift(),!f)break;this.__events_mixin_events[f]||this._notify("register_event",f),this.__events_mixin_events[f]=this.__events_mixin_events[f]||new c,this.__events_mixin_events[f].add(this.__create_event_object(b,d,e))}return this},off:function(a,b,c){return this.__events_mixin_events=this.__events_mixin_events||{},a?(a=a.split(this.EVENT_SPLITTER),f.iter(a,function(a){this.__events_mixin_events[a]&&(this.__events_mixin_events[a].remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0===this.__events_mixin_events[a].count()&&(this.__events_mixin_events[a].destroy(),delete this.__events_mixin_events[a],this._notify("unregister_event",a)))
},this)):f.iter(this.__events_mixin_events,function(a,d){a.remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0===a.count()&&(a.destroy(),delete this.__events_mixin_events[d],this._notify("unregister_event",d))},this),this},triggerAsync:function(){var a=this,b=d.getArguments(arguments),c=setTimeout(function(){clearTimeout(c),a.trigger.apply(a,b)},0)},trigger:function(a){var b=this;a=a.split(this.EVENT_SPLITTER);var c=d.getArguments(arguments,1);return this.__events_mixin_events?(f.iter(a,function(a){this.__events_mixin_events[a]&&this.__events_mixin_events[a].iterate(function(a){b.__call_event_object(a,c)}),this.__events_mixin_events&&"all"in this.__events_mixin_events&&this.__events_mixin_events.all.iterate(function(d){b.__call_event_object(d,[a].concat(c))})},this),this):this},once:function(a,b,c,e){var f=this,g=d.once(function(){f.off(a,g),b.apply(this,arguments)});return g._callback=b,this.on(a,g,c,e)},delegateEvents:function(a,b,c,g){g=g||[],c=c?c+":":"",null===a?b.on("all",function(a){var b=d.getArguments(arguments,1);this.trigger.apply(this,[c+a].concat(g).concat(b))},this):(e.is_array(a)||(a=[a]),f.iter(a,function(a){b.on(a,function(){var b=d.getArguments(arguments);this.trigger.apply(this,[c+a].concat(g).concat(b))},this)},this))}}}),a.define("module:Events.Events",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},b)}),a.define("module:Events.ListenMixin",["module:Ids","module:Objs"],function(a,b){return{_notifications:{destroy:"listenOff"},listenOn:function(b,c,d,e){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[a.objectId(b)]=b,b.on(c,d,this,e)},listenOnce:function(b,c,d,e){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[a.objectId(b)]=b,b.once(c,d,this,e)},listenOff:function(c,d,e){this.__listen_mixin_listen&&(c?(c.off(d,e,this),d||e||delete this.__listen_mixin_listen[a.objectId(c)]):b.iter(this.__listen_mixin_listen,function(b){b&&"off"in b&&b.off(d,e,this),d||e||delete this.__listen_mixin_listen[a.objectId(b)]},this))}}}),a.define("module:Events.Listen",["module:Class","module:Events.ListenMixin"],function(a,b,c){return a.extend({scoped:c},b)}),a.define("module:Exceptions.Exception",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__message=b},assert:function(a){if(!this.instance_of(a))throw this;return this},message:function(){return this.__message},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()},json:function(){return{classname:this.cls.classname,message:this.message()}}}})}),a.define("module:Exceptions.NativeException",["module:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this,b?"toString"in b?b.toString():b:"null"),this.__object=b},object:function(){return this.__object}}})}),a.extend("module:Exceptions",["module:Types","module:Exceptions.Exception","module:Exceptions.NativeException"],function(a,b,c){return{ensure:function(a){return b.is_instance_of(a)?a:new c(a)}}}),a.extend("module:Exceptions.Exception",["module:Exceptions"],["module:Exceptions.ensure"],function(a){return{ensure:function(b){return a.ensure(b).assert(this)}}}),a.define("module:Functions",["module:Types"],function(a){return{as_method:function(a,b){return function(){return a.apply(b,arguments)}},once:function(a){var b=!1,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},getArguments:function(a,b){return Array.prototype.slice.call(a,b||0)},matchArgs:function(b,c,d){arguments.length<3&&(d=c,c=0);var e=c,f={};for(var g in d){var h=d[g];h===!0?h={required:!0}:"string"==typeof h&&(h={type:h}),h.required||h.type&&a.type_of(b[e])==h.type?(f[g]=b[e],e++):h.def&&(f[g]=a.is_function(h.def)?h.def(f):h.def)}return f},newClassFunc:function(a){return function(){function b(){return a.apply(this,c)}var c=arguments;return b.prototype=a.prototype,new b}},newClass:function(a){return this.newClassFunc(a).apply(this,this.getArguments(arguments,1))}}}),a.define("module:Ids",function(){return{__uniqueId:0,uniqueId:function(a){return(a||"")+this.__uniqueId++},objectId:function(a,b){return"undefined"!=typeof b?a.__cid=b:a.__cid||(a.__cid=this.uniqueId("cid_")),a.__cid}}}),a.define("module:IdGenerators.IdGenerator",["module:Class"],function(a,b){return a.extend({scoped:b},{generate:function(){}})}),a.define("module:IdGenerators.PrefixedIdGenerator",["module:IdGenerators.IdGenerator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__prefix=b,this.__generator=c},generate:function(){return this.__prefix+this.__generator.generate()}}})}),a.define("module:Ids.RandomIdGenerator",["module:IdGenerators.IdGenerator","module:Tokens"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this.__length=b||16},generate:function(){return b.generate_token(this.__length)}}})}),a.define("module:IdGenerators.ConsecutiveIdGenerator",["module:IdGenerators.IdGenerator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__current=b||0},generate:function(){return this.__current++,this.__current}}})}),a.define("module:IdGenerators.TimedIdGenerator",["module:IdGenerators.IdGenerator","module:Time"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(){a.constructor.call(this),this.__current=b.now()-1},generate:function(){var a=b.now();return this.__current=a>this.__current?a:this.__current+1,this.__current}}})}),a.extend("module:Iterators",["module:Types","module:Iterators.Iterator","module:Iterators.ArrayIterator"],function(a,b,c){return{ensure:function(d){return null===d?new c([]):d.instance_of(b)?d:a.is_array(d)?new c(d):new c([d])}}}),a.define("module:Iterators.Iterator",["module:Class","module:Functions"],function(a,b,c){return a.extend({scoped:c},{asArray:function(){for(var a=[];this.hasNext();)a.push(this.next());return a},asArrayDelegate:function(a){for(var c=[];this.hasNext();){var d=this.next();c.push(d[a].apply(d,b.getArguments(arguments,1)))}return c},iterate:function(a,b){for(;this.hasNext();)a.call(b||this,this.next())}})}),a.define("module:Iterators.ArrayIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__array=b,this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var a=this.__array[this.__i];return this.__i++,a}}},{byIterate:function(a,b){var c=[];return a.call(b||this,function(a){c.push(a)},this),new this(c)}})}),a.define("module:Iterators.ObjectKeysIterator",["module:Iterators.ArrayIterator","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,b.keys(c))}}})}),a.define("module:Iterators.ObjectValuesIterator",["module:Iterators.ArrayIterator","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,b.values(c))}}})}),a.define("module:Iterators.MappedIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__iterator=b,this.__map=c,this.__context=d||this},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map.call(this.__context,this.__iterator.next()):null}}})}),a.define("module:Iterators.FilteredIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__iterator=b,this.__filter=c,this.__context=d||this,this.__next=null},hasNext:function(){return this.__crawl(),null!==this.__next},next:function(){this.__crawl();var a=this.__next;return this.__next=null,a},__crawl:function(){for(;!this.__next&&this.__iterator.hasNext();){var a=this.__iterator.next();this.__filter_func(a)&&(this.__next=a)}},__filter_func:function(a){return this.__filter.apply(this.__context,[a])}}})}),a.define("module:Iterators.SkipIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){for(a.constructor.call(this),this.__iterator=b;c>0;)b.next(),c--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}})}),a.define("module:Iterators.LimitIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__iterator=b,this.__limit=c},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}})}),a.define("module:Iterators.SortedIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__array=b.asArray(),this.__array.sort(c),this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var a=this.__array[this.__i];return this.__i++,a}}})}),a.define("module:Iterators.LazyIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(){a.constructor.call(this),this.__finished=!1,this.__initialized=!1,this.__current=null,this.__has_current=!1},_initialize:function(){},_next:function(){},_finished:function(){this.__finished=!0},_current:function(a){this.__current=a,this.__has_current=!0},__touch:function(){this.__initialized||this._initialize(),this.__initialized=!0,this.__has_current||this.__finished||this._next()},hasNext:function(){return this.__touch(),this.__has_current},next:function(){return this.__touch(),this.__has_current=!1,this.__current}}})}),a.define("module:Iterators.SortedOrIterator",["module:Iterators.LazyIterator","module:Structures.TreeMap","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(c,d){this.__iterators=c,this.__map=b.empty(d),a.constructor.call(this)},__process:function(a){if(a.hasNext()){var c=a.next(),d=b.find(c,this.__map);d?d.push(a):this.__map=b.add(c,[a],this.__map)}},_initialize:function(){c.iter(this.__iterators,this.__process,this),b.is_empty(this.__map)&&this._finished()},_next:function(){var a=b.take_min(this.__map);this._current(a[0].key),this.__map=a[1],c.iter(a[0].value,this.__process,this),b.is_empty(this.__map)&&this._finished()}}})}),a.define("module:Iterators.PartiallySortedIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__compare=c,this.__partial_same=d,this.__iterator=b,this.__head=[],this.__tail=[]},__cache:function(){if(!(this.__head.length>0)&&this.__iterator.hasNext()){for(this.__head=this.__tail,this.__tail=[],0===this.__head.length&&this.__head.push(this.__iterator.next());this.__iterator.hasNext();){var a=this.__iterator.next();if(!this.__partial_same(this.__head[0],a)){this.__tail.push(a);break}}this.__head.sort(this.__compare)}},hasNext:function(){return this.__cache(),this.__head.length>0},next:function(){return this.__cache(),this.__head.shift()}}})}),a.define("module:Iterators.LazyMultiArrayIterator",["module:Iterators.LazyIterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__next_callback=b,this.__next_context=c,this.__array=null,this.__i=0},_next:function(){if((null===this.__array||this.__i>=this.__array.length)&&(this.__array=this.__next_callback.apply(this.__next_context),this.__i=0),null!==this.__array){var a=this.__array[this.__i];return this.__i++,a}this._finished()}}})}),a.define("module:JavaScript",["module:Objs"],function(a){return{STRING_SINGLE_QUOTATION_REGEX:/'[^']*'/g,STRING_DOUBLE_QUOTATION_REGEX:/"[^"]*"/g,IDENTIFIER_REGEX:/[a-zA-Z_][a-zA-Z_0-9]*/g,IDENTIFIER_SCOPE_REGEX:/[a-zA-Z_][a-zA-Z_0-9\.]*/g,RESERVED:a.objectify(["if","then","else","return","var"],!0),isReserved:function(a){return a in this.RESERVED},isIdentifier:function(a){return!this.isReserved(a)},removeStrings:function(a){return a.replace(this.STRING_SINGLE_QUOTATION_REGEX,"").replace(this.STRING_DOUBLE_QUOTATION_REGEX,"")},extractIdentifiers:function(b,c){var d=c?this.IDENTIFIER_SCOPE_REGEX:this.IDENTIFIER_REGEX;return b=this.removeStrings(b),a.filter(b.match(d),this.isIdentifier,this)}}}),a.define("module:KeyValue.KeyValueStore",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,{mem:function(a){return this._mem(a)},get:function(a){return this._get(a)},set:function(a,b){this._set(a,b),this.trigger("change:"+a,b)},remove:function(a){this._remove(a)}}])}),a.define("module:KeyValue.PrefixKeyValueStore",["module:KeyValue.KeyValueStore"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__kv=b,this.__prefix=c},_mem:function(a){return this.__kv.mem(this.__prefix+a)},_get:function(a){return this.__kv.get(this.__prefix+a)},_set:function(a,b){this.__kv.set(this.__prefix+a,b)},_remove:function(a){this.__kv.remove(this.__prefix+a)}}})}),a.define("module:KeyValue.MemoryKeyValueStore",["module:KeyValue.KeyValueStore","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),this.__data=b.clone(c,d?1:0)},_mem:function(a){return a in this.__data},_get:function(a){return this.__data[a]},_set:function(a,b){this.__data[a]=b},_remove:function(a){delete this.__data[a]}}})}),a.define("module:KeyValue.DefaultKeyValueStore",["module:KeyValue.KeyValueStore"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__kv=b,this.__def=c},_mem:function(a){return this.__kv.mem(a)||this.__def.mem(a)},_get:function(a){return this.__kv.mem(a)?this.__kv.get(a):this.__def.get(a)},_set:function(a,b){this.__kv.set(a,b)},_remove:function(a){this.__kv.remove(a)}}})}),a.define("module:Lists.AbstractList",["module:Class","module:Objs","module:Types","module:Iterators.ArrayIterator"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(a){var b=null;return this._iterate(function(c,d){return c==a?(b=d,!1):!0}),b},exists:function(a){return a&&null!==this.get_ident(a)},_ident_changed:function(){},constructor:function(c){a.constructor.call(this),this.__count=0,c&&b.iter(c,function(a){this.add(a)},this)},add:function(a){var b=this._add(a);return c.is_defined(b)&&this.__count++,b},count:function(){return this.__count},clear:function(){this._iterate(function(a,b){return this.remove_by_ident(b),!0},this)},remove_by_ident:function(a){var b=this._remove(a);return c.is_defined(b)&&this.__count--,b},remove:function(a){return this.remove_by_ident(this.get_ident(a))},remove_by_filter:function(a){this._iterate(function(b,c){return a(b)&&this.remove_by_ident(c),!0},this)},get:function(a){return this._get(a)},iterate:function(a,b){this._iterate(function(b,d){var e=a.apply(this,[b,d]);return c.is_defined(e)?e:!0},b)},iterator:function(){return d.byIterate(this.iterate,this)}}})}),a.define("module:Lists.LinkedList",["module:Lists.AbstractList"],function(a,b){return a.extend({scoped:b},{__first:null,__last:null,_add:function(a){return this.__last={obj:a,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(a){return a.next?a.next.prev=a.prev:this.__last=a.prev,a.prev?a.prev.next=a.next:this.__first=a.next,a.obj},_get:function(a){return a.obj},_iterate:function(a,b){for(var c=this.__first;c;){var d=c;if(c=c.next,!a.apply(b||this,[d.obj,d]))return}}})}),a.define("module:Lists.ObjectIdList",["module:Lists.AbstractList","module:Ids"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c){this.__map={},this.__id_generator=c,a.constructor.call(this,b)},_add:function(a){var c=a.__cid;if(!c)for(;;)if(c=this.__id_generator?b.objectId(a,this.__id_generator()):b.objectId(a),!this.__map[c]||!this.__id_generator)break;return this.__map[c]=a,c},_remove:function(a){var b=this.__map[a];return delete this.__map[a],b},_get:function(a){return this.__map[a]},_iterate:function(a,b){for(var c in this.__map)a.apply(b||this,[this.__map[c],c])},get_ident:function(a){var c=b.objectId(a);return this.__map[c]?c:null}}})}),a.define("module:Lists.ArrayList",["module:Lists.AbstractList","module:Ids","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){this.__idToIndex={},this.__items=[],c=c||{},"compare"in c&&(this._compare=c.compare),"get_ident"in c&&(this._get_ident=c.get_ident),a.constructor.call(this,b)},set_compare:function(a){this._compare=a,a&&this.sort()},get_compare:function(){return this._compare},sort:function(a){if(a=a||this._compare){this.__items.sort(a);for(var b=0;b<this.__items.length;++b)this.__ident_changed(this.__items[b],b);this._sorted()}},_sorted:function(){},re_index:function(a){if(!this._compare)return a;for(var b=this.__items.length-1,c=this.__items[a],d=a;b>d&&this._compare(this.__items[d],this.__items[d+1])>0;)this.__items[d]=this.__items[d+1],this.__ident_changed(this.__items[d],d),this.__items[d+1]=c,++d;if(d==a)for(;d>0&&this._compare(this.__items[d],this.__items[d-1])<0;)this.__items[d]=this.__items[d-1],this.__ident_changed(this.__items[d],d),this.__items[d-1]=c,--d;return d!=a&&(this.__ident_changed(c,d),this._re_indexed(c)),d},_re_indexed:function(){},__objectId:function(a){return this._get_ident?this._get_ident(a):b.objectId(a)},_add:function(a){var b=this.__items.length;this.__items.push(a);var c=this.re_index(b);return this.__idToIndex[this.__objectId(a)]=c,c},_remove:function(a){for(var b=this.__items[a],c=a+1;c<this.__items.length;++c)this.__items[c-1]=this.__items[c],this.__ident_changed(this.__items[c-1],c-1);return this.__items.pop(),delete this.__idToIndex[this.__objectId(b)],b},_get:function(a){return this.__items[a]},_iterate:function(a,b){for(var d=c.clone(this.__items,1),e=0;e<d.length;++e)a.apply(b||this,[d[e],this.get_ident(d[e])])},__ident_changed:function(a,b){this.__idToIndex[this.__objectId(a)]=b,this._ident_changed(a,b)},get_ident:function(a){var b=this.__objectId(a);return b in this.__idToIndex?this.__idToIndex[b]:null},ident_by_id:function(a){return this.__idToIndex[a]}}})}),a.define("module:Locales",function(){return{__data:{},language:null,get:function(a){return this.language&&this.language+"."+a in this.__data?this.__data[this.language+"."+a]:a in this.__data?this.__data[a]:a},register:function(a,b){b=b?b+".":"";for(var c in a)this.__data[b+c]=a[c]},view:function(a){return{context:this,prefix:a,get:function(a){return this.context.get(this.prefix+"."+a)},view:function(a){return this.context.view(this.prefix+"."+a)},register:function(a,b){this.context.register(a,this.prefix+(b?"."+b:""))}}}}}),a.define("module:Objs",["module:Types"],function(a){return{ithKey:function(a,b){b=b||0;for(var c in a){if(0>=b)return c;b--}return null},count:function(b){if(a.is_array(b))return b.length;var c=0;for(var d in b)c++;return c},clone:function(b,c){return c&&0!==c?a.is_array(b)?b.slice(0):a.is_object(b)?this.extend({},b,c-1):b:b},acyclic_clone:function(b,c){if(null===b||!a.is_object(b))return b;var d="__acyclic_cloned";if(b[d])return c||"CYCLE";b[d]=!0;var e={};for(var f in b)f!=d&&(e[f]=this.acyclic_clone(b[f],c));return delete b[d],e},extend:function(a,b,c){if(a=a||{},b)for(var d in b)a[d]=this.clone(b[d],c);return a},weak_extend:function(a,b,c){if(a=a||{},b)for(var d in b)d in a||(a[d]=this.clone(b[d],c));return a},tree_extend:function(b,c,d){if(b=b||{},c)for(var e in c)b[e]=e in b&&a.is_object(b[e])&&a.is_object(c[e])?this.tree_extend(b[e],c[e],d):this.clone(c[e],d);return b},merge:function(b,c,d){b=b||{},c=c||{};var e={},f=this.extend(this.keys(b,!0),this.keys(c,!0));for(var g in f){var h=g in d?d[g]:"primary";"primary"==h||"secondary"==h?(g in c||g in b)&&(e[g]="primary"==h?g in c?c[g]:b[g]:g in b?b[g]:c[g]):a.is_function(h)?e[g]=h(b[g],c[g]):a.is_object(h)&&(e[g]=this.merge(b[g],c[g],h))}return e},tree_merge:function(b,c){b=b||{},c=c||{};var d={},e=this.extend(this.keys(b,!0),this.keys(c,!0));for(var f in e)d[f]=a.is_object(c[f])&&b[f]?this.tree_merge(b[f],c[f]):f in c?c[f]:b[f];return d},keys:function(b,c){var d=null,e=null;if(a.is_undefined(c)){d=[];for(e in b)d.push(e);return d}d={};for(e in b)d[e]=c;return d},map:function(b,c,d){var e=null;if(a.is_array(b)){e=[];for(var f=0;f<b.length;++f)e.push(d?c.apply(d,[b[f],f]):c(b[f],f));return e}e={};for(var g in b)e[g]=d?c.apply(d,[b[g],g]):c(b[g],g);return e},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},filter:function(b,c,d){var e=null;if(a.is_array(b)){e=[];for(var f=0;f<b.length;++f)(d?c.apply(d,[b[f],f]):c(b[f],f))&&e.push(b[f]);return e}e={};for(var g in b)(d?c.apply(d,[b[g],g]):c(b[g],g))&&(e[g]=b[g]);return e},equals:function(a,b,c){var d=null;if(c&&c>0){for(d in a)if(!(d in b&&this.equals(a[d],b[d],c-1)))return!1;for(d in b)if(!(d in a))return!1;return!0}return a==b},iter:function(b,c,d){var e=null;if(a.is_array(b)){for(var f=0;f<b.length;++f)if(e=d?c.apply(d,[b[f],f]):c(b[f],f),a.is_defined(e)&&!e)return!1}else for(var g in b)if(e=d?c.apply(d,[b[g],g]):c(b[g],g),a.is_defined(e)&&!e)return!1;return!0},intersect:function(a,b){var c={};for(var d in a)d in b&&(c[d]=a[d]);return c},contains_key:function(b,c){return a.is_array(b)?a.is_defined(b[c]):c in b},contains_value:function(b,c){if(a.is_array(b)){for(var d=0;d<b.length;++d)if(b[d]===c)return!0}else for(var e in b)if(b[e]===c)return!0;return!1},exists:function(a,b,c){var d=!1;return this.iter(a,function(){return d=d||b.apply(this,arguments),!d},c),d},all:function(a,b,c){var d=!0;return this.iter(a,function(){return d=d&&b.apply(this,arguments)},c),d},objectify:function(b,c,d){var e={},f=a.is_function(c);a.is_undefined(c)&&(c=!0);for(var g=0;g<b.length;++g)e[b[g]]=f?c.apply(d||this,[b[g],g]):c;return e},peek:function(b){if(a.is_array(b))return b.length>0?b[0]:null;for(var c in b)return b[c];return null},poll:function(b){if(a.is_array(b))return b.shift();for(var c in b){var d=b[c];return delete b[c],d}return null},objectBy:function(){for(var a={},b=arguments.length/2,c=0;b>c;++c)a[arguments[2*c]]=arguments[2*c+1];return a},valueByIndex:function(b,c){if(c=c||0,a.is_array(b))return b[c];for(var d in b){if(0===c)return b[d];c--}return null},keyByIndex:function(b,c){if(c=c||0,a.is_array(b))return c;for(var d in b){if(0===c)return d;c--}return null},pairArrayToObject:function(a){for(var b={},c=0;c<a.length/2;c+=2)b[a[c]]=a[c+1];return b},pairsToObject:function(){for(var a={},b=0;b<arguments.length;++b)a[arguments[b][0]]=arguments[b][1];return a}}}),a.define("module:Objs.Scopes",["module:Types"],function(a){return{has:function(b,c){for(var d=b?b.split("."):[],e=0;e<d.length;++e){if(!c||!a.is_object(c))return!1;c=c[d[e]]}return a.is_defined(c)},get:function(b,c){for(var d=b?b.split("."):[],e=0;e<d.length;++e){if(!c||!a.is_object(c))return null;c=c[d[e]]}return c},set:function(b,c,d){if(b){for(var e=b.split("."),f=0;f<e.length-1;++f)e[f]in d&&a.is_object(d[e[f]])||(d[e[f]]={}),d=d[e[f]];d[e[e.length-1]]=c}},unset:function(b,c){if(b){for(var d=b.split("."),e=0;e<d.length-1;++e){if(!c||!a.is_object(c))return;c=c[d[e]]}delete c[d[d.length-1]]}},touch:function(b,c){if(!b)return c;for(var d=b.split("."),e=0;e<d.length;++e)d[e]in c&&a.is_object(c)||(c[d[e]]={}),c=c[d[e]];return c[d[d.length-1]]}}}),a.define("module:Parser.LexerException",["module:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,"Lexer error: Unrecognized identifier at "+b.length+"."),this.__head=b,this.__tail=c}}})}),a.define("module:Parser.Lexer",["module:Class","module:Types","module:Objs","module:Parser.LexerException"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(d){a.constructor.call(this),this.__patterns=[],c.iter(d,function(a,c){this.__patterns.push({regex:new RegExp("^"+c,"m"),data:b.is_string(a)?{token:a}:a})},this)},lex:function(a){for(var e=[],f="",g=a;g;){for(var h=null,i=null,j=0;j<this.__patterns.length;++j)if(h=this.__patterns[j].regex.exec(g)){i=c.clone(this.__patterns[j].data,1);break}if(!h)throw new d(f,g);if(f+=h[0],g=g.substring(h[0].length),i){for(var k in i)if(b.is_string(i[k]))for(var l=0;l<h.length;++l)i[k]=i[k].replace("$"+l,h[l]);e.push(i)}}return e}}})}),a.define("module:Promise",["module:Types","module:Functions","module:Async"],function(a,b,c){return{Promise:function(a,b,c){this.__value=b?null:a||null,this.__error=b?b:null,this.__isFinished=c,this.__hasError=!!b,this.__resultPromise=null,this.__callbacks=[]},create:function(a,b){return new this.Promise(a,b,arguments.length>0)},value:function(a){return this.is(a)?a:new this.Promise(a,null,!0)},eventualValue:function(a){var b=new this.Promise;return c.eventually(function(){b.asyncSuccess(a)}),b},error:function(a){return this.is(a)?a:new this.Promise(null,a,!0)},box:function(a,b,c){try{var d=a.apply(b||this,c||[]);return this.is(d)?d:this.value(d)}catch(e){return this.error(e)}},tryCatch:function(a,b){try{return this.value(a.apply(b||this))}catch(c){return this.error(c)}},funcCallback:function(c,d){var e=b.getArguments(arguments,1);a.is_function(c)?(e=b.getArguments(arguments,1),d=c,c=this):e=b.getArguments(arguments,2);var f=this.create();return e.push(f.asyncCallbackFunc()),d.apply(c,e),f},and:function(b){var c=this.create();return c.__promises=[],c.__successCount=0,c.__values=[],c.__errorPromise=null,c.and=function(b){if(b=b||[],this.__ended)return this;a.is_array(b)||(b=[b]);for(var c=function(a,c){a?this.__errorPromise=b[this.idx]:(this.promise.__successCount++,this.promise.__values[this.idx]=c),this.promise.results()},d=0;d<b.length;++d){var e=this.__promises.length;this.__promises.push(b[d]),this.__values.push(null),b[d].isFinished()?b[d].hasValue()?(this.__successCount++,this.__values[e]=b[d].value()):this.__errorPromise=b[d]:b[d].callback(c,{promise:this,idx:e})}return this},c.end=function(){return this.__ended?this:(this.__ended=!0,this.results(),this)},c.results=function(){return this.__ended&&this.__errorPromise?this.asyncError(this.__errorPromise.err(),this.__errorPromise):this.__ended&&this.__successCount==this.__promises.length&&this.asyncSuccess(this.__values),this},c.successUnfold=function(a,b,c){return this.success(function(){return a.apply(b,arguments)},b,c)},c.and(b),c},func:function(a){for(var c=b.getArguments(arguments,1),d=[],e=0;e<c.length;++e)this.is(c[e])&&d.push(c[e]);var f=this.create();return this.and(d).end().success(function(){for(var b=[],d=0;d<c.length;++d)b[d]=this.is(c[d])?c[d].value():c[d];var e=a.apply(this,b);this.is(e)?e.forwardCallback(f):f.asyncSuccess(e)},this).forwardError(f),f},methodArgs:function(a,b,c){return c.unshift(function(){return b.apply(a,arguments)}),this.func.apply(this,c)},method:function(a,c){return this.methodArgs(a,c,b.getArguments(arguments,2))},newClass:function(a){var c=b.getArguments(arguments,1);return c.unshift(b.newClassFunc(a)),this.func.apply(this,c)},is:function(b){return b&&a.is_object(b)&&b.classGuid==this.Promise.prototype.classGuid}}}),a.extend("module:Promise.Promise.prototype",["module:Promise","module:Functions"],function(a,b){return{classGuid:"7e3ed52f-22da-4e9c-95a4-e9bb877a3935",success:function(a,b,c){return this.callback(a,b,c,"success")},error:function(a,b,c){return this.callback(a,b,c,"error")},callback:function(a,b,c,d){"end"in this&&this.end();var e={type:d||"callback",func:a,options:c||{},context:b};return this.__isFinished?this.triggerResult(e):this.__callbacks.push(e),this},triggerResult:function(a){if(!this.__isFinished)return this;if(a)"success"!=a.type||this.__hasError?"error"==a.type&&this.__hasError?a.func.call(a.context||this,this.__error,this.__resultPromise||this):"callback"==a.type&&a.func.call(a.context||this,this.__error,this.__value,this.__resultPromise||this):a.func.call(a.context||this,this.__value,this.__resultPromise||this);else{var b=this.__callbacks;this.__callbacks=[];for(var c=0;c<b.length;++c)this.triggerResult(b[c])}return this},value:function(){return this.__value},err:function(){return this.__error},isFinished:function(){return this.__isFinished},hasValue:function(){return this.__isFinished&&!this.__hasError},hasError:function(){return this.__isFinished&&this.__hasError},asyncSuccess:function(a,b){return this.__isFinished?this:(this.__resultPromise=b,this.__error=null,this.__isFinished=!0,this.__hasError=!1,this.__value=a,this.triggerResult())},forwardSuccess:function(a){return this.success(a.asyncSuccess,a),this},asyncError:function(a,b){return this.__isFinished?this:(this.__resultPromise=b,this.__isFinished=!0,this.__hasError=!0,this.__error=a,this.__value=null,this.triggerResult())},forwardError:function(a){return this.error(a.asyncError,a),this},asyncCallback:function(a,b,c){return a?this.asyncError(a,c):this.asyncSuccess(b,c)},asyncCallbackFunc:function(){return b.as_method(this.asyncCallback,this)},forwardCallback:function(a){return this.callback(a.asyncCallback,a),this},mapSuccess:function(b,c){var d=a.create();return this.forwardError(d).success(function(e,f){var g=b.call(c||d,e,f);a.is(g)?g.forwardCallback(d):d.asyncSuccess(g)}),d},mapError:function(b,c){var d=a.create();return this.forwardSuccess(d).error(function(e,f){var g=b.call(c||d,e,f);a.is(g)?g.forwardCallback(d):d.asyncError(g)}),d},mapCallback:function(b,c){var d=a.create();return this.callback(function(e,f,g){var h=b.call(c||d,e,f,g);a.is(h)?h.forwardCallback(d):d.asyncCallback(e?h:e,e?f:h,g)}),d},and:function(b){var c=a.and(this);return c.and(b)}}}),a.define("module:Properties.PropertiesMixin",["module:Objs.Scopes","module:Objs","module:Strings","module:Types","module:Functions"],function(a,b,c,d,e){return{_notifications:{construct:function(){this.__properties={data:{},watchers:{children:{},eventCount:0,parent:null,key:null},computed:{},bindings:{}},b.iter(this.materializes,function(a){this.materializeAttr(a)},this)},destroy:function(){b.iter(this.__properties.bindings,function(a,b){this.unbind(b)},this),this.trigger("destroy")},register_event:function(a){b.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(b){c.starts_with(a,b+":")&&this.__registerWatcher(c.strip_start(a,b+":"),b)},this)},unregister_event:function(a){b.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(b){c.starts_with(a,b+":")&&this.__unregisterWatcher(c.strip_start(a,b+":"),b)},this)}},materializes:[],get:function(b){return a.get(b,this.__properties.data)},_canSet:function(){return!0},_beforeSet:function(a,b){return b},_afterSet:function(){},has:function(b){return a.has(b,this.__properties.data)},setAll:function(a){for(var b in a)this.set(b,a[b]);return this},keys:function(a){return b.keys(this.__properties.data,a)},data:function(){return this.__properties.data},getAll:function(){return b.clone(this.__properties.data,1)},materializeAttr:function(a){this[a]=function(b){return 0===arguments.length?this.get(a):(this.set(a,b),void 0)}},__registerWatcher:function(a){for(var b=a?a.split("."):[],c=this.__properties.watchers,d=0;d<b.length;++d)b[d]in c.children||(c.children[b[d]]={parent:c,eventCount:0,children:{},key:b[d]}),c=c.children[b[d]];c.eventCount++},__unregisterWatcher:function(a){for(var b=a?a.split("."):[],c=this.__properties.watchers,e=0;e<b.length;++e)c&&(c=c.children[b[e]]);
if(c)for(c.eventCount--;c.eventCount<=0&&d.is_empty(c.children)&&c.parent;){var f=c.parent;delete f.children[c.key],c=f}},uncompute:function(a){return a in this.__properties.computed&&(b.iter(this.__properties.computed[a].dependencies,function(a){a.properties.off("change:"+a.key,null,a)},this),delete this.__properties.computed[a]),this},compute:function(a,c){function f(){if(!(i.ignore>0)){var d=b.map(h,function(a){return a.properties.get(a.key)});j.set(a,c.apply(g.context,d))}}var g=e.matchArgs(arguments,2,{setter:"function",context:{type:"object",def:this},dependencies:!0});this.uncompute(a);var h=[];b.iter(g.dependencies,function(a){d.is_string(a)?h.push({properties:this,key:a}):h.push({properties:a[0],key:a[1]})},this);var i={ignore:0,func:c,context:g.context,setter:g.setter,dependencies:h};this.__properties.computed[a]=i;for(var j=this,k=0;k<h.length;++k)h[k].properties.on("change:"+h[k].key,f,h[k]);return f(),this},unbind:function(a,b){if(a in this.__properties.bindings){for(var c=this.__properties.bindings[a].length-1;c>=0;--c){var d=this.__properties.bindings[a][c];b&&b!=d||(d.left&&d.properties.off(null,null,d),d.right&&this.off(null,null,d),this.__properties.bindings[a].splice(c,1),c--)}0===this.__properties.bindings[a].length&&delete this.__properties.bindings[a]}return this},bind:function(a,c,d){d=b.extend({secondKey:a,left:!0,right:!0,deep:!1},d);var e={key:d.secondKey,left:d.left,right:d.right,deep:d.deep,properties:c};if(this.__properties.bindings[a]=this.__properties.bindings[a]||[],this.__properties.bindings[a].push(e),e.left){var f=this;e.properties.on("strongchange:"+e.key,function(b){f.set(a,b)},e),e.properties.on("unset:"+e.key,function(){f.unset(a)},e),e.deep&&(e.properties.on("strongdeepchange:"+e.key,function(b,c,d){f.get(a?a+"."+d:d)===b?f.__setChanged(a?a+"."+d:d,b,c,!0):f.set(a?a+"."+d:d,b)},e),e.properties.on("deepunset:"+e.key,function(b,c){f.has(a?a+"."+c:c)?f.unset(a?a+"."+c:c):f.__unsetChanged(a?a+"."+c:c,b)},e)),e.right&&this.has(a)||this.set(a,e.properties.get(e.key))}return e.right&&(this.on("strongchange:"+a,function(a){e.properties.set(e.key,a)},e),this.on("unset:"+a,function(){e.properties.unset(e.key)},e),e.deep&&(this.on("strongdeepchange:"+a,function(a,b,c){e.properties.get(e.key?e.key+"."+c:c)===a?e.properties.__setChanged(e.key?e.key+"."+c:c,a,b,!0):e.properties.set(e.key?e.key+"."+c:c,a)},e),this.on("deepunset:"+a,function(a,b){e.properties.has(e.key?e.key+"."+b:b)?e.properties.unset(e.key?e.key+"."+b:b):e.properties.__unsetChanged(e.key?e.key+"."+b:b,a)},e)),(!e.left||this.has(a))&&e.properties.set(e.key,this.get(a))),e.properties.on("destroy",function(){this.unbind(a)},e),this},__unsetChanged:function(a,e){function f(a,c,e){d.is_undefined(e)||(a.eventCount>0&&this.trigger("unset:"+c,e),b.iter(a.children,function(a,b){f.call(this,a,c?c+"."+b:b,e[b])},this))}this.trigger("unset",a,e);for(var g=a?a.split("."):[],h=this.__properties.watchers,i="",j=a,k=0;k<g.length;++k){if(h.eventCount>0&&this.trigger("deepunset:"+i,e,j),!(g[k]in h.children))return this;h=h.children[g[k]],i=i?i+"."+g[k]:g[k],j=c.first_after(j,".")}return f.call(this,h,a,e),this},__setChanged:function(a,e,f,g){function h(a,c,e,f){e!=f&&(a.eventCount>0&&(g||this.trigger("strongchange:"+c,e,f),this.trigger("change:"+c,e,f)),b.iter(a.children,function(a,b){h.call(this,a,c?c+"."+b:b,d.is_object(e)&&e?e[b]:null,d.is_object(f)&&f?f[b]:null)},this))}this.trigger("change",a,e,f),this._afterSet(a,e);for(var i=a?a.split("."):[],j=this.__properties.watchers,k="",l=a,m=0;m<i.length;++m){if(j.eventCount>0&&(g||this.trigger("strongdeepchange:"+k,e,f,l),this.trigger("deepchange:"+k,e,f,l)),!(i[m]in j.children))return;j=j.children[i[m]],k=k?k+"."+i[m]:i[m],l=c.first_after(l,".")}h.call(this,j,a,e,f)},unset:function(b){if(this.has(b)){var c=this.get(b);a.unset(b,this.__properties.data),this.__unsetChanged(b,c)}return this},__properties_guid:"ec816b66-7284-43b1-a945-0600c6abfde3",set:function(b,c,e){if(d.is_object(c)&&c&&c.guid==this.__properties_guid)return c.properties&&this.bind(b,c.properties,{secondKey:c.key}),c.func&&this.compute(b,c.func,c.dependencies),this;c=this._beforeSet(b,c);var f=this.get(b);return f!==c?(a.set(b,c,this.__properties.data),this.__setChanged(b,c,f)):e&&(this.trigger("change",b,c,f),this.trigger("change:"+b,c,f)),this},binding:function(a){return{guid:this.__properties_guid,properties:this,key:a}},computed:function(a,b){return{guid:this.__properties_guid,func:a,dependencies:b}}}}),a.define("module:Properties.Properties",["module:Class","module:Objs","module:Events.EventsMixin","module:Properties.PropertiesMixin"],function(a,b,c,d,e){return a.extend({scoped:e},[c,d,function(a){return{constructor:function(c,d){a.constructor.call(this),c&&this.setAll(c),d&&b.iter(d,function(a){this.materializeAttr(a)},this)}}}])}),a.define("module:RMI.Stub",["module:Class","module:Classes.InvokerMixin","module:Functions"],function(a,b,c,d){return a.extend({scoped:d},[b,function(a){return{intf:[],constructor:function(){a.constructor.call(this),this.invoke_delegate("invoke",this.intf)},destroy:function(){this.invoke("_destroy"),a.destroy.call(this)},invoke:function(a){return this.__send(a,c.getArguments(arguments,1))}}}])}),a.define("module:RMI.StubSyncer",["module:Class","module:Classes.InvokerMixin","module:Functions","module:Promise"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this),this.__stub=b,this.__current=null,this.__queue=[],this.invoke_delegate("invoke",this.__stub.intf)},invoke:function(){var a={args:c.getArguments(arguments),promise:d.create()};return this.__queue.push(a),this.__current||this.__next(),a.promise},__next:function(){0!==this.__queue.length&&(this.__current=this.__queue.shift(),this.__stub.invoke.apply(this.__stub,this.__current.args).forwardCallback(this.__current.promise).callback(this.__next,this))}}}])}),a.define("module:RMI.Skeleton",["module:Class","module:Objs","module:Promise"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{_stub:null,intf:[],_intf:{},__superIntf:["_destroy"],constructor:function(c){this._options=b.extend({destroyable:!1},c),a.constructor.call(this),this.intf=this.intf.concat(this.__superIntf);for(var d=0;d<this.intf.length;++d)this._intf[this.intf[d]]=!0},_destroy:function(){this._options.destroyable&&this.destroy()},invoke:function(a,b){if(!this._intf[a])return c.error(a);try{var d=this[a].apply(this,b);return c.is(d)?d:c.value(d)}catch(e){return c.error(e)}},_success:function(a){return c.value(a)},_error:function(a){return c.error(a)},stub:function(){if(this._stub)return this._stub;var a=this.cls.classname;return a.indexOf("Skeleton")>=0?a.replace("Skeleton","Stub"):a}}})}),a.define("module:RMI.Server",["module:Class","module:Events.EventsMixin","module:Objs","module:Channels.TransportChannel","module:Lists.ObjectIdList","module:Ids","module:RMI.Skeleton","module:Promise"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},[b,function(a){return{constructor:function(b,c){if(a.constructor.call(this),this.__channels=new e,this.__instances={},b){var f=b;c&&(f=this._auto_destroy(new d(b,c))),this.registerClient(f)}},destroy:function(){this.__channels.iterate(this.unregisterClient,this),c.iter(this.__instances,function(a){this.unregisterInstance(a.instance)},this),this.__channels.destroy(),a.destroy.call(this)},registerInstance:function(a,b){return b=b||{},this.__instances[f.objectId(a,b.name)]={instance:a,options:b},a},unregisterInstance:function(a){delete this.__instances[f.objectId(a)],a.weakDestroy()},registerClient:function(a){var b=this;this.__channels.add(a),a._reply=function(c,d){var e=c.split(":");return 2==e.length?b._invoke(a,e[0],e[1],d):h.error(!0)}},unregisterClient:function(a){this.__channels.remove(a),a._reply=null},_serializeValue:function(a){if(g.is_instance_of(a)){var b=this;return b.registerInstance(a),{__rmi_meta:!0,__rmi_stub:a.stub(),__rmi_stub_id:f.objectId(a)}}return a},_unserializeValue:function(a){if(a&&a.__rmi_meta){var b=this.client;return b.acquire(a.__rmi_stub,a.__rmi_stub_id)}return a},_invoke:function(a,b,d,e){var f=this.__instances[b];return f||(this.trigger("loadInstance",a,b),f=this.__instances[b]),f?(f=f.instance,e=c.map(e,this._unserializeValue,this),f.invoke(d,e,a).mapSuccess(function(a){return this._serializeValue(a)},this)):h.error(b)}}}])}),a.define("module:RMI.Client",["module:Class","module:Objs","module:Channels.TransportChannel","module:Ids","module:RMI.Skeleton","module:Types","module:RMI.Stub"],function(b,c,d,e,f,g,h,i){return b.extend({scoped:i},function(b){return{constructor:function(a,c){if(b.constructor.call(this),this.__channel=null,this.__instances={},a){var e=a;c&&(e=this._auto_destroy(new d(a,c))),this.__channel=e}},destroy:function(){this.__channel&&this.disconnect(),b.destroy.call(this)},connect:function(a){this.__channel||(this.__channel=a)},disconnect:function(){this.__channel&&(this.__channel=null,c.iter(this.__instances,function(a){this.release(a)},this))},_serializeValue:function(a){if(f.is_instance_of(a)){var b=this.server;return b.registerInstance(a),{__rmi_meta:!0,__rmi_stub:a.stub(),__rmi_stub_id:e.objectId(a)}}return a},_unserializeValue:function(a){if(a&&a.__rmi_meta){var b=this;return b.acquire(a.__rmi_stub,a.__rmi_stub_id)}return a},acquire:function(b,d){if(this.__instances[d])return this.__instances[d];if(g.is_string(b)&&(b=a.getGlobal(b)),!b||!b.ancestor_of(h))return null;var f=new b;this.__instances[e.objectId(f,d)]=f;var i=this;return f.__send=function(a,b){return i.__channel?(b=c.map(b,i._serializeValue,i),i.__channel.send(d+":"+a,b).mapSuccess(function(a){return this._unserializeValue(a)},i)):void 0},f},release:function(a){var b=e.objectId(a);this.__instances[b]&&(a.weakDestroy(),delete this.__instances[b])}}})}),a.define("module:RMI.Peer",["module:Class","module:Channels.SenderMultiplexer","module:Channels.ReceiverMultiplexer","module:RMI.Client","module:RMI.Server"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(f,g){a.constructor.call(this),this.__sender=f,this.__receiver=g,this.__client_sender=this._auto_destroy(new b(f,"client")),this.__server_sender=this._auto_destroy(new b(f,"server")),this.__client_receiver=this._auto_destroy(new c(g,"server")),this.__server_receiver=this._auto_destroy(new c(g,"client")),this.client=this._auto_destroy(new d(this.__client_sender,this.__client_receiver)),this.server=this._auto_destroy(new e(this.__server_sender,this.__server_receiver)),this.client.server=this.server,this.server.client=this.client},acquire:function(a,b){return this.client.acquire(a,b)},release:function(a){this.client.release(a)},registerInstance:function(a,b){return this.server.registerInstance(a,b)},unregisterInstance:function(a){this.server.unregisterInstance(a)}}})}),a.define("module:Router.RouteParser",["module:Class","module:Strings","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),this.routes=[],c.iter(b,function(a,b){this.bind(b,a)},this)},parse:function(a){for(var b in this.routes){var c=this.routes[b],d=c.captureRegex.exec(a);if(d)return{name:c.name,args:d}}return null},format:function(a,c){c=c||{};var d=this.routes[a];return b.regexReplaceGroups(d.regex,d.captureRegex.mapBack(c))},bind:function(a,c){return this.routes[a]={name:a,regex:c,captureRegex:b.namedCaptureRegex("^"+c+"$")},this}}})}),a.define("module:Router.RouteMap",["module:Class","module:Strings","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),b=b||{},this._defaultMap=b.map,this._context=b.context||this,this._bindings=b.bindings||{}},map:function(a,b){var c=this._bindings[a];return c?c.call(this._context,a,b):this._defaultMap?this._defaultMap.call(this._context,a,b):{name:a,args:b}},bind:function(a,b){return this._bindings[a]=b,this}}})}),a.define("module:Router.Router",["module:Class","module:Events.EventsMixin","module:Objs","module:Router.RouteParser","module:Comparators"],function(a,b,c,d,e,f){return a.extend({scoped:f},[b,function(a){return{constructor:function(){a.constructor.call(this),this._routeParser=new d,this._current=null},destroy:function(){this._routeParser.destroy(),a.destroy.call(this)},bind:function(a,b,c,d){return this._routeParser.bind(a,b),c&&this.on("dispatch:"+a,c,d),this},current:function(){return this._current},navigate:function(a){this.trigger("navigate",a),this.trigger("navigate:"+a);var b=this._routeParser.parse(a);b&&this.dispatch(b.name,b.args,a)},dispatch:function(a,b,c){if(this._current){if(this._current.name===a&&e.deepEqual(b,this._current.args,2))return;this.trigger("leave",this._current.name,this._current.args,this._current),this.trigger("leave:"+this._current.name,this._current.args,this._current)}var d={route:c||this.format(a,b),name:a,args:b};this.trigger("dispatch",a,b,d),this.trigger("dispatch:"+a,b,d),this._current=d,this.trigger("dispatched",a,b,d),this.trigger("dispatched:"+a,b,d)},format:function(a,b){return this._routeParser.format(a,b)}}}])}),a.define("module:Router.RouteBinder",["module:Class","module:Types"],function(a,b,c){return a.extend({scoped:c},function(a){return{_setLocalRoute:function(){},_getLocalRoute:function(){},_localRouteChanged:function(){this.setGlobalRoute(this._getLocalRoute())},constructor:function(b){a.constructor.call(this),this._router=b,b.on("dispatched",function(){this.setLocalRoute(b.current())},this),b.current()?this.setLocalRoute(b.current()):this._getLocalRoute()&&this.setGlobalRoute(this._getLocalRoute())},destroy:function(){this._router.off(null,null,this),a.destroy.call(this)},setLocalRoute:function(a){this._setLocalRoute(a)},setGlobalRoute:function(a){b.is_string(a)?this._router.navigate(a):this._router.dispatch(a.name,a.args)}}})}),a.define("module:Router.StateRouteBinder",["module:Router.RouteBinder","module:Objs","module:Strings","module:Router.RouteMap"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(b,e,f){this._stateHost=e,this._options=f||{},this._routeToState=new d({map:this._options.routeToState||function(a,b){return{name:c.capitalize(a),args:b}},context:this._options.context}),this._stateToRoute=new d({map:this._options.stateToRoute||function(a,b){return{name:a.toLowerCase(),args:b}},context:this._options.context}),a.constructor.call(this,b),e.on("start",this._localRouteChanged,this)},destroy:function(){this._routeToState.destroy(),this._stateToRoute.destroy(),this._stateHost.off(null,null,this),a.destroy.call(this)},bindRouteToState:function(a,b){return this._routeToState.bind(a,b),this},bindStateToRoute:function(a,b){return this._stateToRoute.bind(a,b),this},register:function(a,b,d){return this._router.bind(a,b),this._stateHost.register(c.capitalize(a),d),this},_setLocalRoute:function(a){var b=this._routeToState.map(a.name,a.args);b&&this._stateHost.weakNext(b.name,b.args)},_getLocalRoute:function(){if(!this._stateHost.state())return null;var a=this._stateHost.state();return this._stateToRoute.map(a.state_name(),a.allAttr())}}})}),a.define("module:Router.RouterHistory",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{constructor:function(b){a.constructor.call(this),this._router=b,this._history=[],b.on("dispatched",function(a,b,c){this._history.push(c),this.trigger("change",c),this.trigger("insert",c)},this)},destroy:function(){this._router.off(null,null,this),a.destroy.call(this)},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this._history.length},get:function(a){return a=a||0,this._history[a]},back:function(a){if(this.count()<2)return null;for(a=a||0;a>=0&&this.count()>1;){var b=this._history.pop();this.trigger("remove",b),--a}var c=this._history.pop();return this.trigger("change",c),this._router.dispatch(c.name,c.args)}}}])}),a.define("module:Sort",["module:Comparators","module:Types","module:Objs"],function(a,b,c){return{sort_object:function(a,b){var c=[];for(var d in a)c.push({key:d,value:a[d]});c.sort(function(a,c){return b(a.key,c.key,a.value,c.value)});for(var e={},f=0;f<c.length;++f)e[c[f].key]=c[f].value;return e},deep_sort:function(c,d){if(d=d||a.byValue,b.is_array(c)){for(var e=0;e<c.length;++e)c[e]=this.deep_sort(c[e],d);return c.sort(d)}if(b.is_object(c)){for(var f in c)c[f]=this.deep_sort(c[f],d);return this.sort_object(c,d)}return c},dependency_sort:function(a,d,e,f){var g=b.is_string(d)?function(a){return a[d]}:d,h=b.is_string(e)?function(a){return a[e]}:e,i=b.is_string(f)?function(a){return a[f]}:f,j=a.length,k=[],l={},m={},n=0;for(n=0;j>n;++n){m[n]=!0;var o=g(a[n],n);l[o]=n,k.push({before:{},after:{}})}var p=function(a){return function(c){var d=l[c];b.is_defined(d)&&(k[a].before[d]=!0,k[d].after[a]=!0)}},q=function(a){return function(c){var d=l[c];b.is_defined(d)&&(k[a].after[d]=!0,k[d].before[a]=!0)}};for(n=0;j>n;++n)c.iter(h(a[n],n)||[],p(n)),c.iter(i(a[n])||[],q(n));for(var r=[];!b.is_empty(m);)for(n in m)if(b.is_empty(k[n].after)){delete m[n],r.push(a[n]);for(var s in k[n].before)delete k[s].after[n]}return r}}}),a.define("module:States.Host",["module:Properties.Properties","module:Events.EventsMixin","module:States.State","module:Types","module:Strings","module:Classes.ClassRegistry"],function(b,c,d,e,f,g,h){return b.extend({scoped:h},[c,function(b){return{constructor:function(a){b.constructor.call(this),a=a||{},this._stateRegistry=a.stateRegistry,this._baseState=a.baseState},initialize:function(b,c){if(!this._stateRegistry)if(e.is_string(b)&&b.indexOf(".")>=0){var d=f.splitLast(b,".");this._stateRegistry=this._auto_destroy(new g(a.getGlobal(d.head))),b=d.tail}else this._stateRegistry=this._auto_destroy(new g(a.getGlobal(f.splitLast(this.cls.classname,".").head)));this._createState(b,c).start(),this._baseState=this._baseState||this._state.cls},_createState:function(a,b,c){return this._stateRegistry.create(a,this,b||{},c||{})},finalize:function(){this._state&&this._state.destroy(),this._state=null},destroy:function(){this.finalize(),b.destroy.call(this)},state:function(){return this._state},state_name:function(){return this.state().state_name()},next:function(){return this.state()?this.state().next.apply(this.state(),arguments):this.initialize.apply(this,arguments)},weakNext:function(){return this.state()?this.state().weakNext.apply(this.state(),arguments):this.initialize.apply(this,arguments)},_start:function(a){this._stateEvent(a,"before_start"),this._state=a,this.set("name",a.state_name())},_afterStart:function(a){this._stateEvent(a,"start")},_end:function(a){this._stateEvent(a,"end"),this._state=null},_afterEnd:function(a){this._stateEvent(a,"after_end")},_next:function(a){this._stateEvent(a,"next")},_afterNext:function(a){this._stateEvent(a,"after_next")},_can_transition_to:function(){return!0},_stateEvent:function(a,b){this.trigger("event",b,a.state_name(),a.description()),this.trigger(b,a.state_name(),a.description()),this.trigger(b+":"+a.state_name(),a.description())},register:function(a,b,c){e.is_string(b)||(c=b,b=null),this._stateRegistry||(this._stateRegistry=this._auto_destroy(new g(f.splitLast(this.cls.classname).head)));var h=this._baseState?f.splitLast(this._baseState.classname,".").head+"."+a:a.indexOf(".")>=0?a:null,i=(this._stateRegistry.get(b)||this._baseState||d).extend(h,c);return h||(i.classname=a),this._stateRegistry.register(f.last_after(a,"."),i),this}}}])}),a.define("module:States.State",["module:Class","module:Types","module:Strings","module:Async","module:Objs"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{_locals:[],_persistents:[],_defaults:{},_white_list:null,constructor:function(c,d,f){a.constructor.call(this),this.host=c,this.transitionals=f,this._starting=!1,this._started=!1,this._stopped=!1,this._transitioning=!1,this.__next_state=null,this.__suspended=0,d=e.extend(e.clone(this._defaults||{},1),d),this._locals=b.is_function(this._locals)?this._locals():this._locals;for(var g={},h=0;h<this._locals.length;++h)this["_"+this._locals[h]]=d[this._locals[h]],g[this._locals[h]]=!0;for(this._persistents=b.is_function(this._persistents)?this._persistents():this._persistents,h=0;h<this._persistents.length;++h)this["_"+this._persistents[h]]=d[this._persistents[h]],g[this._locals[h]]=!0;e.iter(d,function(a,b){g[b]||c.set(b,a)},this)},allAttr:function(){var a=e.clone(this.host.data(),1);return e.iter(this._locals,function(b){a[b]=this["_"+b]},this),e.iter(this._persistents,function(b){a[b]=this["_"+b]},this),a},state_name:function(){return c.last_after(this.cls.classname,".")},description:function(){return this.state_name()},start:function(){this._starting||(this._starting=!0,this.host._start(this),this._start(),this.host&&(this.host._afterStart(this),this._started=!0))},end:function(){this._stopped||(this._stopped=!0,this._end(),this.host._end(this),this.host._afterEnd(this),this.destroy())},eventualNext:function(a,b,c){this.suspend(),this.next(a,b,c),this.eventualResume()},next:function(a,b,c){if(this._starting&&!this._stopped&&!this.__next_state){b=b||{};for(var d=0;d<this._persistents.length;++d)this._persistents[d]in b||(b[this._persistents[d]]=this["_"+this._persistents[d]]);var e=this.host._createState(a,b,c);if(!this.can_transition_to(e))return e.destroy(),void 0;this._started||(this.host._afterStart(this),this._started=!0),this.__next_state=e,this._transitioning=!0,this._transition(),this.__suspended<=0&&this.__next()}},weakSame:function(a,b){var c=!0;a!==this.state_name()&&(c=!1);var d=this.allAttr();return e.iter(b,function(a,b){d[b]!==a&&(c=!1)},this),c},weakNext:function(){return this.weakSame.apply(this,arguments)?this:this.next.apply(this,arguments)},__next:function(){var a=this.host,b=this.__next_state;a._next(b),this.end(),b.start(),a._afterNext(b)},_transition:function(){},suspend:function(){this.__suspended++},eventualResume:function(){d.eventually(this.resume,this)},resume:function(){this.__suspended--,0===this.__suspended&&!this._stopped&&this.__next_state&&this.__next()},can_transition_to:function(a){return this.host&&this.host._can_transition_to(a)&&this._can_transition_to(a)},_start:function(){},_end:function(){},_can_transition_to:function(a){return!b.is_array(this._white_list)||e.contains_value(this._white_list,a.state_name())}}},{_extender:{_defaults:function(a,b){return e.extend(e.clone(a,1),b)}}})}),a.define("module:States.CompetingComposite",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},{_register_host:function(a){this._hosts=this._hosts||[],this._hosts.push(this._auto_destroy(a))},other_hosts:function(a){return b.filter(this._hosts||[],function(b){return b!=a},this)},_next:function(a,b){for(var c=this.other_hosts(a),d=0;d<c.length;++d){var e=c[d],f=e.state();f.can_coexist_with(b)||f.retreat_against(b)}}})}),a.define("module:States.CompetingHost",["module:States.Host"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this._composite=b,b&&b._register_host(this)},composite:function(){return this._composite},_can_transition_to:function(a){if(!this._composite)return!0;for(var b=this._composite.other_hosts(this),c=0;c<b.length;++c){var d=b[c],e=d.state();if(!a.can_coexist_with(e)&&!a.can_prevail_against(e))return!1}return!0},_next:function(b){this._composite&&this._composite._next(this,b),a._next.call(this,b)}}})}),a.define("module:States.CompetingState",["module:States.State"],function(a,b){return a.extend({scoped:b},{can_coexist_with:function(){return!0},can_prevail_against:function(){return!1},retreat_against:function(){}})}),a.define("module:States.StateRouter",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this._host=b,this._routes=[],this._states={}},registerRoute:function(a,b,c){var d={key:a,route:new RegExp("^"+a+"$"),state:b,mapping:c||[]};return this._routes.push(d),this._states[b]=d,this},readRoute:function(a){var c=this._states[a.state_name()];if(!c)return null;var d=/\(.*?\)/,e=c.key;return b.iter(c.mapping,function(b){e=e.replace(d,a["_"+b])},this),e},parseRoute:function(a){for(var b=0;b<this._routes.length;++b){var c=this._routes[b],d=c.route.exec(a);if(null!==d){for(var e={},f=0;f<c.mapping.length;++f)e[c.mapping[f]]=d[f+1];return{state:c.state,args:e}}}return null},currentRoute:function(){return this.readRoute(this._host.state())},navigateRoute:function(a){var b=this.parseRoute(a);b&&this._host.next(b.state,b.args)}}})}),a.define("module:Strings",["module:Objs"],function(a){return{nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","  ":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(a.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(a){var b=this;return a.replace(this.JS_ESCAPER_REGEX(),function(a){return"\\"+b.JS_ESCAPES[a]})},starts_with:function(a,b){return a.substring(0,b.length)==b},ends_with:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},strip_start:function(a,b){return this.starts_with(a,b)?a.substring(b.length):a},last_after:function(a,b){return this.splitLast(a,b).tail},first_after:function(a,b){return a.substring(a.indexOf(b)+1,a.length)},EMAIL_ADDRESS_REGEX:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,is_email_address:function(a){return this.EMAIL_ADDRESS_REGEX.test(a)},STRIP_HTML_TAGS:["script","style","head"],STRIP_HTML_REGEX:/<\/?([a-z][a-z0-9]*)\b[^>]*>?/gi,STRIP_HTML_COMMENT_REGEX:/<![^>]*>/gi,strip_html:function(a){for(var b=a,c=0;c<this.STRIP_HTML_TAGS.length;++c)b=b.replace(new RegExp("<"+this.STRIP_HTML_TAGS[c]+".*</"+this.STRIP_HTML_TAGS[c]+">","i"),"");return b=b.replace(this.STRIP_HTML_REGEX,"").replace(this.STRIP_HTML_COMMENT_REGEX,"")},splitFirst:function(a,b){var c=a.indexOf(b);return{head:c>=0?a.substring(0,c):a,tail:c>=0?a.substring(c+b.length):""}},splitLast:function(a,b){var c=a.lastIndexOf(b);return{head:c>=0?a.substring(0,c):"",tail:c>=0?a.substring(c+b.length):a}},replaceAll:function(a,b,c){for(;a.indexOf(b)>=0;)a=a.replace(b,c);return a},nltrim:function(a){var b=a.replace(/\t/g,"  ").split("\n"),c=null,d=0;for(d=0;d<b.length;++d){for(var e=0;e<b[d].length&&" "==b[d].charAt(e);)++e;e<b[d].length&&(c=null===c?e:Math.min(e,c))}for(d=0;d<b.length;++d)b[d]=b[d].substring(c);return b.join("\n").trim()},read_cookie_string:function(a,b){var c="; "+a,d=c.split("; "+b+"=");return 2==d.length?d.pop().split(";").shift():null},write_cookie_string:function(a,b,c){var d="; "+a,e=d.split("; "+b+"=");return 2==e.length&&(d=e[0]+e[1].substring(e[1].indexOf(";"))),b+"="+c+d},capitalize:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},email_get_name:function(a){a=a||"";var b=a.split("<");return a=b[0].trim(),!a&&b.length>1&&(b=b[1].split(">"),a=b[0].trim()),a=a.replace(/['"]/g,"").replace(/[\\._@]/g," "),this.capitalize(a)},email_get_email:function(a){a=a||"";var b=a.split("<");return a=b[0].trim(),b.length>1&&(b=b[1].split(">"),a=b[0].trim()),a=a.replace(/'/g,"").replace(/"/g,"").trim()},email_get_salutatory_name:function(a){return a=a||"",this.email_get_name(a).split(" ")[0]},regexReplaceGroups:function(a,b){for(var c=/\(.*?\)/,d=function(a){return e?e:a.substring(1,a.length-1)};b.length>0;){var e=b.shift();a=a.replace(c,d)}return a},namedCaptureRegex:function(b){var c={},d=0,e=new RegExp(b.replace(/\([^)]+\)/gi,function(a){if("?"!=a.charAt(1)&&a.indexOf(":")>0){var b=a.indexOf(":");c[a.substring(1,b)]=d,a="("+a.substring(b+1,a.length-1)+")"}return d++,a})),f=function(b){return a.map(c,function(a){return b[a+1]})},g=function(a){var b=e.exec(a);return b?f(b):null},h=function(a){for(var b=[],e=0;d>e;++e)b.push(null);for(var f in a)f in c&&(b[c[f]]=a[f]);return b};return{regex:e,map:f,exec:g,mapBack:h}}}}),a.define("module:Structures.AvlTree",function(){return{empty:function(){return null},singleton:function(a){return{data:a,left:null,right:null,height:1,length:1}},min:function(a){return a.left?this.min(a.left):a.data},max:function(a){return a.right?this.max(a.right):a.data},height:function(a){return a?a.height:0},length:function(a){return a?a.length:0},height_join:function(a,b){return 1+Math.max(this.height(a),this.height(b))},length_join:function(a,b){return 1+this.length(a)+this.length(b)},create:function(a,b,c){return{data:a,left:b,right:c,height:this.height_join(b,c),length:this.length_join(b,c)}},balance:function(a,b,c){return this.height(b)>this.height(c)+2?this.height(b.left)>=this.height(b.right)?this.create(b.data,b.left,this.create(a,b.right,c)):this.create(b.right.data,this.create(b.data,b.left,b.right.left),this.create(a,b.right.right,c)):this.height(c)>this.height(b)+2?this.height(c.right)>=this.height(c.left)?this.create(c.data,this.create(a,b,c.left),c.right):this.create(c.left.data,this.create(a,b,c.left.left),this.create(c.data,c.left.right,c.right)):this.create(a,b,c)},__add_left:function(a,b){return b?this.balance(b.data,this.__add_left(a,b.left),b.right):this.singleton(a)},__add_right:function(a,b){return b?this.balance(b.data,b.data,this.__add_right(a,b.right)):this.singleton(a)},join:function(a,b,c){return b?c?this.height(b)>this.height(c)+2?this.balance(b.data,b.left,this.join(a,b.right,c)):this.height(c)>this.height(b)+2?this.balance(c.data,this.join(a,b,c.left),c.right):this.create(a,b,c):this.__add_right(a,b):this.__add_left(a,c)},take_min:function(a){if(!a.left)return[a.data,a.right];var b=this.take_min(a.left);return[b[0],this.join(a.data,b[1],a.right)]},take_max:function(a){if(!a.right)return[a.data,a.left];var b=this.take_max(a.right);return[b[0],this.join(a.data,a.left,b[1])]},reroot:function(a,b){if(!a||!b)return a||b;if(this.height(a)>this.height(b)){var c=this.take_max(a);return this.join(c[0],c[1],b)}var d=this.take_min(b);return this.join(d[0],a,d[1])},take_min_iter:function(a){return a?a.left?this.take_min_iter(this.create(a.left.data,a.left.left,this.create(a.data,a.left.right,a.right))):[a.data,a.left]:null},take_max_iter:function(a){return a?a.right?this.take_max_iter(this.create(a.right.data,this.create(a.data,a.left,a.right.left),a.right.right)):[a.data,a.right]:null}}}),a.define("module:Structures.TreeMap",["module:Structures.AvlTree"],function(a){return{empty:function(a){return{root:null,compare:a||function(a,b){return a>b?1:b>a?-1:0}}},is_empty:function(a){return!a.root},length:function(a){return a.root?a.root.length:0},__add:function(b,c,d,e){var f={key:b,value:c};if(!e)return a.singleton(f);var g=d.compare(b,e.data.key);return 0===g?(e.data=f,e):0>g?a.balance(e.data,this.__add(b,c,d,e.left),e.right):a.balance(e.data,e.left,this.__add(b,c,d,e.right))},add:function(a,b,c){return c.root=this.__add(a,b,c,c.root),c},singleton:function(a,b,c){return this.add(a,b,this.empty(c))},__find:function(a,b,c){if(!c)return null;var d=b.compare(a,c.data.key);return 0===d?c.data.value:this.__find(a,b,0>d?c.left:c.right)},find:function(a,b){return this.__find(a,b,b.root)},__iterate:function(a,b,c,d,e){return b?this.__iterate(a,e?b.right:b.left,c,d,e)&&c.call(d,b.data.key,b.data.value)!==!1&&this.__iterate(a,e?b.left:b.right,c,d,e):!0},iterate:function(a,b,c,d){this.__iterate(a,a.root,b,c,d)},__iterate_from:function(a,b,c,d,e,f){if(!c)return!0;var g=b.compare(a,c.data.key)*(f?-1:1);return 0>g&&!this.__iterate_from(a,b,f?c.right:c.left,d,e,f)?!1:0>=g&&d.call(e,c.data.key,c.data.value)===!1?!1:this.__iterate_from(a,b,f?c.left:c.right,d,e,f)},iterate_from:function(a,b,c,d,e){this.__iterate_from(a,b,b.root,c,d,e)
},iterate_range:function(a,b,c,d,e,f){this.iterate_from(a,c,function(a,g){return c.compare(a,b)*(f?-1:1)<=0&&d.call(e,a,g)!==!1},this,f)},take_min:function(b){var c=a.take_min(b.root);return c[1]={compare:b.compare,root:c[1]},c},__treeSizeLeft:function(a,b,c){var d=b.compare(a,c.data.key);return 0>d?this.__treeSizeLeft(a,b,c.left):1+(c.left?c.left.length:0)+(d>0?this.__treeSizeLeft(a,b,c.right):0)},__treeSizeRight:function(a,b,c){var d=b.compare(a,c.data.key);return d>0?this.__treeSizeRight(a,b,c.right):1+(c.right?c.right.length:0)+(0>d?this.__treeSizeRight(a,b,c.left):0)},__distance:function(a,b,c,d){var e=c.compare(a,d.data.key),f=c.compare(b,d.data.key);return e>0||0>f?this.__distance(a,b,c,e>0?d.right:d.left):1+(f>0?this.__treeSizeLeft(b,c,d.right):0)+(0>e?this.__treeSizeRight(a,c,d.left):0)},treeSizeLeft:function(a,b){return this.__treeSizeLeft(a,b,b.root)},treeSizeRight:function(a,b){return this.__treeSizeRight(a,b,b.root)},distance:function(a,b,c){return c.compare(a,b)<0?this.__distance(a,b,c,c.root)-1:0}}}),a.define("module:Templates",["module:Types","module:Strings"],function(a,b){return{tokenize:function(c){if(a.is_array(c))return c;var d=[],e=0,f=this;return c.replace(f.SYNTAX_REGEX(),function(a,g,h,i,j){return j>e&&d.push({type:f.TOKEN_STRING,data:b.js_escape(c.slice(e,j))}),i&&d.push({type:f.TOKEN_CODE,data:i}),g&&d.push({type:f.TOKEN_EXPR,data:g}),h&&d.push({type:f.TOKEN_ESC,data:h}),e=j+a.length,a}),d},compile:function(c,d){a.is_string(c)&&(c=this.tokenize(c)),d=d||{};for(var e=d.start_index||0,f=d.end_index||c.length,g="__p+='",h=e;f>h;++h)switch(c[h].type){case this.TOKEN_STRING:g+=c[h].data;break;case this.TOKEN_CODE:g+="';\n"+c[h].data+"\n__p+='";break;case this.TOKEN_EXPR:g+="'+\n((__t=("+c[h].data+"))==null?'':__t)+\n'";break;case this.TOKEN_ESC:g+="'+\n((__t=("+c[h].data+"))==null?'':Helpers.Strings.htmlentities(__t))+\n'"}g+="';\n",g="with(obj||{}){\n"+g+"}\n",g="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";var i=new Function("obj","Helpers",g),j=function(a){return i.call(this,a,{Strings:b})};return j.source="function(obj, Helpers){\n"+g+"}",j},SYNTAX:{OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},SYNTAX_REGEX:function(){var a=this.SYNTAX;return this.SYNTAX_REGEX_CACHED||(this.SYNTAX_REGEX_CACHED=new RegExp(a.OPEN+a.MODIFIER_EXPR+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_ESC+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_CODE+"([\\s\\S]+?)"+a.CLOSE+"|$","g")),this.SYNTAX_REGEX_CACHED},TOKEN_STRING:1,TOKEN_CODE:2,TOKEN_EXPR:3,TOKEN_ESC:4}}),a.define("module:Templates.Template",["module:Class","module:Templates"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this),this.__tokens=b.tokenize(c),this.__compiled=b.compile(this.__tokens)},evaluate:function(a){return this.__compiled.apply(this,[a])}}})}),a.define("module:Time",["module:Locales"],function(a){return{timezoneBias:function(a){return a===!0&&(a=(new Date).getTimezoneOffset()),("undefined"==typeof a||null===a||a===!1)&&(a=0),60*a*1e3},timeToDate:function(a,b){return new Date(a+this.timezoneBias(b))},dateToTime:function(a,b){return a.getTime()-this.timezoneBias(b)},timeToTimezoneBasedDate:function(a,b){return new Date(a-this.timezoneBias(b))},timezoneBasedDateToTime:function(a,b){return a.getTime()+this.timezoneBias(b)},__components:{year:{set:function(a,b){a.setUTCFullYear(b)},get:function(a){return a.getUTCFullYear()}},month:{set:function(a,b){a.setUTCMonth(b)},get:function(a){return a.getUTCMonth()}},day:{dependencies:{weekday:!0},set:function(a,b){a.setUTCDate(b+1)},get:function(a){return a.getUTCDate()-1},milliseconds:864e5},weekday:{dependencies:{day:!0,month:!0,year:!0},set:function(a,b){a.setUTCDate(a.getUTCDate()+b-a.getUTCDay())},get:function(a){return a.getUTCDay()}},hour:{set:function(a,b){a.setUTCHours(b)},get:function(a){return a.getUTCHours()},max:23,milliseconds:36e5},minute:{set:function(a,b){a.setUTCMinutes(b)},get:function(a){return a.getUTCMinutes()},max:59,milliseconds:6e4},second:{set:function(a,b){a.setUTCSeconds(b)},get:function(a){return a.getUTCSeconds()},max:59,milliseconds:1e3},millisecond:{set:function(a,b){a.setUTCMilliseconds(b)},get:function(a){return a.getUTCMilliseconds()},max:999,milliseconds:1}},decodeTime:function(a,b){var c=this.timeToTimezoneBasedDate(a||this.now(),b),d={};for(var e in this.__components)d[e]=this.__components[e].get(c);return d},encodeTime:function(a,b){return this.updateTime(this.now(),a,b)},encodePeriod:function(a){return this.incrementTime(0,a)},updateTime:function(a,b,c){var d=this.timeToTimezoneBasedDate(a,c);for(var e in b)this.__components[e].set(d,b[e]);return this.timezoneBasedDateToTime(d,c)},now:function(a){return this.dateToTime(new Date,a)},incrementTime:function(a,b){var c=this.timeToDate(a);for(var d in b)this.__components[d].set(c,this.__components[d].get(c)+b[d]);return this.dateToTime(c)},floorTime:function(a,b,c){var d=this.timeToTimezoneBasedDate(a,c),e=!1;for(var f in this.__components){var g=this.__components[f];e=e||f==b,!e||g.dependencies&&g.dependencies[b]||g.set(d,0)}return this.timezoneBasedDateToTime(d,c)},ago:function(a,b){return this.now(b)-a},timeComponent:function(a,b,c){return Math[c||"floor"](a/this.__components[b].milliseconds)},timeModulo:function(a,b,c){return this.timeComponent(a,b,c)%(this.__components[b].max+1)},formatTimePeriod:function(b,c){c=c||{};for(var d=c.components||["day","hour","minute","second"],e="",f=0,g=0;g<d.length&&(e=d[g],!(f=this.timeComponent(b,e,c.round||"round")));++g);return f+" "+a.get(e+(1==f?"":"s"))},formatTime:function(a,b){var c=["hour","minute","second"];b=b||"hhh:mm:ss";for(var d={},e=0;e<c.length;++e){var f=c[e].charAt(0);d[f+f+f]=this.timeComponent(a,c[e],"floor");var g=this.timeModulo(a,c[e],"floor");d[f+f]=10>g?"0"+g:g,d[f]=g}for(var h in d)b=b.replace(h,d[h]);return b}}}),a.define("module:Timers.Timer",["module:Class","module:Objs","module:Time"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(c){a.constructor.call(this),c=b.extend({once:!1,start:!0,fire:null,context:this,destroy_on_fire:!1,real_time:!1},c),this.__delay=c.delay,this.__destroy_on_fire=c.destroy_on_fire,this.__once=c.once,this.__fire=c.fire,this.__context=c.context,this.__started=!1,this.__real_time=c.real_time,c.start&&this.start()},destroy:function(){this.stop(),a.destroy.call(this)},fire:function(){if(this.__once&&(this.__started=!1),this.__fire&&(this.__fire.call(this.__context,this),this.__fire_count++,this.__real_time&&!this.__destroy_on_fire&&!this.__once))for(;(this.__fire_count+1)*this.__delay<=c.now()-this.__start_time;)this.__fire.call(this.__context,this),this.__fire_count++;this.__destroy_on_fire&&this.destroy()},stop:function(){this.__started&&(this.__once?clearTimeout(this.__timer):clearInterval(this.__timer),this.__started=!1)},start:function(){if(!this.__started){var a=this;this.__real_time&&(this.__start_time=c.now()),this.__fire_count=0,this.__timer=this.__once?setTimeout(function(){a.fire()},this.__delay):setInterval(function(){a.fire()},this.__delay),this.__started=!0}},restart:function(){this.stop(),this.start()}}})}),a.define("module:Tokens",function(){return{generate_token:function(a){a=a||16;for(var b="";b.length<a;)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},simple_hash:function(a){var b=0;if(!a.length)return b;for(var c,d=0,e=a.length;e>d;++d)c=a.charCodeAt(d),b=(b<<5)-b+c,b&=b;return Math.abs(b)}}}),a.define("module:Trees.TreeNavigator",function(){return{nodeRoot:function(){},nodeId:function(){},nodeParent:function(){},nodeChildren:function(){},nodeWatch:function(){},nodeUnwatch:function(){},nodeData:function(){}}}),a.define("module:Trees.TreeQueryEngine",["module:Class","module:Parser.Lexer","module:Trees.TreeQueryObject"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(c){a.constructor.call(this),this.__navigator=c,this.__lexer=this._auto_destroy(new b({"<\\+":{token:"Up"},"<":{token:"Up",single:!0},">\\+":{token:"Down"},">":{token:"Down",single:!0},"\\[s*([a-zA-Z]+)s*=s*'([^']*)'s*\\]":{token:"Selector",key:"$1",value:"$2"},'\\[s*([a-zA-Z]+)s*=s*"([^\']*)"s*\\]':{token:"Selector",key:"$1",value:"$2"},s:null}))},query:function(a,b){return new c(this.__navigator,a,this.__lexer.lex(b))}}})}),a.define("module:Trees.TreeQueryObject",["module:Class","module:Events.EventsMixin","module:Objs","module:Types"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__navigator=b,this.__node=c,this.__query=d,this.__result={},this.__partials={},this.__register(c,0,{}),this.__ids=0},destroy:function(){c.iter(this.__partials,function(a){c.iter(a.partials,function(b){this.__navigator.nodeUnwatch(a.node,null,b)},this)},this),a.destroy.call(this)},result:function(){var a=[];return c.iter(this.__result,function(b){a.push(b.node)}),a},__register:function(a,b){var c=this.__navigator.nodeId(a);this.__partials[c]||(this.__partials[c]={node:a,partials:{}});var d=this.__partials[c];this.__ids++;var e={owner:d,id:this.__ids,query_index_start:b,query_index_next:b,query_index_last:b,partial_match:!1,partial_final:b>=this.__query.length,partial_data:!1,partial_children:!1,partial_parent:!1,partial_star:!1,parent:null,deps:{}};d.partials[e.id]=e;for(var f=e.query_index_start;f<this.__query.length;++f){if("Selector"!=this.__query[f].token){"Up"==this.__query[f].token?e.partial_parent=!0:"Down"==this.__query[f].token&&(e.partial_children=!0),e.partial_star=!this.__query[f].single,e.partial_star||(e.query_index_next=f+1);break}e.partial_data=!0,e.query_index_next=f+1,e.partial_final=f+1==this.__query.length}e.query_index_last=e.partial_star?e.query_index_next+1:e.query_index_next;var g=this;return this.__navigator.nodeWatch(a,function(a,b){"data"==a&&e.partial_data&&g.__update(e),"remove"==a&&g.__unregisterPartial(e),"addChild"==a&&e.partial_children&&e.partial_match&&g.__addDependentPartial(e,b)},e),this.__update(e),e},__unregisterPartial:function(a){var b=a.owner,e=b.node,f=this.__navigator.nodeId(e);a.partial_final&&this.__result[f]&&(this.__result[f].count--,this.__result[f].count<=0&&(delete this.__result[f],this.trigger("remove",e),this.trigger("change"))),c.iter(a.deps,this.__unregisterPartial,this),a.parent&&delete a.parent.deps[a.id],this.__navigator.nodeUnwatch(e,null,a),delete b.partials[a.id],d.is_empty(b.partials)&&delete this.__partials[f]},__addDependentPartial:function(a,b){var d=[];d.push(this.__register(b,a.query_index_next)),a.partial_star&&d.push(this.__register(b,a.query_index_next+1)),c.iter(d,function(b){a.deps[b.id]=b,b.parent=a},this)},__update:function(a){for(var b=!0,d=a.owner.node,e=this.__navigator.nodeId(d),f=this.__navigator.nodeData(d),g=a.query_index_start;g<a.query_index_last;++g){var h=this.__query[g];if("Selector"!=h.token)break;if(f[h.key]!=h.value){b=!1;break}}if(b!=a.partial_match)if(a.partial_match=b,b)if(a.partial_final)this.__result[e]?this.__result[e].count++:(this.__result[e]={node:d,count:1},this.trigger("add",d),this.trigger("change"));else if(a.partial_parent){var i=this.__navigator.nodeParent(d);i&&this.__addDependentPartial(a,i)}else a.partial_children&&c.iter(this.__navigator.nodeChildren(d),function(b){this.__addDependentPartial(a,b)},this);else a.partial_final&&(this.__result[e].count--,this.__result[e].count<=0&&(delete this.__result[e],this.trigger("remove",d),this.trigger("change"))),c.iter(a.deps,this.__unregisterPartial,this)}}}])}),a.define("module:Types",function(){return{is_object:function(a){return"object"==typeof a},is_array:function(a){return"[object Array]"===Object.prototype.toString.call(a)},is_undefined:function(a){return"undefined"==typeof a},is_null:function(a){return null===a},is_none:function(a){return this.is_undefined(a)||this.is_null(a)},is_defined:function(a){return"undefined"!=typeof a},is_empty:function(a){if(this.is_none(a))return!0;if(this.is_array(a))return 0===a.length;if(this.is_object(a)){for(var b in a)return!1;return!0}return!1},is_string:function(a){return"string"==typeof a},is_function:function(a){return"function"==typeof a},is_boolean:function(a){return"boolean"==typeof a},compare:function(a,b){if(this.is_boolean(a)&&this.is_boolean(b))return a==b?0:a?1:-1;if(this.is_array(a)&&this.is_array(b)){for(var c=a.length,d=b.length,e=Math.min(c,d),f=0;e>f;++f){var g=this.compare(a[f],b[f]);if(0!==g)return g}return c==d?0:c>d?1:-1}return a.localeCompare(b)},parseBool:function(a){return this.is_boolean(a)?a:"true"==a?!0:"false"==a?!1:null},type_of:function(a){return this.is_array(a)?"array":typeof a},parseType:function(a,b){return this.is_string(a)?(b=b.toLowerCase(),"bool"==b||"boolean"==b?this.parseBool(a):"int"==b||"integer"==b?parseInt(a,10):"date"==b||"time"==b||"datetime"==b?parseInt(a,10):a):a},objectType:function(a){if(!this.is_object(a))return null;var b=a.match(/\[object (.*)\]/);return b?b[1]:null}}}),a.define("module:Net.AjaxException",["module:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this,b+": "+c),this.__status_code=b,this.__status_text=c,this.__data=d},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data},json:function(){var b=a.json.call(this);return b.data=this.data(),b}}})}),a.define("module:Net.AbstractAjax",["module:Class","module:Objs","module:Net.AjaxException","module:Net.Uri"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(c){a.constructor.call(this),this.__options=b.extend({method:"GET",data:{}},c)},syncCall:function(a){try{return this._shouldMap(a)&&(a=this._mapPutToPost(a)),this._syncCall(b.extend(b.clone(this.__options,1),a))}catch(d){throw c.ensure(d)}},asyncCall:function(a){return this._shouldMap(a)&&(a=this._mapPutToPost(a)),this._asyncCall(b.extend(b.clone(this.__options,1),a))},_syncCall:function(){throw"Unsupported"},_asyncCall:function(){throw"Unsupported"},_shouldMap:function(a){return this.__options.mapPutToPost&&a.method&&"put"===a.method.toLowerCase()},_mapPutToPost:function(a){return a.method="POST",a.uri=d.appendUriParams(a.uri,{_method:"PUT"}),a}}})}),a.define("module:Net.SocketSenderChannel",["module:Channels.Sender","module:Types"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.call(this),this.__socket=c,this.__message=d,this.__ready=b.is_defined(e)?e:!0,this.__cache=[]},_send:function(a,b){this.__ready?this.__socket.emit(this.__message,{message:a,data:b}):this.__cache.push({message:a,data:b})},ready:function(){this.__ready=!0;for(var a=0;a<this.__cache.length;++a)this._send(this.__cache[a].message,this.__cache[a].data);this.__cache=[]},unready:function(){this.__ready=!1},socket:function(){return arguments.length>0&&(this.__socket=arguments[0]),this.__socket}}})}),a.define("module:Net.SocketReceiverChannel",["module:Channels.Receiver"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__message=c,this.socket(b)},socket:function(){if(arguments.length>0&&(this.__socket=arguments[0],this.__socket)){var a=this;this.__socket.on(this.__message,function(b){a._receive(b.message,b.data)})}return this.__socket}}})}),a.define("module:Net.HttpHeader",function(){return{HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,format:function(a,b){var c="";return c=a==this.HTTP_STATUS_OK?"OK":a==this.HTTP_STATUS_CREATED?"Created":a==this.HTTP_STATUS_PAYMENT_REQUIRED?"Payment Required":a==this.HTTP_STATUS_FORBIDDEN?"Forbidden":a==this.HTTP_STATUS_NOT_FOUND?"Not found":a==this.HTTP_STATUS_PRECONDITION_FAILED?"Precondition Failed":a==this.HTTP_STATUS_INTERNAL_SERVER_ERROR?"Internal Server Error":"Other Error",b?a+" "+c:c}}}),a.define("module:Net.Uri",["module:Objs","module:Types"],function(a,b){return{build:function(a){var b="";return a.username&&(b+=a.username+":"),a.password&&(b+=a.password+"@"),b+=a.server,a.port&&(b+=":"+a.port),a.path&&(b+="/"+a.path),b},encodeUriParams:function(c,d){d=d||"";var e=[];return a.iter(c,function(a,c){b.is_object(a)?e=e.concat(this.encodeUriParams(a,d+c+"_")):e.push(d+c+"="+encodeURIComponent(a))},this),e.join("&")},appendUriParams:function(a,c,d){return b.is_empty(c)?a:a+(-1!=a.indexOf("?")?"&":"?")+this.encodeUriParams(c,d)},parse:function(a,b){for(var c=b?this.__parse_strict_regex:this.__parse_loose_regex,d=c.exec(a),e={},f=0;f<this.__parse_key.length;++f)e[this.__parse_key[f]]=d[f]||"";return e.queryKey={},e[this.__parse_key[12]].replace(this.__parse_key_parser,function(a,b,c){b&&(e.queryKey[b]=c)}),e},__parse_strict_regex:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,__parse_loose_regex:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,__parse_key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],__parse_key_parser:/(?:^|&)([^&=]*)=?([^&]*)/g}})}).call(Scoped),function(){"use strict";var a=function(b){function c(a,b,c){var e=this;e.opts={},e.getOpt=a.getOpt,e._prevProgress=0,e.resumableObj=a,e.file=b,e.fileName=b.fileName||b.name,e.size=b.size,e.relativePath=b.webkitRelativePath||b.relativePath||e.fileName,e.uniqueIdentifier=c,e._pause=!1,e.container="";var g=void 0!==c,h=function(a,b){switch(a){case"progress":e.resumableObj.fire("fileProgress",e);break;case"error":e.abort(),g=!0,e.chunks=[],e.resumableObj.fire("fileError",e,b);break;case"success":if(g)return;e.resumableObj.fire("fileProgress",e),e.isComplete()&&e.resumableObj.fire("fileSuccess",e,b);break;case"retry":e.resumableObj.fire("fileRetry",e)}};return e.chunks=[],e.abort=function(){var a=0;f.each(e.chunks,function(b){"uploading"==b.status()&&(b.abort(),a++)}),a>0&&e.resumableObj.fire("fileProgress",e)},e.cancel=function(){var a=e.chunks;e.chunks=[],f.each(a,function(a){"uploading"==a.status()&&(a.abort(),e.resumableObj.uploadNextChunk())}),e.resumableObj.removeFile(e),e.resumableObj.fire("fileProgress",e)},e.retry=function(){e.bootstrap();var a=!1;e.resumableObj.on("chunkingComplete",function(){a||e.resumableObj.upload(),a=!0})},e.bootstrap=function(){e.abort(),g=!1,e.chunks=[],e._prevProgress=0;for(var a=e.getOpt("forceChunkSize")?Math.ceil:Math.floor,b=Math.max(a(e.file.size/e.getOpt("chunkSize")),1),c=0;b>c;c++)!function(a){window.setTimeout(function(){e.chunks.push(new d(e.resumableObj,e,a,h)),e.resumableObj.fire("chunkingProgress",e,a/b)},0)}(c);window.setTimeout(function(){e.resumableObj.fire("chunkingComplete",e)},0)},e.progress=function(){if(g)return 1;var a=0,b=!1;return f.each(e.chunks,function(c){"error"==c.status()&&(b=!0),a+=c.progress(!0)}),a=b?1:a>.99999?1:a,a=Math.max(e._prevProgress,a),e._prevProgress=a,a},e.isUploading=function(){var a=!1;return f.each(e.chunks,function(b){return"uploading"==b.status()?(a=!0,!1):void 0}),a},e.isComplete=function(){var a=!1;return f.each(e.chunks,function(b){var c=b.status();return"pending"==c||"uploading"==c||1===b.preprocessState?(a=!0,!1):void 0}),!a},e.pause=function(a){e._pause="undefined"==typeof a?e._pause?!1:!0:a},e.isPaused=function(){return e._pause},e.resumableObj.fire("chunkingStart",e),e.bootstrap(),this}function d(a,b,c,d){var e=this;e.opts={},e.getOpt=a.getOpt,e.resumableObj=a,e.fileObj=b,e.fileObjSize=b.size,e.fileObjType=b.file.type,e.offset=c,e.callback=d,e.lastProgressCallback=new Date,e.tested=!1,e.retries=0,e.pendingRetry=!1,e.preprocessState=0;var g=e.getOpt("chunkSize");return e.loaded=0,e.startByte=e.offset*g,e.endByte=Math.min(e.fileObjSize,(e.offset+1)*g),e.fileObjSize-e.endByte<g&&!e.getOpt("forceChunkSize")&&(e.endByte=e.fileObjSize),e.xhr=null,e.test=function(){e.xhr=new XMLHttpRequest;var a=function(){e.tested=!0;var a=e.status();"success"==a?(e.callback(a,e.message()),e.resumableObj.uploadNextChunk()):e.send()};e.xhr.addEventListener("load",a,!1),e.xhr.addEventListener("error",a,!1),e.xhr.addEventListener("timeout",a,!1);var b=[],c=e.getOpt("parameterNamespace"),d=e.getOpt("query");"function"==typeof d&&(d=d(e.fileObj,e)),f.each(d,function(a,d){b.push([encodeURIComponent(c+a),encodeURIComponent(d)].join("="))}),b.push([c+"resumableChunkNumber",encodeURIComponent(e.offset+1)].join("=")),b.push([c+"resumableChunkSize",encodeURIComponent(e.getOpt("chunkSize"))].join("=")),b.push([c+"resumableCurrentChunkSize",encodeURIComponent(e.endByte-e.startByte)].join("=")),b.push([c+"resumableTotalSize",encodeURIComponent(e.fileObjSize)].join("=")),b.push([c+"resumableType",encodeURIComponent(e.fileObjType)].join("=")),b.push([c+"resumableIdentifier",encodeURIComponent(e.fileObj.uniqueIdentifier)].join("=")),b.push([c+"resumableFilename",encodeURIComponent(e.fileObj.fileName)].join("=")),b.push([c+"resumableRelativePath",encodeURIComponent(e.fileObj.relativePath)].join("=")),b.push([c+"resumableTotalChunks",encodeURIComponent(e.fileObj.chunks.length)].join("=")),e.xhr.open(e.getOpt("testMethod"),f.getTarget(b)),e.xhr.timeout=e.getOpt("xhrTimeout"),e.xhr.withCredentials=e.getOpt("withCredentials"),f.each(e.getOpt("headers"),function(a,b){e.xhr.setRequestHeader(a,b)}),e.xhr.send(null)},e.preprocessFinished=function(){e.preprocessState=2,e.send()},e.send=function(){var a=e.getOpt("preprocess");if("function"==typeof a)switch(e.preprocessState){case 0:return e.preprocessState=1,a(e),void 0;case 1:return;case 2:}if(e.getOpt("testChunks")&&!e.tested)return e.test(),void 0;e.xhr=new XMLHttpRequest,e.xhr.upload.addEventListener("progress",function(a){new Date-e.lastProgressCallback>1e3*e.getOpt("throttleProgressCallbacks")&&(e.callback("progress"),e.lastProgressCallback=new Date),e.loaded=a.loaded||0},!1),e.loaded=0,e.pendingRetry=!1,e.callback("progress");var b=function(){var a=e.status();if("success"==a||"error"==a)e.callback(a,e.message()),e.resumableObj.uploadNextChunk();else{e.callback("retry",e.message()),e.abort(),e.retries++;var b=e.getOpt("chunkRetryInterval");void 0!==b?(e.pendingRetry=!0,setTimeout(e.send,b)):e.send()}};e.xhr.addEventListener("load",b,!1),e.xhr.addEventListener("error",b,!1),e.xhr.addEventListener("timeout",b,!1);var c={resumableChunkNumber:e.offset+1,resumableChunkSize:e.getOpt("chunkSize"),resumableCurrentChunkSize:e.endByte-e.startByte,resumableTotalSize:e.fileObjSize,resumableType:e.fileObjType,resumableIdentifier:e.fileObj.uniqueIdentifier,resumableFilename:e.fileObj.fileName,resumableRelativePath:e.fileObj.relativePath,resumableTotalChunks:e.fileObj.chunks.length},d=e.getOpt("query");"function"==typeof d&&(d=d(e.fileObj,e)),f.each(d,function(a,b){c[a]=b});var g=e.fileObj.file.slice?"slice":e.fileObj.file.mozSlice?"mozSlice":e.fileObj.file.webkitSlice?"webkitSlice":"slice",h=e.fileObj.file[g](e.startByte,e.endByte),i=null,j=e.getOpt("target"),k=e.getOpt("parameterNamespace");if("octet"===e.getOpt("method")){i=h;var l=[];f.each(c,function(a,b){l.push([encodeURIComponent(k+a),encodeURIComponent(b)].join("="))}),j=f.getTarget(l)}else i=new FormData,f.each(c,function(a,b){i.append(k+a,b)}),i.append(k+e.getOpt("fileParameterName"),h);var m=e.getOpt("uploadMethod");e.xhr.open(m,j),"octet"===e.getOpt("method")&&e.xhr.setRequestHeader("Content-Type","binary/octet-stream"),e.xhr.timeout=e.getOpt("xhrTimeout"),e.xhr.withCredentials=e.getOpt("withCredentials"),f.each(e.getOpt("headers"),function(a,b){e.xhr.setRequestHeader(a,b)}),e.xhr.send(i)},e.abort=function(){e.xhr&&e.xhr.abort(),e.xhr=null},e.status=function(){return e.pendingRetry?"uploading":e.xhr?e.xhr.readyState<4?"uploading":e.xhr.status>=200&&e.xhr.status<300?"success":f.contains(e.getOpt("permanentErrors"),e.xhr.status)||e.retries>=e.getOpt("maxChunkRetries")?"error":(e.abort(),"pending"):"pending"},e.message=function(){return e.xhr?e.xhr.responseText:""},e.progress=function(a){"undefined"==typeof a&&(a=!1);var b=a?(e.endByte-e.startByte)/e.fileObjSize:1;if(e.pendingRetry)return 0;var c=e.status();switch(c){case"success":case"error":return 1*b;case"pending":return 0*b;default:return e.loaded/(e.endByte-e.startByte)*b}},this}if(!(this instanceof a))return new a(b);if(this.version=1,this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),!this.support)return!1;var e=this;e.files=[],e.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:void 0,chunkRetryInterval:void 0,permanentErrors:[400,404,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,maxFilesErrorCallback:function(){var a=e.getOpt("maxFiles");alert("Please upload "+a+" file"+(1===a?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(a){alert(a.fileName||a.name+" is too small, please upload files larger than "+f.formatSize(e.getOpt("minFileSize"))+".")},maxFileSize:void 0,maxFileSizeErrorCallback:function(a){alert(a.fileName||a.name+" is too large, please upload files less than "+f.formatSize(e.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(a){alert(a.fileName||a.name+" has type not allowed, please upload files of type "+e.getOpt("fileType")+".")}},e.opts=b||{},e.getOpt=function(b){var e=this;if(b instanceof Array){var g={};return f.each(b,function(a){g[a]=e.getOpt(a)}),g}if(e instanceof d){if("undefined"!=typeof e.opts[b])return e.opts[b];e=e.fileObj}if(e instanceof c){if("undefined"!=typeof e.opts[b])return e.opts[b];e=e.resumableObj}return e instanceof a?"undefined"!=typeof e.opts[b]?e.opts[b]:e.defaults[b]:void 0},e.events=[],e.on=function(a,b){e.events.push(a.toLowerCase(),b)},e.fire=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);for(var c=a[0].toLowerCase(),b=0;b<=e.events.length;b+=2)e.events[b]==c&&e.events[b+1].apply(e,a.slice(1)),"catchall"==e.events[b]&&e.events[b+1].apply(null,a);"fileerror"==c&&e.fire("error",a[2],a[1]),"fileprogress"==c&&e.fire("progress")};var f={stopEvent:function(a){a.stopPropagation(),a.preventDefault()},each:function(a,b){if("undefined"!=typeof a.length){for(var c=0;c<a.length;c++)if(b(a[c])===!1)return}else for(c in a)if(b(c,a[c])===!1)return},generateUniqueIdentifier:function(a){var b=e.getOpt("generateUniqueIdentifier");if("function"==typeof b)return b(a);var c=a.webkitRelativePath||a.fileName||a.name,d=a.size;return d+"-"+c.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(a,b){var c=!1;return f.each(a,function(a){return a==b?(c=!0,!1):!0}),c},formatSize:function(a){return 1024>a?a+" bytes":1048576>a?(a/1024).toFixed(0)+" KB":1073741824>a?(a/1024/1024).toFixed(1)+" MB":(a/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(a){var b=e.getOpt("target");return"function"==typeof b?b(a):(b+=b.indexOf("?")<0?"?":"&",b+a.join("&"))}},g=function(a){f.stopEvent(a),a.dataTransfer&&a.dataTransfer.items?i(a.dataTransfer.items,a):a.dataTransfer&&a.dataTransfer.files&&i(a.dataTransfer.files,a)},h=function(a){a.preventDefault()},i=function(a,b,c,d){c||(c={total:0,files:[],event:b}),j(a.length,c);for(var e=0;e<a.length;e++){var f,g,h=a[e];if(h.isFile||h.isDirectory)f=h;else if(h.getAsEntry)f=h.getAsEntry();else{if(!h.webkitGetAsEntry){if("function"==typeof h.getAsFile){k(h.getAsFile(),c,d);continue}if(File&&h instanceof File){k(h,c,d);continue}j(-1,c);continue}f=h.webkitGetAsEntry()}if(f){if(f.isFile)f.file(function(a){k(a,c,d)},function(a){console.warn(a)});else if(f.isDirectory){g=f.createReader()}}else j(-1,c)}},j=function(a,b){b.total+=a,b.files.length===b.total&&l(b.files,b.event)},k=function(a,b,c){c&&(a.relativePath=c+"/"+a.name),b.files.push(a),b.files.length===b.total&&l(b.files,b.event)},l=function(a,b){var d=0,g=e.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if("undefined"!=typeof g.maxFiles&&g.maxFiles<a.length+e.files.length){if(1!==g.maxFiles||1!==e.files.length||1!==a.length)return g.maxFilesErrorCallback(a,d++),!1;e.removeFile(e.files[0])}var h=[];f.each(a,function(a){function i(d){e.getFromUniqueIdentifier(d)||!function(){a.uniqueIdentifier=d;var f=new c(e,a,d);e.files.push(f),h.push(f),f.container="undefined"!=typeof b?b.srcElement:null,window.setTimeout(function(){e.fire("fileAdded",f,b)},0)}()}var j=a.name;if(g.fileType.length>0){var k=!1;for(var l in g.fileType){var m="."+g.fileType[l];if(-1!==j.indexOf(m,j.length-m.length)){k=!0;break}}if(!k)return g.fileTypeErrorCallback(a,d++),!1}if("undefined"!=typeof g.minFileSize&&a.size<g.minFileSize)return g.minFileSizeErrorCallback(a,d++),!1;if("undefined"!=typeof g.maxFileSize&&a.size>g.maxFileSize)return g.maxFileSizeErrorCallback(a,d++),!1;var n=f.generateUniqueIdentifier(a);n&&"function"==typeof n.done&&"function"==typeof n.fail?n.done(function(a){i(a)}).fail(function(){i()}):i(n)}),window.setTimeout(function(){e.fire("filesAdded",h)},0)};return e.uploadNextChunk=function(){var a=!1;if(e.getOpt("prioritizeFirstAndLastChunk")&&(f.each(e.files,function(b){return b.chunks.length&&"pending"==b.chunks[0].status()&&0===b.chunks[0].preprocessState?(b.chunks[0].send(),a=!0,!1):b.chunks.length>1&&"pending"==b.chunks[b.chunks.length-1].status()&&0===b.chunks[b.chunks.length-1].preprocessState?(b.chunks[b.chunks.length-1].send(),a=!0,!1):void 0}),a))return!0;if(f.each(e.files,function(b){return b.isPaused()===!1&&f.each(b.chunks,function(b){return"pending"==b.status()&&0===b.preprocessState?(b.send(),a=!0,!1):void 0}),a?!1:void 0}),a)return!0;var b=!1;return f.each(e.files,function(a){return a.isComplete()?void 0:(b=!0,!1)}),b||e.fire("complete"),!1},e.assignBrowse=function(a,b){"undefined"==typeof a.length&&(a=[a]),f.each(a,function(a){var c;"INPUT"===a.tagName&&"file"===a.type?c=a:(c=document.createElement("input"),c.setAttribute("type","file"),c.style.display="none",a.addEventListener("click",function(){c.style.opacity=0,c.style.display="block",c.focus(),c.click(),c.style.display="none"},!1),a.appendChild(c));var d=e.getOpt("maxFiles");"undefined"==typeof d||1!=d?c.setAttribute("multiple","multiple"):c.removeAttribute("multiple"),b?c.setAttribute("webkitdirectory","webkitdirectory"):c.removeAttribute("webkitdirectory"),c.addEventListener("change",function(a){l(a.target.files,a),a.target.value=""},!1)})},e.assignDrop=function(a){"undefined"==typeof a.length&&(a=[a]),f.each(a,function(a){a.addEventListener("dragover",h,!1),a.addEventListener("dragenter",h,!1),a.addEventListener("drop",g,!1)})},e.unAssignDrop=function(a){"undefined"==typeof a.length&&(a=[a]),f.each(a,function(a){a.removeEventListener("dragover",h),a.removeEventListener("dragenter",h),a.removeEventListener("drop",g)})},e.isUploading=function(){var a=!1;return f.each(e.files,function(b){return b.isUploading()?(a=!0,!1):void 0}),a},e.upload=function(){if(!e.isUploading()){e.fire("uploadStart");for(var a=1;a<=e.getOpt("simultaneousUploads");a++)e.uploadNextChunk()}},e.pause=function(){f.each(e.files,function(a){a.abort()}),e.fire("pause")},e.cancel=function(){for(var a=e.files.length-1;a>=0;a--)e.files[a].cancel();e.fire("cancel")},e.progress=function(){var a=0,b=0;return f.each(e.files,function(c){a+=c.progress()*c.size,b+=c.size}),b>0?a/b:0},e.addFile=function(a,b){l([a],b)},e.removeFile=function(a){for(var b=e.files.length-1;b>=0;b--)e.files[b]===a&&e.files.splice(b,1)},e.getFromUniqueIdentifier=function(a){var b=!1;
return f.each(e.files,function(c){c.uniqueIdentifier==a&&(b=c)}),b},e.getSize=function(){var a=0;return f.each(e.files,function(b){a+=b.size}),a},this};"undefined"!=typeof module?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.Resumable=a}(),function(){var a=this.subScope();a.binding("module","global:BetaJS.Browser"),a.binding("base","global:BetaJS"),a.binding("jquery","global:jQuery"),a.binding("json","global:JSON"),a.binding("resumablejs","global:Resumable"),a.define("base:$",["jquery:"],function(a){return a}),a.define("module:",function(){return{guid:"02450b15-9bbf-4be2-b8f6-b483bc015d06",version:"33.1437514518260"}}),a.define("module:JQueryAjax",["base:Net.AbstractAjax","base:Net.AjaxException","base:Promise","module:Info","jquery:"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(){return{_syncCall:function(a){var c;return e.ajax({type:a.method,async:!1,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){c=a},error:function(a,c,d){var e="";try{e=JSON.parse(a.responseText)}catch(f){e=JSON.parse('"'+a.responseText+'"')}throw new b(a.status,d,e)}}),c},_asyncCall:function(a){var f=c.create();return d.isInternetExplorer()&&d.internetExplorerVersion()<=9&&(e.support.cors=!0),e.ajax({type:a.method,async:!0,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){f.asyncSuccess(a)},error:function(a,c,d){var e="";try{e=JSON.parse(a.responseText)}catch(g){e=JSON.parse('"'+a.responseText+'"')}f.asyncError(new b(a.status,d,e))}}),f}}})}),a.define("module:Cookies",["base:Strings"],function(a){return{get:function(b){return a.read_cookie_string(document.cookie,b)},set:function(b,c){document.cookie=a.write_cookie_string(document.cookie,b,c)}}}),a.define("module:Dom",["base:Objs","jquery:"],function(a,b){return{changeTag:function(a,b){for(var c=document.createElement(b),d=0;d<a.attributes.length;++d)c.setAttribute(a.attributes[d].nodeName,a.attributes[d].nodeValue);for(;a.firstChild;)c.appendChild(a.firstChild);return a.parentNode.replaceChild(c,a),c},traverseNext:function(a,c){return"get"in a&&(a=a.get(0)),a.firstChild&&!c?b(a.firstChild):a.parentNode?a.nextSibling?b(a.nextSibling):this.traverseNext(a.parentNode,!0):null},selectNode:function(a,c){a=b(a).get(0);var d=null,e=null;window.getSelection?(d=window.getSelection(),d.removeAllRanges(),e=document.createRange()):document.selection&&(d=document.selection,e=d.createRange()),c?(e.setStart(a,c),e.setEnd(a,c),d.addRange(e)):(e.selectNode(a),d.addRange(e))},selectionStartNode:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).startContainer):document.selection?b(document.selection.createRange().startContainer):null},selectedHtml:function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().htmlText:""},selectionAncestor:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).commonAncestorContainer):document.selection?b(document.selection.createRange().parentElement()):null},selectionStartOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).startOffset:document.selection?document.selection.createRange().startOffset:null},selectionEndOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).endOffset:document.selection?document.selection.createRange().endOffset:null},selectionStart:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).startContainer):document.selection?b(document.selection.createRange().startContainer):null},selectionEnd:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).endContainer):document.selection?b(document.selection.createRange().endContainer):null},selectionNonEmpty:function(){var a=this.selectionStart(),b=this.selectionEnd();return a&&b&&a.get(0)&&b.get(0)&&(a.get(0)!=b.get(0)||this.selectionStartOffset()!=this.selectionEndOffset())},selectionContained:function(a){return a.has(this.selectionStart()).length>0&&a.has(this.selectionEnd()).length>0},selectionNodes:function(){var a=[],b=this.selectionStart(),c=this.selectionEnd();a.push(b);for(var d=b;d.get(0)!=c.get(0);)d=this.traverseNext(d),a.push(d);return a},selectionLeaves:function(){return a.filter(this.selectionNodes(),function(a){return 0===a.children().length})},contentSiblings:function(a){return a.parent().contents().filter(function(){return this!=a.get(0)})},remove_tag_from_parent_path:function(a,c,d){c=c.toLowerCase(),a=b(a);for(var e=a.parents(d?d+" "+c:c),f=0;f<e.length;++f){var g=e.get(f);for(g=b(g);a.get(0)!=g.get(0);)this.contentSiblings(a).wrap("<"+c+"></"+c+">"),a=a.parent();g.contents().unwrap()}},selectionSplitOffsets:function(){var a=this.selectionStartOffset(),c=this.selectionEndOffset(),d=this.selectionStart(),e=this.selectionEnd(),f=d.get(0)==e.get(0);if(c<e.get(0).wholeText.length){var g=e.get(0);g.splitText(c),e=b(g),f&&(d=e)}a>0&&(d=b(d.get(0).splitText(a)),f&&(e=d)),this.selectRange(d,e)},selectRange:function(a,c,d,e){a=b(a),c=b(c);var f=null,g=null;window.getSelection?(f=window.getSelection(),f.removeAllRanges(),g=document.createRange()):document.selection&&(f=document.selection,g=f.createRange()),g.setStart(a.get(0),d||0),g.setEnd(c.get(0),e||c.get(0).data.length),f.addRange(g)},splitNode:function(a,c,d){if(a=b(a),c=c||0,d=d||a.get(0).data.length,d<a.get(0).data.length){var e=a.get(0);e.splitText(d),a=b(e)}return c>0&&(a=b(a.get(0).splitText(c))),a}}}),a.define("module:FlashDetect",["base:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(){if(a.constructor.call(this),this.__version=null,navigator.plugins&&navigator.plugins.length>0){var b="application/x-shockwave-flash",c=navigator.mimeTypes;c&&c[b]&&c[b].enabledPlugin&&c[b].enabledPlugin.description&&(this.__version=this.parseVersion(c[b].enabledPlugin.description))}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var d=0;d<this.__activeXDetectRules.length;d++)try{var e=new ActiveXObject(this.__activeXDetectRules[d].name),f=this.__activeXDetectRules[d].version(e);if(f){this.__version=this.parseActiveXVersion(f);break}}catch(g){}},parseVersion:function(a){var b=a.split(/ +/),c=b[2].split(/\./),d=b[3];return{raw:a,major:parseInt(c[0],10),minor:parseInt(c[1],10),revisionStr:d,revision:parseInt(d.replace(/[a-zA-Z]/g,""),10)}},parseActiveXVersion:function(a){var b=a.split(",");return{raw:a,major:parseInt(b[0].split(" ")[1],10),minor:parseInt(b[1],10),revision:parseInt(b[2],10),revisionStr:b[2]}},version:function(){return this.__version},installed:function(){return null!==this.__version},supported:function(){var a=navigator.userAgent;return this.installed()||!(-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad"))},majorAtLeast:function(a){return this.installed()&&this.version().major>=a},minorAtLeast:function(a){return this.installed()&&this.version().minor>=a},revisionAtLeast:function(a){return this.installed()&&this.version().revision>=a},versionAtLeast:function(){if(!this.installed())return!1;for(var a=[this.version().major,this.version().minor,this.version().revision],b=Math.min(a.length,arguments.length),c=0;b>c;c++)if(a[c]!=arguments[c])return a[c]>arguments[c];return!0},__activeXDetectRules:[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(a){try{a.AllowScriptAccess="always";try{return a.GetVariable("$version")}catch(b){return null}}catch(b){return"6,0,21"}}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}}]}})}),a.define("module:FlashHelper",["base:Time","base:Objs","base:Types","base:Net.Uri","module:Info","jquery:"],function(a,b,c,d,e,f){return{getFlashObject:function(a){var b=f(a).find("embed").get(0);if(e.isInternetExplorer()&&e.internetExplorerVersion()<=10&&(b=null),b||(b=f(a).find("object").get(0)),!b)for(var c=f("object"),d=0;d<c.length;++d)f(c[d]).closest(a).length>0&&(b=f(c[d]).get(0));return b},embedTemplate:function(e){e=e||{};var f=[];f.push({objectKey:"classid",value:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}),f.push({objectKey:"codebase",value:"http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab"}),f.push({embedKey:"align",value:"middle"}),f.push({embedKey:"play",value:"true"}),f.push({embedKey:"loop",value:"false"}),f.push({embedKey:"type",value:"application/x-shockwave-flash"}),f.push({embedKey:"pluginspage",value:"http://www.adobe.com/go/getflashplayer"}),f.push({objectParam:"quality",embedKey:"quality",value:"high"}),f.push({objectParam:"allowScriptAccess",embedKey:"allowScriptAccess",value:"always"}),f.push({objectParam:"wmode",embedKey:"wmode",value:"opaque"}),f.push({objectParam:"movie",embedKey:"src",value:e.flashFile+(e.forceReload?"?"+a.now():"")}),e.width&&f.push({objectKey:"width",embedKey:"width",value:e.width}),e.height&&f.push({objectKey:"height",embedKey:"height",value:e.height}),e.bgcolor&&f.push({objectParam:"bgcolor",embedKey:"bgcolor",value:e.bgcolor}),e.FlashVars&&f.push({objectParam:"FlashVars",embedKey:"FlashVars",value:c.is_object(e.FlashVars)?d.encodeUriParams(e.FlashVars):e.FlashVars}),e.objectId&&f.push({objectKey:"id",value:e.objectId});var g=[],h=[],i=[];return b.iter(f,function(a){a.objectKey&&g.push(a.objectKey+'="'+a.value+'"'),a.embedKey&&i.push(a.embedKey+'="'+a.value+'"'),a.objectParam&&h.push('<param name="'+a.objectParam+'" value="'+a.value+'" />')},this),"<object "+g.join(" ")+">"+h.join(" ")+"<embed "+i.join(" ")+"></embed></object>"},embedFlashObject:function(a,b){if(b&&b.parentBgcolor)try{var c=f(a).css("background-color");if(c.indexOf("rgb")>=0){var d=c.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),e=function(a){return("0"+parseInt(a,10).toString(16)).slice(-2)};d&&d.length>3&&(c="#"+e(d[1])+e(d[2])+e(d[3]))}b.bgcolor=c}catch(g){}return f(a).html(this.embedTemplate(b)),this.getFlashObject(a)}}}),a.define("module:Hotkeys",["base:Objs","jquery:"],function(a,b){return{SHIFT_NUMS:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},SPECIAL_KEYS:{esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},MODIFIERS:["ctrl","alt","shift","meta"],keyCodeToCharacter:function(a){return 188==a?",":190==a?".":String.fromCharCode(a).toLowerCase()},register:function(c,d,e,f){var g=this;f=a.extend({type:"keyup",propagate:!1,disable_in_input:!1,target:document,keycode:!1},f),f.target=b(f.target);var h=c.toLowerCase().split("+"),i=function(b){if(f.disable_in_input){var c=b.target||b.srcElement||null;if(c&&3==c.nodeType&&(c=c.parentNode),c&&("INPUT"==c.tagName||"TEXTAREA"==c.tagName))return}var i=b.keyCode||b.which||0,j=g.keyCodeToCharacter(i),k=0,l={};a.iter(g.MODIFIERS,function(a){l[a]={pressed:b[a+"Key"],wanted:!1}},this),a.iter(h,function(a){a in l?(l[a].wanted=!0,k++):a.length>1?g.SPECIAL_KEYS[a]==i&&k++:f.keycode?f.keycode==i&&k++:(j==a||b.shiftKey&&g.SHIFT_NUMS[j]==a)&&k++},this),k==h.length&&a.all(l,function(a){return a.wanted==a.pressed})&&(d.apply(e||this),f.propagate||b.preventDefault())};return f.target.on(f.type,i),{target:f.target,type:f.type,func:i}},unregister:function(a){a.target.off(a.type,a.func)}}}),a.define("module:Info",["base:Objs","module:FlashDetect"],function(a,b){return{__navigator:null,getNavigator:function(){return this.__navigator||(this.__navigator={appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent,window_chrome:"chrome"in window,window_opera:"opera"in window}),this.__navigator},__cache:{},__cached:function(a,b){if(!(a in this.__cache)){var c=this.getNavigator();this.__cache[a]=b.call(this,c,c.userAgent,c.userAgent.toLowerCase())}return this.__cache[a]},setNavigator:function(a){this.__navigator=a,this.__cache={}},flash:function(){return this.__cached("flash",function(){return new b})},isiOS:function(){return this.__cached("isiOS",function(a,b){return this.isInternetExplorer()?!1:-1!=b.indexOf("iPhone")||-1!=b.indexOf("iPod")||-1!=b.indexOf("iPad")})},isChrome:function(){return this.__cached("isChrome",function(a,b){return(a.window_chrome||-1!=b.indexOf("CriOS"))&&!this.isOpera()})},isOpera:function(){return this.__cached("isOpera",function(a,b){return a.window_opera||b.indexOf(" OPR/")>=0||b.indexOf("OPiOS")>=0})},isAndroid:function(){return this.__cached("isAndroid",function(a,b,c){return-1!=c.indexOf("android")})},isWebOS:function(){return this.__cached("isWebOS",function(a,b,c){return-1!=c.indexOf("webos")})},isWindowsPhone:function(){return this.__cached("isWindowsPhone",function(a,b,c){return-1!=c.indexOf("windows phone")})},isBlackberry:function(){return this.__cached("isBlackberry",function(a,b,c){return-1!=c.indexOf("blackberry")})},iOSversion:function(){return this.__cached("iOSversion",function(a){if(!this.isiOS())return!1;var b=a.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return{major:parseInt(b[1],10),minor:parseInt(b[2],10),revision:parseInt(b[3]||0,10)}})},isMobile:function(){return this.__cached("isMobile",function(){return this.isiOS()||this.isAndroid()||this.isWebOS()||this.isWindowsPhone()||this.isBlackberry()})},isDesktop:function(){return this.__cached("isDesktop",function(){return!this.isMobile()})},isInternetExplorer:function(){return this.__cached("isInternetExplorer",function(){return null!==this.internetExplorerVersion()})},isFirefox:function(){return this.__cached("isFirefox",function(a,b,c){return-1!=c.indexOf("firefox")})},isSafari:function(){return this.__cached("isSafari",function(a,b,c){return!this.isChrome()&&!this.isOpera()&&-1!=c.indexOf("safari")})},isWindows:function(){return this.__cached("isWindows",function(a){return-1!=a.appVersion.toLowerCase().indexOf("win")})},isMacOS:function(){return this.__cached("isMacOS",function(a){return!this.isiOS()&&-1!=a.appVersion.toLowerCase().indexOf("mac")})},isUnix:function(){return this.__cached("isUnix",function(a){return-1!=a.appVersion.toLowerCase().indexOf("x11")})},isLinux:function(){return this.__cached("isLinux",function(a){return!this.isAndroid()&&-1!=a.appVersion.toLowerCase().indexOf("linux")})},internetExplorerVersion:function(){return this.__cached("internetExplorerVersion",function(a,b){if("Microsoft Internet Explorer"==a.appName){var c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),d=c.exec(b);if(d)return d[1]}else if("Netscape"==a.appName){var e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),f=e.exec(a.userAgent);if(f)return parseFloat(f[1])}return null})},inIframe:function(){try{return window.self!==window.top}catch(a){return!0}},__devicesMap:{mobile:{format:"Mobile",check:function(){return this.isMobile()}},desktop:{format:"Desktop",check:function(){return this.isDesktop()}}},__obtainMatch:function(b,c){var d=null;return a.iter(b,function(b,c){if(b.check.apply(this)){if(d)return d=null,!1;d=a.clone(b,1),delete d.check,d.key=c}},this),d||c},getDevice:function(){return this.__cached("getDevice",function(){return this.__obtainMatch(this.__devicesMap,{key:"unknown",format:"Unknown Device"})})},formatDevice:function(){return this.getDevice().format},__osMap:{macosx:{format:"Mac OS-X",check:function(){return this.isMacOS()}},windows:{format:"Windows",check:function(){return this.isWindows()}},unix:{format:"Unix",check:function(){return this.isUnix()}},linux:{format:"Linux",check:function(){return this.isLinux()}},ios:{format:"iOS",check:function(){return this.isiOS()},version:function(){return this.iOSversion().major+"."+this.iOSversion().minor+"."+this.iOSversion().revision}},android:{format:"Android",check:function(){return this.isAndroid()}},webos:{format:"WebOS",check:function(){return this.isWebOS()}},windowsphone:{format:"Windows Phone",check:function(){return this.isWindowsPhone()}},blackberry:{format:"Blackberry",check:function(){return this.isBlackberry()}}},getOS:function(){return this.__cached("getOS",function(){return this.__obtainMatch(this.__osMap,{key:"unknown",format:"Unknown Operating System"})})},formatOS:function(){return this.getOS().format},formatOSVersion:function(){return this.getOS().version?this.getOS().version.apply(this):""},__browserMap:{chrome:{format:"Chrome",check:function(){return this.isChrome()}},opera:{format:"Opera",check:function(){return this.isOpera()}},internetexplorer:{format:"Internet Explorer",check:function(){return this.isInternetExplorer()},version:function(){return this.internetExplorerVersion()}},firefox:{format:"Firefox",check:function(){return this.isFirefox()}},safari:{format:"Safari",check:function(){return this.isSafari()}},android:{format:"Android",check:function(){return this.isAndroid()&&!this.isChrome()}},webos:{format:"WebOS",check:function(){return this.isWebOS()}},windowsphone:{format:"Windows Phone",check:function(){return this.isWindowsPhone()}},blackberry:{format:"Blackberry",check:function(){return this.isBlackberry()}}},getBrowser:function(){return this.__cached("getBrowser",function(){return this.__obtainMatch(this.__browserMap,{key:"unknown",format:"Unknown Browser"})})},formatBrowser:function(){return this.getBrowser().format},formatBrowserVersion:function(){return this.getBrowser().version?this.getBrowser().version.apply(this):""},formatFlash:function(){return this.flash().installed()?"Flash "+this.flash().version().raw:this.flash().supported()?"Flash not installed but supported":"Flash not supported"}}}),a.define("module:Loader",["jquery:"],function(a){return{loadScript:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.src=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.call(c||this,a))},e.appendChild(f)},loadStyles:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("link");f.rel="stylesheet",f.href=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.call(c||this,a))},e.appendChild(f)},inlineStyles:function(b){a("<style>"+b+"</style>").appendTo("head")},loadHtml:function(b,c,d){a.ajax({url:b,dataType:"html"}).done(function(a){c.call(d||this,a,b)})},findScript:function(a){for(var b=0;b<document.scripts.length;++b)if(document.scripts[b].src.toLowerCase().indexOf(a.toLowerCase())>=0)return document.scripts[b];return null}}}),a.define("module:HashRouteBinder",["base:Router.RouteBinder","jquery:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,c);var d=this;b(window).on("hashchange.events"+this.cid(),function(){d._localRouteChanged()})},destroy:function(){b(window).off("hashchange.events"+this.cid()),a.destroy.call(this)},_getLocalRoute:function(){var a=window.location.hash;return a.length&&"#"==a[0]?a.slice(1):a},_setLocalRoute:function(a){window.location.hash="#"+a.route}}})}),a.define("module:HistoryRouteBinder",["base:Router.RouteBinder","jquery:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,c);var d=this;this.__used=!1,b(window).on("popstate.events"+this.cid(),function(){d.__used&&d._localRouteChanged()})},destroy:function(){b(window).off("popstate.events"+this.cid()),a.destroy.call(this)},_getLocalRoute:function(){return window.location.pathname},_setLocalRoute:function(a){window.history.pushState({},document.title,a.route),this.__used=!0}}},{supported:function(){return window.history&&window.history.pushState}})}),a.define("module:LocationRouteBinder",["base:Router.RouteBinder"],function(a,b){return a.extend({scoped:b},{_getLocalRoute:function(){return window.location.pathname},_setLocalRoute:function(a){window.location.pathname=a.route}})}),a.define("module:Upload.FileUploader",["base:Classes.ConditionalInstance","base:Events.EventsMixin","base:Objs","base:Types"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this,b),this._uploading=!1},upload:function(){return this._uploading=!0,this._options.resilience--,this._upload(),this.trigger("uploading"),this},_upload:function(){},_progressCallback:function(a,b){this.trigger("progress",a,b)},_successCallback:function(a){this._uploading=!1,this.trigger("success",a)},_errorCallback:function(a){this._uploading=!1,this.trigger("error",a),this._options.resilience>0&&this.upload()}}}],{_initializeOptions:function(a){return a=a||{},c.extend({serverSupportChunked:!1,serverSupportPostMessage:!1,isBlob:"undefined"!=typeof Blob&&a.source instanceof Blob,resilience:1},a)}})}),a.define("module:Upload.MultiUploader",["module:Upload.FileUploader","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this,b),this._uploaders={},this._count=0,this._success=0,this._total=0,this._uploaded=0},addUploader:function(a){var b={uploader:a,success:!1,data:null,uploaded:null,total:null};this._uploaders[a.cid()]=b,this._count++,a.on("success",function(a){this._success++,b.success=!0,b.data=a,this._checkDone()},this).on("error",function(a){this._error++,b.success=!1,b.data=a,this._checkDone()},this).on("progress",function(a,c){null===b.uploaded&&(b.uploaded=0,b.total=c,this._total+=c),this._uploaded+=a-b.uploaded,b.uploaded=a,this._progressCallback(this._uploaded,this._total)},this)},_upload:function(){this._error=0,b.iter(this._uploaders,function(a){a.success||(this._uploaded-=a.uploaded,this._total-=a.total,a.uploaded=null,a.uploader.upload())},this)},_checkDone:function(){if(this._success+this._error==this._count){var a=[];b.iter(this._uploaders,function(b){a.push(b.data)},this),0===this._error?this._successCallback(a):this._errorCallback(a)}}}})}),a.define("module:Upload.FormDataFileUploader",["module:Upload.FileUploader","module:Info","jquery:"],function(a,b,c,d){var e=a.extend({scoped:d},{_upload:function(){var a=this,b=new FormData;b.append("file",this._options.isBlob?this._options.source:this._options.source.files[0]),c.ajax({type:"POST",async:!0,url:this._options.url,data:b,cache:!1,contentType:!1,processData:!1,xhr:function(){var b=c.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(b){b.lengthComputable&&a._progressCallback(b.loaded,b.total)},!1),b}}).success(function(b){a._successCallback(b)}).error(function(b){a._errorCallback(b)})}},{supported:function(){if(b.isInternetExplorer()&&b.internetExplorerVersion()<=9)return!1;try{new FormData}catch(a){return!1}return!0}});return a.register(e,2),e}),a.define("module:Upload.FormIframeFileUploader",["module:Upload.FileUploader","jquery:","base:Net.Uri","json:"],function(a,b,c,d,e){var f=a.extend({scoped:e},{_upload:function(){var a=this,e=document.createElement("iframe"),f="upload-iframe-"+this.cid();e.id=f,e.name=f,e.style.display="none";var g=document.createElement("form");g.method="POST",g.target=f,g.style.display="none",document.body.appendChild(e),document.body.appendChild(g);var h=this._options.source.parent;g.appendChild(this._options.source);var i=!("postMessage"in window);e.onerror=function(){i&&(window.postMessage=null),b(window).off("message."+a.cid()),h&&h.appendChild(this._options.source),document.body.removeChild(g),document.body.removeChild(e),a._errorCallback()},g.action=c.appendUriParams(this._options.url,{_postmessage:!0}),g.encoding=g.enctype="multipart/form-data";var j=function(c){i&&(window.postMessage=null),b(window).off("message."+a.cid()),h&&h.appendChild(this._options.source);var f=d.parse(c);document.body.removeChild(g),document.body.removeChild(e),a._successCallback(f)};b(window).on("message."+this.cid(),function(a){j(a.originalEvent.data)}),i&&(window.postMessage=j),g.submit()}},{supported:function(a){return!a.isBlob&&a.serverSupportPostMessage}});return a.register(f,1),f}),a.define("module:Upload.ResumableFileUploader",["module:Upload.FileUploader","resumablejs:","base:Async","base:Objs","jquery:"],function(a,b,c,d,e,f){var g=a.extend({scoped:f},{_upload:function(){this._resumable=new b(d.extend({target:this._options.url},this._options.resumable)),this._options.isBlob&&(this._options.source.fileName="blob"),this._resumable.addFile(this._options.isBlob?this._options.source:this._options.source.files[0]);var a=this;this._resumable.on("fileProgress",function(){var b=a._resumable.getSize();a._progressCallback(Math.floor(a._resumable.progress()*b),b)}),this._resumable.on("fileSuccess",function(b,c){a._options.resumable.assembleUrl?a._resumableSuccessCallback(b,c,a._options.resumable.assembleResilience||1):a._successCallback(c)}),this._resumable.on("fileError",function(b,c){a._errorCallback(c)}),c.eventually(this._resumable.upload,this._resumable)},_resumableSuccessCallback:function(a,b,d){0>=d&&this._errorCallback(b);var f=this;e.ajax({type:"POST",async:!0,url:this._options.resumable.assembleUrl,dataType:null,data:{resumableIdentifier:a.file.uniqueIdentifier,resumableFilename:a.file.name,resumableTotalSize:a.file.size,resumableType:a.file.type},success:function(){f._successCallback(b)},error:function(){c.eventually(function(){f._resumableSuccessCallback(a,b,d-1)},f._options.resumable.assembleResilienceTimeout||0)}})}},{supported:function(a){return a.serverSupportChunked&&(new b).support}});return a.register(g,3),g})}.call(Scoped),function(){var a=this.subScope();a.binding("module","global:BetaJS.Flash"),a.binding("base","global:BetaJS"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"3adc016a-e639-4d1a-b4cb-e90cab02bc4f",version:"16.1436393076946",__global:{},options:{flashFile:"betajs-flash.swf"}}}),a.define("module:FlashEmbedding",["base:Class","jquery:","base:Strings","base:Functions","base:Types","base:Objs","base:Ids","base:Async","module:__global","module:FlashObjectWrapper","module:FlashClassWrapper","base:Browser.FlashHelper","module:"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){return a.extend({scoped:n},function(a){return{constructor:function(b,c,e){a.constructor.call(this),c=c||{},this.__registry=c.registry,this.__wrap=c.wrap,this.__cache={},this.__callbacks={ready:d.as_method(this.__ready,this)},this.__namespace="BetaJS.Flash.__global."+this.cid(),this.__is_ready=!1,this.__ready_queue=[],this.__wrappers={},this.__staticWrappers={},i[this.cid()]=this.__callbacks,e=f.extend(f.clone(m.options,1),f.extend({FlashVars:{}},e)),e.FlashVars.ready=this.__namespace+".ready",this.__embedding=l.embedFlashObject(b,e)},destroy:function(){delete i[this.cid()],f.iter(this.__wrappers,function(a){a.destroy()}),f.iter(this.__staticWrappers,function(a){a.destroy()}),a.destroy.call(this)},registerCallback:function(a,b){var c="__FLASHCALLBACK__"+g.uniqueId(),e=this;return this.__callbacks[c]=function(){a.apply(b||e,f.map(d.getArguments(arguments),e.unserialize,e))},c},unregisterCallback:function(a){delete this.__callbacks[a]},serialize:function(a){return e.is_array(a)?f.map(a,this.serialize,this):(e.is_function(a)&&(a=this.registerCallback(a)),e.is_string(a)&&c.starts_with(a,"__FLASHCALLBACK__")&&(a=this.__namespace+"."+a),j.is_instance_of(a)&&(a=a.__ident),k.is_instance_of(a)&&(a=a.__type),a)},unserialize:function(a){if(e.is_string(a)&&c.starts_with(a,"__FLASHERR__"))throw c.strip_start(a,"__FLASHERR__");if(e.is_string(a)&&c.starts_with(a,"__FLASHOBJ__")&&this.__wrap){var b=c.strip_start(a,"__FLASHOBJ__");if(b=c.splitFirst(b,"__").head.replace("::","."),"object"!=b.toLowerCase())return a in this.__wrappers||(this.__wrappers[a]=new j(this,a,b)),this.__wrappers[a]}return a},invoke:function(a,b){if(!this.__is_ready)throw"Flash is not ready yet";return b=b||[],this.unserialize(this.__embedding[a].apply(this.__embedding,this.serialize(d.getArguments(b))))},invokeCached:function(a,b){b=b||[];var c=a+"__"+d.getArguments(b).join("__");return c in this.__cache||(this.__cache[c]=this.invoke.call(this,a,b)),this.__cache[c]},getClass:function(a){return this.__wrap?(a in this.__staticWrappers||(this.__staticWrappers[a]=new k(this,a)),this.__staticWrappers[a]):null},newObject:function(){return this.flashCreate.apply(this,arguments)},newCallback:function(){return e.is_string(arguments[0])?this.flashCreateCallbackObject.apply(this,arguments):this.flashCreateCallbackFunction.apply(this,arguments)},flashCreateCallbackObject:function(){return this.invoke("create_callback_object",arguments)},flashCreateCallbackFunction:function(){return this.invoke("create_callback_function",arguments)},flashCreate:function(){return this.invoke("create",arguments)},flashDestroy:function(){return this.invoke("destroy",arguments)},flashCall:function(){return this.invoke("call",arguments)},flashCallVoid:function(){return this.invoke("call_void",arguments)},flashGet:function(){return this.invoke("get",arguments)},flashSet:function(){return this.invoke("set",arguments)},flashStaticCall:function(){return this.invoke("static_call",arguments)},flashStaticCallVoid:function(){return this.invoke("static_call_void",arguments)},flashGetStatic:function(){return this.invoke("get_static",arguments)},flashSetStatic:function(){return this.invoke("set_static",arguments)},flashMain:function(){return this.invokeCached("main")},__ready:function(){this.__is_ready||(this.__is_ready=!0,h.eventually(function(){f.iter(this.__ready_queue,function(a){a.callback.call(a.context||this)},this)},this))},ready:function(a,b){this.__is_ready?h.eventually(function(){a.call(b||this)},this):this.__ready_queue.push({callback:a,context:b})}}})}),a.define("module:FlashClassRegistry",["base:Class"],function(a,b){return a.extend({scoped:b},{interfaces:{},register:function(a,b,c){this.interfaces[a]={methods:b||{},statics:c||{}}},get:function(a){return this.interfaces[a]}})}),a.define("module:FlashObjectWrapper",["base:Class","base:Objs","base:Functions"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d,e,f){if(a.constructor.call(this),this.__embedding=d,this.__ident=e,this.__type=f,d.__registry){var g=d.__registry.get(f);g&&b.iter(g.methods,function(a){this[a]=function(){var b=c.getArguments(arguments);return b.unshift(a),b.unshift(this.__ident),this.__embedding.flashCall.apply(this.__embedding,b)},this[a+"Void"]=function(){var b=c.getArguments(arguments);return b.unshift(a),b.unshift(this.__ident),this.__embedding.flashCallVoid.apply(this.__embedding,b)}},this)}},destroy:function(){this.__embedding.flashDestroy(this.__ident),a.destroy.call(this)},set:function(a,b){return this.__embedding.flashSet.call(this.__embedding,this.__ident,a,b)},get:function(a){return this.__embedding.flashGet.call(this.__embedding,this.__ident,a)}}})}),a.define("module:FlashClassWrapper",["base:Class","base:Objs","base:Functions"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d,e){if(a.constructor.call(this),this.__embedding=d,this.__type=e,d.__registry){var f=d.__registry.get(e);f&&b.iter(f.statics,function(a){this[a]=function(){var b=c.getArguments(arguments);return b.unshift(a),b.unshift(this.__type),this.__embedding.flashStaticCall.apply(this.__embedding,b)},this[a+"Void"]=function(){var b=c.getArguments(arguments);return b.unshift(a),b.unshift(this.__type),this.__embedding.flashStaticCallVoid.apply(this.__embedding,b)}},this)}},set:function(a,b){return this.__embedding.flashSetStatic.call(this.__embedding,this.__type,a,b)
},get:function(a){return this.__embedding.flashGetStatic.call(this.__embedding,this.__type,a)}}})})}.call(Scoped),function(){var a=this.subScope();a.binding("module","global:BetaJS.Media"),a.binding("base","global:BetaJS"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"8475efdb-dd7e-402e-9f50-36c76945a692",version:"11.1436706087892"}}),a.define("module:Player.Flash",["base:Browser.Dom","base:Async","module:Player.FlashPlayer"],function(a,b,c){return{polyfill:function(c,d,e,f){return f?(b.eventually(function(){this.polyfill(c,d,e)},this),c):"video"==c.tagName.toLowerCase()&&"networkState"in c?c.networkState==c.NETWORK_NO_SOURCE||e?this.attach(a.changeTag(c,d||"videopoly")):c:this.attach(c)},attach:function(a){new c(a);return a}}}),a.define("module:Player.FlashPlayer",["base:Class","base:Flash.FlashClassRegistry","base:Flash.FlashEmbedding","base:Strings","base:Async","base:Objs","base:Functions","jquery:"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},function(a){return{constructor:function(b){a.constructor.call(this),this._element=b,this._$element=h(b),this._currentWidth=null,this._currentHeight=null,this.__initCss(),this._source=this.__preferedSource(),this._embedding=new c(b,{registry:this.cls.flashRegistry(),wrap:!0}),this._flashObjs={},this._flashData={status:"idle"},this._embedding.ready(this.__initializeEmbedding,this),this.__initEvents(),f.iter(this.__elementMethods,function(a,b){this._element[b]=g.as_method(a,this)},this)},destroy:function(){h(window).off("."+this.cid()),h(document).off("."+this.cid()),this._embedding.destroy(),a.destroy.call(this)},__initEvents:function(){var a=this;h(document).on("DOMNodeRemoved."+this.cid(),function(b){b.target==a._element&&a.weakDestroy()}),h(window).on("resize",function(){a.updateSize()})},__initCss:function(){this._$element.css("display")&&"inline"!=this._$element.css("display")||this._$element.css("display","inline-block")},__preferedSource:function(){for(var a=[".mp4",".flv"],b=[],c=this._element,e=0;e<this._element.childNodes.length;++e)c.childNodes[e].tagName&&"source"==c.childNodes[e].tagName.toLowerCase()&&c.childNodes[e].src&&b.push(c.childNodes[e].src.toLowerCase());var f=b[0],g=a.length-1;for(e=b.length-1;e>=0;--e)for(var h=0;g>=h;++h)if(d.ends_with(b[e],a[h])){f=b[e],g=h;break}-1==f.indexOf("://")&&(f=document.location.href+"/../"+f);var i=null,j=f;if(d.starts_with(f,"rtmp")){var k=d.splitLast(f,"/");i=k.head,j=k.tail}return{sourceUrl:f,connectionUrl:i,playUrl:j}},__initializeEmbedding:function(){this._flashObjs.main=this._embedding.flashMain(),this._flashObjs.stage=this._flashObjs.main.get("stage"),this._flashObjs.stage.set("scaleMode","noScale"),this._flashObjs.stage.set("align","TL"),this._flashObjs.video=this._embedding.newObject("flash.media.Video",this._flashObjs.stage.get("stageWidth"),this._flashObjs.stage.get("stageHeight")),this._flashObjs.main.addChildVoid(this._flashObjs.video),this._flashObjs.connection=this._embedding.newObject("flash.net.NetConnection"),this._flashObjs.connection.addEventListener("netStatus",this._embedding.newCallback(g.as_method(this.__connectionStatusEvent,this))),this._flashObjs.connection.connectVoid(this._source.connectionUrl)},__connectionStatusEvent:function(){this._flashObjs.stream=this._embedding.newObject("flash.net.NetStream",this._flashObjs.connection),this._flashObjs.stream.set("client",this._embedding.newCallback("onMetaData",g.as_method(function(a){this._flashData.meta=a,e.eventually(this.updateSize,this)},this))),this._flashObjs.stream.addEventListener("netStatus",this._embedding.newCallback(g.as_method(this.__streamStatusEvent,this))),this._flashObjs.video.attachNetStreamVoid(this._flashObjs.stream),this._element.attributes.autoplay&&this._element.play()},__streamStatusEvent:function(a){var b=a.get("info").code;"NetStream.Play.Start"==b&&(this._flashData.status="start"),"NetStream.Play.Stop"==b&&(this._flashData.status="stopping"),"NetStream.Buffer.Empty"==b&&"stopping"==this._flashData.status&&(this._flashData.status="stopped"),"stopped"==this._flashData.status&&this._element.attributes.loop&&(this._flashData.status="idle",this._element.play())},updateSize:function(){if(this._flashData.meta){var a=this._$element,b=this._element,c=this._flashData.meta,d=a.width();a.width()<c.width&&!b.style.width&&(element.style.width=c.width+"px",d=a.width(),delete element.style.width);var e=Math.round(d*c.height/c.width);d!=this._currentWidth&&(this._currentWidth=d,this._currentHeight=e,a.find("object").css("width",this._currentWidth+"px"),a.find("embed").css("width",this._currentWidth+"px"),a.find("object").css("height",this._currentHeight+"px"),a.find("embed").css("height",this._currentHeight+"px"),this._flashObjs.video.set("width",this._currentWidth),this._flashObjs.video.set("height",this._currentHeight))}},__elementMethods:{play:function(){"paused"===this._flashData.status?this._flashObjs.stream.resumeVoid():this._flashObjs.stream.playVoid(this._source.playUrl)},pause:function(){this._flashObjs.stream.pauseVoid(),this._flashData.status="paused"}}}},{flashRegistry:function(){return this.__flashRegistry||(this.__flashRegistry=new b,this.__flashRegistry.register("flash.media.Video",["attachNetStream"]),this.__flashRegistry.register("flash.display.Sprite",["addChild"]),this.__flashRegistry.register("flash.display.Stage",[]),this.__flashRegistry.register("flash.net.NetStream",["play","pause","resume","addEventListener"]),this.__flashRegistry.register("flash.net.NetConnection",["connect","addEventListener"])),this.__flashRegistry}})}),a.define("module:WebRTC.AudioRecorder",["base:Class","base:Events.EventsMixin","base:Objs","base:Functions","module:WebRTC.Support"],function(a,b,c,d,e,f){return a.extend({scoped:f},[b,function(a){return{constructor:function(b,f){a.constructor.call(this),this._leftChannel=[],this._rightChannel=[],this._recordingLength=0,this._options=c.extend({audioChannels:2,bufferSize:2048,sampleRate:44100},f),this._stream=b,this._started=!1;var g=e.globals().AudioContext;this._audioContext=new g,this._volumeGain=this._audioContext.createGain(),this._audioInput=this._audioContext.createMediaStreamSource(b),this._audioInput.connect(this._volumeGain),this._scriptProcessor=e.globals().audioContextScriptProcessor.call(this._audioContext,this._options.bufferSize,this._options.audioChannels,this._options.audioChannels),this._actualBufferSize=this._scriptProcessor.bufferSize,this._scriptProcessor.onaudioprocess=d.as_method(this._audioProcess,this),this._volumeGain.connect(this._scriptProcessor),this._scriptProcessor.connect(this._audioContext.destination)},_audioProcess:function(a){this._started&&(this._leftChannel.push(new Float32Array(a.inputBuffer.getChannelData(0))),this._options.audioChannels>1&&this._rightChannel.push(new Float32Array(a.inputBuffer.getChannelData(1))),this._recordingLength+=this._actualBufferSize)},destroy:function(){this.stop(),a.destroy.call(this)},start:function(){this._started||(this._started=!0,this._recordingLength=0,this._leftChannel=[],this._rightChannel=[],this.trigger("started"))},stop:function(){this._started&&(this._started=!1,this.trigger("stopped"),this._generateData())},_generateData:function(){var a=this.__mergeBuffers(this._leftChannel,this._recordingLength),b=this.__mergeBuffers(this._rightChannel,this._recordingLength),c=a;if(this._options.audioChannels>1){c=new Float32Array(a.length+b.length);for(var d=0;d<a.length;++d)c[2*d]=a[d],c[2*d+1]=b[d]}var e=new ArrayBuffer(44+2*c.length),f=new DataView(e);this.__writeUTFBytes(f,0,"RIFF"),f.setUint32(4,44+2*c.length,!0),this.__writeUTFBytes(f,8,"WAVE"),this.__writeUTFBytes(f,12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,1,!0),f.setUint16(22,this._options.audioChannels,!0),f.setUint32(24,this._options.sampleRate,!0),f.setUint32(28,4*this._options.sampleRate,!0),f.setUint16(32,2*this._options.audioChannels,!0),f.setUint16(34,16,!0),this.__writeUTFBytes(f,36,"data"),f.setUint32(40,2*c.length,!0);for(var g=c.length,h=44,i=1,j=0;g>j;j++)f.setInt16(h,32767*c[j]*i,!0),h+=2;this._data=new Blob([f],{type:"audio/wav"}),this._leftChannel=[],this._rightChannel=[],this._recordingLength=0,this.trigger("data",this._data)},__mergeBuffers:function(a,b){for(var c=new Float32Array(b),d=0,e=a.length,f=0;e>f;f++){var g=a[f];c.set(g,d),d+=g.length}return c},__writeUTFBytes:function(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}}}],{supported:function(){return!!e.globals().AudioContext&&!!e.globals().audioContextScriptProcessor}})}),a.define("module:WebRTC.MediaRecorder",["base:Class","base:Events.EventsMixin","base:Functions","module:WebRTC.Support"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this),this._stream=b,this._started=!1;var e=d.globals().MediaRecorder;this._mediaRecorder=new e(b),this._mediaRecorder.ondataavailable=c.as_method(this._dataAvailable,this)},destroy:function(){this.stop(),a.destroy.call(this)},start:function(){this._started||(this._started=!0,this._mediaRecorder.start(),this.trigger("started"))},stop:function(){this._started&&(this._started=!1,this._mediaRecorder.stop(),this.trigger("stopped"))},_dataAvailable:function(a){this._data=new Blob([a.data],{type:a.data.type}),this.trigger("data",this._data)}}}],{supported:function(){return!!d.globals().MediaRecorder}})}),a.define("module:WebRTC.RecorderWrapper",["base:Classes.ConditionalInstance","base:Events.EventsMixin","base:Objs","module:WebRTC.Support"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this,b),this._video=b.video,this._recording=!1,this._bound=!1},_getConstraints:function(){return{audio:this._options.recordAudio,video:this._options.recordVideo?{mandatory:{minWidth:this._options.recordResolution.width,maxWidth:this._options.recordResolution.width,minHeight:this._options.recordResolution.height,maxHeight:this._options.recordResolution.height}}:!1}},bindMedia:function(){return this._bound?void 0:d.userMedia(this._getConstraints()).success(function(a){this._bound=!0,this._stream=a,d.bindStreamToVideo(a,this._video),this.trigger("bound"),this._boundMedia()},this)},startRecord:function(){this._recording||(this._recording=!0,this._startRecord())},stopRecord:function(){this._recording&&(this._recording=!1,this._stopRecord())},unbindMedia:function(){this._bound&&!this._recording&&(d.stopUserMediaStream(this._stream),this._bound=!1,this.trigger("unbound"),this._unboundMedia())},_boundMedia:function(){},_unboundMedia:function(){},_startRecord:function(){},_stopRecord:function(){},_dataAvailable:function(a,b){this.trigger("data",a,b)},destroy:function(){this.stopRecord(),this.unbindMedia(),a.destroy.call(this)}}}],{_initializeOptions:function(a){return c.extend({recordAudio:!0,recordVideo:!0,recordResolution:{width:320,height:200}},a)},supported:function(){return!!d.globals().getUserMedia&&!!d.globals().URL}})}),a.define("module:WebRTC.MediaRecorderWrapper",["module:WebRTC.RecorderWrapper","module:WebRTC.MediaRecorder"],function(a,b,c){var d=a.extend({scoped:c},{_boundMedia:function(){this._recorder=new b(this._stream),this._recorder.on("data",function(a){this._dataAvailable(a)},this)},_unboundMedia:function(){this._recorder.destroy()},_startRecord:function(){this._recorder.start()},_stopRecord:function(){this._recorder.stop()}},function(a){return{supported:function(c){return a.supported.call(this,c)?b.supported():!1}}});return a.register(d,2),d}),a.define("module:WebRTC.WhammyAudioRecorderWrapper",["module:WebRTC.RecorderWrapper","module:WebRTC.AudioRecorder","module:WebRTC.WhammyRecorder"],function(a,b,c,d){var e=a.extend({scoped:d},{_boundMedia:function(){this._whammyRecorder=new c(this._stream,{video:this._video}),this._audioRecorder=new b(this._stream),this._audioRecorder.on("data",function(a){this._audioBlob=a,this._videoBlob&&this._dataAvailable(this._videoBlob,this._audioBlob)},this),this._whammyRecorder.on("data",function(a){this._videoBlob=a,this._audioBlob&&this._dataAvailable(this._videoBlob,this._audioBlob)},this)},_unboundMedia:function(){this._audioRecorder.destroy(),this._whammyRecorder.destroy()},_startRecord:function(){this._whammyRecorder.start(),this._audioRecorder.start()},_stopRecord:function(){this._whammyRecorder.stop(),this._audioRecorder.stop()}},function(a){return{supported:function(d){return a.supported.call(this,d)?b.supported()&&c.supported():!1}}});return a.register(e,1),e}),a.define("module:WebRTC.Support",["base:Promise.Promise"],function(a){return{getGlobals:function(){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,b=window.URL||window.webkitURL,c=window.MediaRecorder,d=window.AudioContext||window.webkitAudioContext,e=null;if(d){var f=new d;e=f.createJavaScriptNode||f.createScriptProcessor}return{getUserMedia:a,URL:b,MediaRecorder:c,AudioContext:d,audioContextScriptProcessor:e}},globals:function(){return this.__globals||(this.__globals=this.getGlobals()),this.__globals},userMediaSupported:function(){return!!this.globals().getUserMedia},userMedia:function(b){var c=new a;return this.globals().getUserMedia.call(navigator,b,function(a){c.asyncSuccess(a)},function(a){c.asyncError(a)}),c},stopUserMediaStream:function(a){a.stop()},bindStreamToVideo:function(a,b){b.volume=0,b.muted=!0,void 0!==b.mozSrcObject?b.mozSrcObject=a:b.src=this.globals().URL.createObjectURL(a),b.autoplay=!0,b.play()}}}),a.define("module:WebRTC.WhammyRecorder",["base:Class","base:Events.EventsMixin","base:Objs","base:Time","base:Functions","base:Async","module:WebRTC.Support"],function(a,b,c,d,e,f,g,h){return a.extend({scoped:h},[b,function(a){return{constructor:function(b,d){a.constructor.call(this),this._stream=b,this._options=c.extend({recordWidth:320,recordHeight:240,video:null},d),this._started=!1},destroy:function(){this.stop(),a.destroy.call(this)},start:function(){this._started||(this._started=!0,this._options.video&&(this._options.recordWidth=this._options.video.videoWidth||this._options.video.clientWidth,this._options.recordHeight=this._options.video.videoHeight||this._options.video.clientHeight),this._video=document.createElement("video"),this._video.width=this._options.recordWidth,this._video.height=this._options.recordHeight,g.bindStreamToVideo(this._stream,this._video),this._canvas=document.createElement("canvas"),this._canvas.width=this._options.recordWidth,this._canvas.height=this._options.recordHeight,this._context=this._canvas.getContext("2d"),this._frames=[],this._isOnStartedDrawingNonBlankFramesInvoked=!1,this._lastTime=d.now(),this.trigger("started"),this._process())},stop:function(){this._started&&(this._started=!1,this.trigger("stopped"),this._generateData())},_process:function(){if(this._started){var a=d.now(),b=a-this._lastTime;if(0>=b)return f.eventually(this._process,[],this,10),void 0;this._lastTime=a,this._context.drawImage(this._video,0,0,this._canvas.width,this._canvas.height),this._frames.push({duration:b,image:this._canvas.toDataURL("image/webp")}),this._isOnStartedDrawingNonBlankFramesInvoked||this.__isBlankFrame(this._canvas,this._frames[this._frames.length-1])||(this._isOnStartedDrawingNonBlankFramesInvoked=!0,this.trigger("onStartedDrawingNonBlankFrames")),f.eventually(this._process,[],this,10)}},_generateData:function(){this._frames.length&&(this._data=this.__compile(this.__dropBlackFrames(this._canvas,this._frames,-1)),this.trigger("data",this._data))},clearOldRecordedFrames:function(){this._frames=[]},__doubleToString:function(a){return[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")},__parseRIFF:function(a){for(var b=0,c={},d=function(a){var b=a.charCodeAt(0).toString(2);return new Array(8-b.length+1).join("0")+b};b<a.length;){var e=a.substr(b,4),f=parseInt(a.substr(b+4,4).split("").map(d).join(""),2),g=a.substr(b+4+4,f);b+=8+f,c[e]=c[e]||[],"RIFF"==e||"LIST"==e?c[e].push(this.__parseRIFF(g)):c[e].push(g)}return c},__parseWebP:function(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("Â*"),d=0,e=[];4>d;d++)e[d]=b.charCodeAt(c+3+d);var f,g,h;return h=e[1]<<8|e[0],f=16383&h,h=e[3]<<8|e[2],g=16383&h,{width:f,height:g,data:b,riff:a}},__checkFrames:function(a){if(!a[0])return null;var b=0;return c.iter(a,function(a){b+=a.duration}),{duration:b,width:a[0].width,height:a[0].height}},__makeSimpleBlock:function(a){var b=0;if(a.keyframe&&(b|=128),a.invisible&&(b|=8),a.lacing&&(b|=a.lacing<<1),a.discardable&&(b|=1),a.trackNum>127)throw"TrackNumber > 127 not supported";var c=[128|a.trackNum,a.timecode>>8,255&a.timecode,b].map(function(a){return String.fromCharCode(a)}).join("")+a.frame;return c},__numToBuffer:function(a){for(var b=[];a>0;)b.push(255&a),a>>=8;return new Uint8Array(b.reverse())},__strToBuffer:function(a){return new Uint8Array(a.split("").map(function(a){return a.charCodeAt(0)}))},__bitsToBuffer:function(a){var b=[],c=a.length%8?new Array(9-a.length%8).join("0"):"";a=c+a;for(var d=0;d<a.length;d+=8)b.push(parseInt(a.substr(d,8),2));return new Uint8Array(b)},__generateEBML:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].data;"object"==typeof d&&(d=this.__generateEBML(d)),"number"==typeof d&&(d=this.__bitsToBuffer(d.toString(2))),"string"==typeof d&&(d=this.__strToBuffer(d));var e=d.size||d.byteLength||d.length,f=Math.ceil(Math.ceil(Math.log(e)/Math.log(2))/8),g=e.toString(2),h=new Array(7*f+7+1-g.length).join("0")+g,i=new Array(f).join("0")+"1"+h;b.push(this.__numToBuffer(a[c].id)),b.push(this.__bitsToBuffer(i)),b.push(d)}return new Blob(b,{type:"video/webm"})},__toWebM:function(a){for(var b=this.__checkFrames(a),c=3e4,d=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:this.__doubleToString(b.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:b.width,id:176},{data:b.height,id:186}]}]}]}]}],e=0,f=0,g=this,h=0,i=function(a){var b=g.__makeSimpleBlock({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(h)});return h+=a.duration,{data:b,id:163}};e<a.length;){var j=[],k=0;do j.push(a[e]),k+=a[e].duration,e++;while(e<a.length&&c>k);h=0;var l={id:524531317,data:[{data:f,id:231}].concat(j.map(i))};d[1].data.push(l),f+=k}return this.__generateEBML(d)},__compile:function(a){var b=this,c=this.__toWebM(a.map(function(a){var c=b.__parseWebP(b.__parseRIFF(atob(a.image.slice(23))));return c.duration=a.duration,c}));return c},__dropBlackFrames:function(a,b,c,d,e){var f=document.createElement("canvas");f.width=a.width,f.height=a.height;for(var g=f.getContext("2d"),h=[],i=-1===c,j=c&&c>0&&c<=b.length?c:b.length,k={r:0,g:0,b:0},l=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),m=d&&d>=0&&1>=d?d:0,n=e&&e>=0&&1>=e?e:0,o=!1,p=0;j>p;p++){var q,r,s;if(!o){var t=new Image;t.src=b[p].image,g.drawImage(t,0,0,a.width,a.height);var u=g.getImageData(0,0,a.width,a.height);q=0,r=u.data.length,s=u.data.length/4;for(var v=0;r>v;v+=4){var w={r:u.data[v],g:u.data[v+1],b:u.data[v+2]},x=Math.sqrt(Math.pow(w.r-k.r,2)+Math.pow(w.g-k.g,2)+Math.pow(w.b-k.b,2));l*m>=x&&q++}}!o&&s*n>=s-q||(i&&(o=!0),h.push(b[p]))}return h=h.concat(b.slice(j)),h.length<=0&&h.push(b[b.length-1]),h},__isBlankFrame:function(a,b,c,d){var e=document.createElement("canvas");e.width=a.width,e.height=a.height;var f,g,h,i=e.getContext("2d"),j={r:0,g:0,b:0},k=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),l=c&&c>=0&&1>=c?c:0,m=d&&d>=0&&1>=d?d:0,n=new Image;n.src=b.image,i.drawImage(n,0,0,a.width,a.height);var o=i.getImageData(0,0,a.width,a.height);f=0,g=o.data.length,h=o.data.length/4;for(var p=0;g>p;p+=4){var q={r:o.data[p],g:o.data[p+1],b:o.data[p+2]},r=Math.sqrt(Math.pow(q.r-j.r,2)+Math.pow(q.g-j.g,2)+Math.pow(q.b-j.b,2));k*l>=r&&f++}return h*m>=h-f?!1:!0}}}],{supported:function(){return!0}})})}.call(Scoped),BetaJS.$="jQuery"in window?window.jQuery:null,BetaJS.Exceptions.Exception.extend("BetaJS.Views.ViewException"),BetaJS.Views.View=BetaJS.Class.extend("BetaJS.Views.View",[BetaJS.Events.EventsMixin,BetaJS.Events.ListenMixin,BetaJS.Properties.PropertiesMixin,BetaJS.Classes.ModuleMixin,{$el:null,_templates:function(){return{}},_dynamics:function(){return{}},_events:function(){return[]},_global_events:function(){return[]},_css:function(){return{}},css:function(a){if(this.__css[a])return this.__css[a];var b=null;return this.__parent&&(b=this.__parent.css(a),b&&b!=a)?b:(b=this._css(),b[a]?b[a]:a)},_render:function(){this.__html?this.$el.html(this.__html):this.__templates["default"]?this.$el.html(this.evaluateTemplate("default",{})):this.__dynamics["default"]&&this.evaluateDynamics("default",this.$el,{},{name:"default"})},templates:function(a){return a in this.__templates?this.__templates[a]:null},dynamics:function(a){return a in this.__dynamics?this.__dynamics[a]:null},_supp:function(){return{__context:this,css:function(a){return this.__context.css(a)},attrs:function(a){var b="";for(var c in a)b+=(a[c]?c+"='"+a[c]+"'":c)+" ";return b},styles:function(a){var b="";for(var c in a)b+=c+":"+a[c]+";";return b},selector:function(a){return"data-selector='"+a+"' "},view_id:this.cid()}},templateArguments:function(){var a=this.getAll();return a.supp=this._supp(),a},evaluateTemplate:function(a,b){return b=b||{},this.__templates[a].evaluate(BetaJS.Objs.extend(b,this.templateArguments()))},evaluateDynamics:function(a,b,c,d){return this.__dynamics[a].renderInstance(b,BetaJS.Objs.extend(d||{},{args:c||{}}))},_setOption:function(a,b,c,d){d=d?d:"__",this[d+b]=a&&b in a&&BetaJS.Types.is_defined(a[b])?a[b]:c},_setOptionTyped:function(a,b,c,d,e){this._setOption(a,b,this.cls._parseType(c,d),e)},_setOptionProperty:function(a,b,c){this.set(b,a&&b in a&&BetaJS.Types.is_defined(a[b])?a[b]:c)},_setOptionPropertyTyped:function(a,b,c){this._setOptionProperty(a,b,this.cls._parseType(c,type))},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.View,"constructor"),this._setOption(a,"el",null),this._setOption(a,"visible",!0),this._setOption(a,"html",null),this._setOption(a,"events",[]),this._setOption(a,"attributes",{}),this._setOption(a,"invalidate_on_show",!1),this._setOption(a,"append_to_el",!1),this.__old_attributes={},this._setOption(a,"el_classes",[]),BetaJS.Types.is_string(this.__el_classes)&&(this.__el_classes=this.__el_classes.split(" ")),this.__added_el_classes=[],this._setOption(a,"el_styles",{}),this._setOption(a,"children_styles",{}),this._setOption(a,"children_classes",[]),BetaJS.Types.is_string(this.__children_classes)&&(this.__children_classes=this.__children_classes.split(" ")),this._setOption(a,"invalidate_on_change",!1),this.__old_el_styles={},this._setOption(a,"css",{}),this.__parent=null,this.__children={},this.__active=!1,this.$el=null;var b=BetaJS.Types.is_function(this._events)?this._events():this._events;BetaJS.Types.is_array(b)||(b=[b]),this.__events=b.concat(this.__events);var c=BetaJS.Types.is_function(this._global_events)?this._global_events():this._global_events;BetaJS.Types.is_array(c)||(c=[c]),this.__global_events=c;var d=BetaJS.Objs.extend(BetaJS.Types.is_function(this._templates)?this._templates():this._templates,a.templates||{});"template"in a&&(d["default"]=a.template),this.__templates={};var e=null;for(e in d){if(!d[e])throw new BetaJS.Views.ViewException("Could not find template '"+e+"' in View '"+this.cls.classname+"'");this.__templates[e]=new BetaJS.Templates.Template(BetaJS.Types.is_string(d[e])?d[e]:d[e].html())}var f=BetaJS.Objs.extend(BetaJS.Types.is_function(this._dynamics)?this._dynamics():this._dynamics,a.dynamics||{});"dynamic"in a&&(f["default"]=a.dynamic),this.__dynamics={};for(e in f)this.__dynamics[e]=new BetaJS.Views.DynamicTemplate(this,BetaJS.Types.is_string(f[e])?f[e]:f[e].html());this.setAll(a.properties||{}),this.__invalidate_on_change&&this.on("change",function(){this.invalidate()},this),this.__modules={},BetaJS.Objs.iter(a.modules||[],this.add_module,this),this._notify("created",a),this.ns={};var g=this._domain(),h=this._domain_defaults(),i=null;if(!BetaJS.Types.is_empty(g)){var j=[];for(i in g)j.push({name:i,data:g[i]});j=BetaJS.Sort.dependency_sort(j,function(a){return a.name},function(a){return a.data.before||[]},function(a){var b=a.data.after||[];return a.data.parent&&b.push(a.data.parent),b});for(var k=0;k<j.length;++k){i=j[k].name;var l=j[k].data,m=l.options||{};BetaJS.Types.is_function(m)&&(m=m.apply(this,[this]));var n=h[l.type]||{};BetaJS.Types.is_function(n)&&(n=n.apply(this,[this])),m=BetaJS.Objs.tree_merge(n,m),l.type in BetaJS.Views&&(l.type=BetaJS.Views[l.type]),BetaJS.Types.is_string(l.type)&&(l.type=BetaJS.Objs.Scopes.get(l.type,window));var o=new l.type(m);this.ns[i]=o;var p=l.parent_options||{},q=this;l.parent&&(q=BetaJS.Objs.Scopes.get(l.parent,this.ns)),l.method?l.method(q,o):q.addChild(o,p),o.domain=this;var r=null;for(r in l.events||{})o.on(r,l.events[r],o);for(r in l.listeners||{})this.on(r,l.listeners[r],o)}}},_domain:function(){return{}},_domain_defaults:function(){return{}},isActive:function(){return this.__active},activate:function(){if(this.isActive())return this;if(this.__parent&&!this.__parent.isActive())return null;if(this.$el=this.__parent?this.__el?this.__parent.$(this.__el):this.__parent.$el:BetaJS.$(this.__el),0===this.$el.size()&&(this.$el=null),!this.$el)return null;this.__append_to_el&&(this.$el.append("<div data-view-id='"+this.cid()+"'></div>"),this.$el=this.$el.find("[data-view-id='"+this.cid()+"']")),this.__old_attributes={};var a=null,b=null;for(a in this.__attributes)b=this.$el.attr(a),this.__old_attributes[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.attr(a,this.__attributes[a]);this.__added_el_classes=[];for(var c=this._el_classes().concat(this.__el_classes),d=0;d<c.length;++d)this.$el.hasClass(c[d])||(this.$el.addClass(c[d]),this.__added_el_classes.push(c[d]));this.__old_el_styles={};var e=BetaJS.Objs.extend(this._el_styles(),this.__el_styles);for(a in e)b=this.$el.css(a),this.__old_el_styles[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.css(a,e[a]);return this.__bind(),this.__visible||this.$el.css("display",this.__visible?"":"none"),this.__active=!0,this.__render(),this._notify("preactivate"),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}),this._notify("activate"),this.trigger("activate"),this.__visible&&this.trigger("show"),this.trigger("visibility",this.__visible),this.trigger("resize"),this},deactivate:function(){if(!this.isActive())return!1;this.__visible&&this.trigger("hide"),this.trigger("visibility",!1),this._notify("deactivate"),this.trigger("deactivate"),BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),this.__active=!1,BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__unbind(),this.$el.html("");var a=null;for(a in this.__old_attributes)this.$el.attr(a,this.__old_attributes[a]);for(var b=0;b<this.__added_el_classes.length;++b)this.$el.removeClass(this.__added_el_classes[b]);for(a in this.__old_el_styles)this.$el.css(a,this.__old_el_styles[a]);return this.__append_to_el&&this.$el.remove(),this.$el=null,!0},_el_styles:function(){return{}},_el_classes:function(){return[]},$:function(a){return this.$el.find(a)},$data:function(a,b){b||(b=this.$el);var c="";for(var d in a)c+="[data-"+d+"='"+a[d]+"']";return b.find(c)},destroy:function(){this.deactivate(),this.setParent(null);var a=this.__children;this.__children={},BetaJS.Objs.iter(a,function(a){a.view.destroy()}),this.__children={},BetaJS.Objs.iter(this.__dynamics,function(a){a.destroy()},this),BetaJS.Objs.iter(this.__templates,function(a){a.destroy()},this),this.trigger("destroy"),this._inherited(BetaJS.Views.View,"destroy")},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},isVisible:function(){return this.__visible},setVisibility:function(a){a!=this.__visible&&(this.__visible=a,this.isActive()&&(this.$el.css("display",this.__visible?"":"none"),this.__visible&&(this.trigger("resize"),this.__invalidate_on_show&&this.invalidate()),this.trigger(a?"show":"hide"),this.trigger("visibility",a)),this.__parent&&this.__parent.updateChildVisibility(this))},updateChildVisibility:function(){},toggle:function(){this.setVisibility(!this.isVisible())},__bind:function(){var a=this;this.__unbind(),BetaJS.Objs.iter(this.__events,function(b){BetaJS.Objs.iter(b,function(b,c){var d=BetaJS.Types.is_function(b)?b:a[b],e=c.match(BetaJS.Views.BIND_EVENT_SPLITTER),f=e[1],g=e[2];f=f+".events"+a.cid();var h=BetaJS.Functions.as_method(d,a);""===g?a.$el.on(f,h):a.$el.on(f,g,h)})}),BetaJS.Objs.iter(this.__global_events,function(b){BetaJS.Objs.iter(b,function(b,c){var d=BetaJS.Types.is_function(b)?b:a[b],e=c.match(BetaJS.Views.BIND_EVENT_SPLITTER),f=e[1],g=e[2];f=f+".events"+a.cid();var h=BetaJS.Functions.as_method(d,a);""===g?BetaJS.$(document).on(f,h):BetaJS.$(document).on(f,g,h)})})},__unbind:function(){this.$el.off(".events"+this.cid()),BetaJS.$(document).off(".events"+this.cid())},__render:function(){if(this.isActive()){this._render();var a=this.$el.children();if(!BetaJS.Types.is_empty(this.__children_styles))for(var b in this.__children_styles)a.css(b,this.__children_styles[b]);BetaJS.Objs.iter(this.__children_classes,function(b){a.addClass(b)}),this.trigger("render")}},invalidate:function(){this.isActive()&&(BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__render(),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}))},setEl:function(a){this.isActive()?(this.deactivate(),this.__el=a,this.activate()):this.__el=a},getParent:function(){return this.__parent},hasChild:function(a){return a&&a.cid()in this.__children},setParent:function(a){if(a!=this.__parent){if(this.deactivate(),this.__parent){this._unbindParent(this.__parent);var b=this.__parent;this.__parent.off(null,null,this),this.__parent=null,b.removeChild(this)}a&&(this.__parent=a,a.addChild(this),this._bindParent(a),a.isActive()&&this.activate())}},_bindParent:function(){},_unbindParent:function(){},children:function(){var a={};return BetaJS.Objs.iter(this.__children,function(b,c){a[c]=b.view},this),a},childOptions:function(a){return this.__children[a.cid()].options},addChildren:function(a){BetaJS.Objs.iter(a,function(a){this.addChild(a)},this)},addChild:function(a,b){return this.hasChild(a)?null:(b=b||{},this.__children[a.cid()]={view:a,options:b},this._notify("addChild",a,b),a.setParent(this),this.isActive()&&this.isVisible()&&this.trigger("resize"),a)},removeChildren:function(a){BetaJS.Objs.iter(a,function(a){this.removeChild(a)},this)},removeChild:function(a){this.hasChild(a)&&(delete this.__children[a.cid()],a.setParent(null),a.off(null,null,this),this._notify("removeChild",a),this.isActive()&&this.isVisible()&&this.trigger("resize"))},width:function(){return this.$el.width()},innerWidth:function(){return this.$el.innerWidth()},outerWidth:function(){return this.$el.outerWidth()},height:function(){return this.$el.height()},innerHeight:function(){return this.$el.innerHeight()},outerHeight:function(){return this.$el.outerHeight()}}],{parseType:function(a,b){if(BetaJS.Types.is_defined(a)&&BetaJS.Types.is_string(a)){if(a=a.replace(/\s+/g,""),"int"==b)return parseInt(a,10);if("array"==b)return a.split(",");if("bool"==b)return""===a||BetaJS.Types.parseBool(a);if("object"==b||"function"==b)return BetaJS.Objs.Scopes.get(a,window)}return a}}),BetaJS.Views.BIND_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,BetaJS.Class.extend("BetaJS.Views.DynamicTemplate",{constructor:function(a,b){this._inherited(BetaJS.Views.DynamicTemplate,"constructor"),this.__parent=a,this.__template=new BetaJS.Templates.Template(b),this.__instances={},this.__instances_by_name={}},reset:function(){BetaJS.Objs.iter(this.__instances,function(a){this.removeInstance(a)
},this)},destroy:function(){this.reset(),this._inherited(BetaJS.Views.DynamicTemplate,"destroy")},renderInstance:function(a,b){b=b||{},b.name&&this.removeInstanceByName(b.name);var c=new BetaJS.Views.DynamicTemplateInstance(this,a,b);this.__instances[c.cid()]=c,b.name&&(this.__instances_by_name[b.name]=c)},removeInstanceByName:function(a){a in this.__instances_by_name&&this.removeInstance(this.__instances_by_name[a])},removeInstance:function(a){delete this.__instances[a.cid()],delete this.__instances_by_name[a.name()],a.destroy()},view:function(){return this.__parent},template:function(){return this.__template}}),BetaJS.Class.extend("BetaJS.Views.DynamicTemplateInstance",[BetaJS.Events.ListenMixin,{__bind:{attr:function(a,b){return this.__context.__bind_attribute(a,b)},attrs:function(a){var b="";for(var c in a)b+=this.attr(c,a[c])+" ";return b},value:function(a){return this.__context.__bind_value(a)},inner:function(a){return this.__context.__bind_inner(a)},css_if:function(a,b){return this.__context.__bind_css_if(a,b,!0)},css_if_not:function(a,b){return this.__context.__bind_css_if(a,b,!1)}},__new_element:function(a){var b=BetaJS.Ids.uniqueId();return this.__elements[b]=BetaJS.Objs.extend({id:b,$el:null},a),this.__elements[b]},__decompose_variable:function(a){var b=a.split(".");return{object:1==b.length?this.__parent.view():this.__args[b[0]],key:1==b.length?a:b[1]}},__get_variable:function(a){var b=this.__decompose_variable(a);return b.object.get(b.key)},__set_variable:function(a,b){var c=this.__decompose_variable(a);return c.object.set(c.key,b)},__update_element:function(a){var b=this.__get_variable(a.variable);"inner"==a.type?a.$el.html(b):"value"==a.type?a.$el.val()!=b&&a.$el.val(b):"attribute"==a.type?a.$el.attr(a.attribute,b):"css"==a.type&&(a.positive||(b=!b),b?a.$el.addClass(this.__parent.view().css(a.css)):a.$el.removeClass(this.__parent.view().css(a.css)))},__prepare_element:function(a){var b=this;a.$el=this.$el.find(a.selector),"inner"==a.type||"css"==a.type?this.__update_element(a):"value"==a.type&&a.$el.on("change input keyup paste",function(){b.__set_variable(a.variable,a.$el.val())})},__bind_attribute:function(a,b){var c=this.__new_element({type:"attribute",attribute:a,variable:b}),d="data-bind-"+a+"='"+c.id+"'";c.selector="["+d+"]";var e=this.__decompose_variable(b);return this.listenOn(e.object,"change:"+e.key,function(){this.__update_element(c)},this),d+" "+a+"='"+e.object.get(e.key)+"'"},__bind_css_if:function(a,b,c){var d=this.__new_element({type:"css",css:a,variable:b,positive:c}),e="data-bind-css-"+a+"='"+d.id+"'";d.selector="["+e+"]";var f=this.__decompose_variable(b);return this.listenOn(f.object,"change:"+f.key,function(){this.__update_element(d)},this),e},__bind_value:function(a){var b=this.__new_element({type:"value",variable:a}),c="data-bind-value='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c+" value='"+d.object.get(d.key)+"'"},__bind_inner:function(a){var b=this.__new_element({type:"inner",variable:a}),c="data-bind-inner='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c},constructor:function(a,b,c){this._inherited(BetaJS.Views.DynamicTemplateInstance,"constructor"),this.__elements={},this.__inners={},c=c||{},c.name&&(this.__name=c.name),this.__parent=a,this.$el=b,this.__args=BetaJS.Objs.extend(c.args||{},this.__parent.view().templateArguments()),this.__args.bind=BetaJS.Objs.extend({__context:this},this.__bind),this.$el.html(a.template().evaluate(this.__args)),BetaJS.Objs.iter(this.__elements,function(a){this.__prepare_element(a)},this)},destroy:function(){BetaJS.Objs.iter(this.__elements,function(a){a.$el.off()},this),this._inherited(BetaJS.Views.DynamicTemplateInstance,"destroy")},name:function(){return this.__name}}]),BetaJS.Views.ActiveDom={__prefix_alias:["bjs","betajs"],__view_alias:{},__views:{},__active:!1,__on_add_element:function(a){var b=BetaJS.$(a.target);if(b){var c=!1;b.prop("tagName")&&(BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(a){b.prop("tagName").toLowerCase()==a+"view"&&(BetaJS.Views.ActiveDom.__attach(b),c=!0)}),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__view_alias,function(a,d){b.prop("tagName").toLowerCase()==d&&(BetaJS.Views.ActiveDom.__attach(b,a),c=!0)})),c||(BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(a){b.find(a+"view").each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this))})}),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__view_alias,function(a,c){b.find(c).each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this),a)})}))}},__on_remove_element:function(a){var b=BetaJS.$(a.target);b.attr("data-active-dom-id")in BetaJS.Views.ActiveDom.__views?BetaJS.Views.ActiveDom.__views[b.attr("data-active-dom-id")].destroy():b.find("[data-active-dom-id]").each(function(){var a=BetaJS.$(this);a.attr("data-active-dom-id")in BetaJS.Views.ActiveDom.__views&&BetaJS.Views.ActiveDom.__views[a.attr("data-active-dom-id")].destroy()})},__attach:function(a,b){if(!a.attr("data-active-dom-element")){var c=function(a,c){for(var d=0;d<BetaJS.Views.ActiveDom.__prefix_alias.length;){var i=BetaJS.Views.ActiveDom.__prefix_alias[d];if(BetaJS.Strings.starts_with(a,i+"-"))return a=BetaJS.Strings.strip_start(a,i+"-"),BetaJS.Strings.starts_with(a,"child-")?(a=BetaJS.Strings.strip_start(a,"child-"),f[a]=c):a in h?b[a]=c:g[a]=c,void 0;++d}e[a]=c},d=function(a){var b=a.find("script[type='text/param']");return BetaJS.Strings.nltrim(b.length>0?b.html():a.html())},e={},f={},g={},h={type:"View","default":null,name:null,"keep-tag":!0};b=BetaJS.Objs.extend(BetaJS.Objs.clone(h,1),b||{});for(var i=a.get(0).attributes,j=0;j<i.length;++j)c(i.item(j).nodeName,i.item(j).nodeValue);BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(b){a.children(b+"param").each(function(){var a=BetaJS.$(this);c(b+"-"+a.attr(b+"-key"),d(a))})}),b["default"]&&(g[b["default"]]=d(a)),b.type in BetaJS.Views&&(b.type=BetaJS.Views[b.type]),BetaJS.Types.is_string(b.type)&&(b.type=BetaJS.Objs.Scopes.get(b.type,window));var k=new b.type(g);k.setEl("[data-active-dom-id='"+k.cid()+"']");var l="<div data-active-dom-id='"+k.cid()+"'></div>";b["keep-tag"]&&(l="<"+a.prop("tagName")+" data-active-dom-element='"+k.cid()+"'>"+l+"</"+a.prop("tagName")+">"),a.replaceWith(l),a=BetaJS.$("[data-active-dom-id='"+k.cid()+"']");var m=null;for(m in e)a.attr(m,e[m]);k.on("destroy",function(){delete BetaJS.Views.ActiveDom.__views[k.cid()]}),BetaJS.Views.ActiveDom.__views[k.cid()]=k,k.activate();for(m in f)a.children().attr(m,f[m]);b.name&&BetaJS.Objs.Scopes.set(k,b.name,window)}},activate:function(){BetaJS.$(document).ready(function(){BetaJS.Views.ActiveDom.__active||(document.addEventListener?(document.addEventListener("DOMNodeInserted",BetaJS.Views.ActiveDom.__on_add_element),document.addEventListener("DOMNodeRemoved",BetaJS.Views.ActiveDom.__on_remove_element)):(document.attachEvent("DOMNodeInserted",BetaJS.Views.ActiveDom.__on_add_element),document.attachEvent("DOMNodeRemoved",BetaJS.Views.ActiveDom.__on_remove_element)),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(a){BetaJS.$(a+"view").each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this))})}),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__view_alias,function(a,b){BetaJS.$(b).each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this),a)})}),BetaJS.Views.ActiveDom.__active=!0)})},deactivate:function(){BetaJS.$(document).ready(function(){BetaJS.Views.ActiveDom.__active&&(document.removeEventListener("DOMNodeInserted",BetaJS.Views.ActiveDom.__on_add_element),document.removeEventListener("DOMNodeRemoved",BetaJS.Views.ActiveDom.__on_remove_element),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__views,function(a){a.destroy()}),BetaJS.Views.ActiveDom.__active=!1)})},registerPrefixAlias:function(a){this.__prefix_alias.push(a)},registerViewAlias:function(a,b,c){this.__view_alias[a]={type:b},this.__view_alias[a]["default"]=c}},BetaJS.Classes.Module.extend("BetaJS.Views.Modules.Centering",{constructor:function(a){this._inherited(BetaJS.Views.Modules.Centering,"constructor",a),this.__vertical="vertical"in a?a.vertical:!1,this.__horizontal="horizontal"in a?a.horizontal:!1},_register:function(a){a.on("resize",function(){a.isVisible()&&this.__update(a)},this),a.isActive()&&a.isVisible()&&this.__update(a)},__update:function(a){this.__vertical&&(a.$el.css("top","50%"),a.$el.css("margin-top",Math.round(-a.$el.height()/2)+"px")),this.__horizontal&&(a.$el.css("left","50%"),a.$el.css("margin-left",Math.round(-a.$el.width()/2)+"px"))}},{__vertical:null,vertical:function(){return this.__vertical||(this.__vertical=new this({auto_destroy:!1,vertical:!0,horizontal:!1})),this.__vertical},__horizontal:null,horizontal:function(){return this.__horizontal||(this.__horizontal=new this({auto_destroy:!1,horizontal:!0,vertical:!1})),this.__horizontal},__both:null,both:function(){return this.__both||(this.__both=new this({auto_destroy:!1,vertical:!0,horizontal:!0})),this.__both}}),BetaJS.Classes.Module.extend("BetaJS.Views.Modules.BindOnActivate",{_register:function(a,b){b.bound=!1,a.on("activate",function(){this.__bind(a)},this),a.on("deactivate",function(){this.__unbind(a)},this),a.isActive()&&this.__bind(a)},_unregister:function(a){this.__unbind(a)},__bind:function(a){var b=this._data(a);b.bound||(this._bind(a,b),b.bound=!0)},__unbind:function(a){var b=this._data(a);b.bound&&(this._unbind(a,b),b.bound=!1)},_bind:function(){},_unbind:function(){}}),BetaJS.Classes.Module.extend("BetaJS.Views.Modules.BindOnVisible",{_register:function(a,b){b.bound=!1,a.on("visibility",function(b){b?this.__bind(a):this.__unbind(a)},this),a.isActive()&&a.isVisible()&&this.__bind(a)},_unregister:function(a){this.__unbind(a)},__bind:function(a){var b=this._data(a);b.bound||(this._bind(a,b),b.bound=!0)},__unbind:function(a){var b=this._data(a);b.bound&&(this._unbind(a,b),b.bound=!1)},_bind:function(){},_unbind:function(){}}),BetaJS.Views.Modules.BindOnVisible.extend("BetaJS.Views.Modules.HideOnLeave",{_bind:function(a,b){var c=a.$el.get(0);b.hide_on_leave_func=function(d){return b.hide_on_leave_skip?(b.hide_on_leave_skip=!1,void 0):(document.contains(d.target)&&d.target!==c&&!BetaJS.$.contains(c,d.target)&&a.hide(),void 0)},b.hide_on_leave_skip=!0,BetaJS.$(document.body).on("click",b.hide_on_leave_func)},_unbind:function(a,b){BetaJS.$(document.body).unbind("click",b.hide_on_leave_func)}}),BetaJS.Views.Modules.BindOnActivate.extend("BetaJS.Views.Modules.Hotkeys",{constructor:function(a){this._inherited(BetaJS.Views.Modules.Hotkeys,"constructor",a),this.__hotkeys=a.hotkeys},_bind:function(a,b){b.hotkeys={},BetaJS.Objs.iter(this.__hotkeys,function(c,d){b.hotkeys[d]=BetaJS.Browser.Hotkeys.register(d,BetaJS.Types.is_function(c)?c:a[c],a)},this)},_unbind:function(a,b){BetaJS.Objs.iter(b.hotkeys,function(a){BetaJS.Browser.Hotkeys.unregister(a)},this),b.hotkeys={}}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["holygrail-view-template"]="  <div data-selector=\"right\" class='holygrail-view-right-container'></div>  <div data-selector=\"left\" class='holygrail-view-left-container'></div>  <div data-selector=\"center\" class='holygrail-view-center-container'></div> ",BetaJS.Templates.Cached["list-container-view-item-template"]='  <{%= container_element %} data-view-id="{%= cid %}"></{%= container_element %}> ',BetaJS.Templates.Cached["switch-container-view-item-template"]='  <div data-view-id="{%= cid %}" data-selector="switch-container-item"></div> ',BetaJS.Templates.Cached["button-view-template"]='   <{%= button_container_element %} type="button" data-selector="button-inner" class="{%= supp.css("default") %}"    {%= bind.css_if("disabled", "disabled") %}    {%= bind.css_if("selected", "selected") %}    {%= bind.inner("label") %}>   </{%= button_container_element %}>  ',BetaJS.Templates.Cached["check-box-view-template"]='  <input type="checkbox" {%= checked ? "checked" : "" %} id="check-{%= supp.view_id %}" />  <label for="check-{%= supp.view_id %}">{%= label %}</label> ',BetaJS.Templates.Cached["input-view-template"]='  <input class="input-view" type="{%= input_type %}" {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %} {%= bind.css_if("input-horizontal-fill", "horizontal_fill") %} /> ',BetaJS.Templates.Cached["label-view-template"]='  <{%= element %} class="{%= supp.css(\'label\') %}" {%= bind.inner("label") %}></{%= element %}> ',BetaJS.Templates.Cached["link-view-template"]='  <a href="javascript:{}" {%= bind.inner("label") %}></a> ',BetaJS.Templates.Cached["text-area-template"]='   <textarea {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %}             {%= bind.css_if_not("text-area-no-resize", "resizable") %}             {%= readonly ? \'readonly\' : \'\' %}             style="resize: {%= horizontal_resize ? (vertical_resize ? \'both\' : \'horizontal\') : (vertical_resize ? \'vertical\' : \'none\') %}"             {%= bind.css_if("text-area-horizontal-fill", "horizontal_fill") %}></textarea>  ',BetaJS.Templates.Cached["progress-template"]='  <div class="{%= supp.css(\'outer\') %}">   <div data-selector="inner" class="{%= supp.css(\'inner\') %}" style="{%= horizontal ? \'width\': \'height\' %}:{%= value*100 %}%">   </div>   <div class="progress-view-overlay" data-selector="label">    {%= label %}   </div>  </div> ',BetaJS.Templates.Cached["list-view-template"]='   <{%= list_container_element %}    {%= supp.attrs(list_container_attrs) %}    class="{%= list_container_classes %}"    data-selector="list">   </{%= list_container_element %}>  ',BetaJS.Templates.Cached["list-view-item-container-template"]='   <{%= item_container_element %}    {%= supp.attrs(item_container_attrs) %}    class="{%= item_container_classes %}"    {%= supp.list_item_attr(item) %}>   </{%= item_container_element %}>  ',BetaJS.Templates.Cached["overlay-view-template"]='  <div data-selector="container"></div> ',BetaJS.Templates.Cached["fullscreen-overlay-view-template"]='  <div class="fullscreen-overlay-background" data-selector="outer"></div>  <div class="fullscreen-overlay" data-selector="container">   <div class="fullscreen-overlay-inner" data-selector="inner"></div>  </div> ',BetaJS.Views.View.extend("BetaJS.Views.HolygrailView",{_templates:{"default":BetaJS.Templates.Cached["holygrail-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.HolygrailView,"constructor",a),this.__left=null,this.__center=null,this.__right=null},getLeft:function(){return this.__left},setLeft:function(a){return this.__setView("left",a)},getCenter:function(){return this.__center},setCenter:function(a){return this.__setView("center",a)},getRight:function(){return this.__right},setRight:function(a){return this.__setView("right",a)},__setView:function(a,b){return this.removeChild(this["__"+a]),this["__"+a]=null,b&&(b.setEl('[data-selector="'+a+'"]'),this["__"+a]=this.addChild(b)),b}}),BetaJS.Views.View.extend("BetaJS.Views.ListContainerView",{_templates:{item:BetaJS.Templates.Cached["list-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.ListContainerView,"constructor",a),this._setOption(a,"alignment","horizontal"),this._setOption(a,"positioning","float"),this._setOption(a,"clear_float",!1),this._setOption(a,"container_element","div"),this.on("show",function(){"computed"==this.__positioning&&this.__updatePositioning()},this)},isHorizontal:function(){return"horizontal"==this.__alignment},_render:function(){this.__clear_float?this.$el.html("<div data-selector='clearboth' style='clear:both'></div>"):this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){var b=this.childOptions(a);if(this.isActive()){var c=this.evaluateTemplate("item",{cid:a.cid(),container_element:this.__container_element});this.__clear_float?this.$("[data-selector='clearboth']").before(c):this.$el.append(c)}if(a.setEl("[data-view-id='"+a.cid()+"']"),!this.isHorizontal()||"float"in b||"float"!=this.__positioning||(b["float"]="left"),this.isActive()&&"float"in b&&"float"==this.__positioning){var d=this.$("[data-view-id='"+a.cid()+"']");d.css("float",b["float"])}},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove()},__updatePositioningHelper:function(a,b,c){var d=0;BetaJS.Objs.iter(a,function(a){var e=this.childOptions(a);return e.type&&"ignore"==e.type||(a.$el.css(b,d+"px"),a.isVisible()&&(d+=parseInt(a.$el.css(c),10)),!e.type||"dynamic"!=e.type)?void 0:!1},this)},__updatePositioning:function(){var a=BetaJS.Objs.values(this.children()),b=BetaJS.Objs.clone(a,1).reverse(),c=this.isHorizontal()?"left":"top",d=this.isHorizontal()?"right":"bottom",e=this.isHorizontal()?"width":"height";this.__updatePositioningHelper(b,d,e),this.__updatePositioningHelper(a,c,e)},updateChildVisibility:function(a){this._inherited(BetaJS.Views.ListContainerView,"updateChildVisibility",a),"computed"==this.__positioning&&this.__updatePositioning()}}),BetaJS.Views.View.extend("BetaJS.Views.SingleContainerView",{constructor:function(a){this._inherited(BetaJS.Views.SingleContainerView,"constructor",a),this.__view=null},getView:function(){return this.__view},setView:function(a){return this.removeChild(this.__view),a&&(a.setEl(""),this.__view=this.addChild(a)),a}}),BetaJS.Views.View.extend("BetaJS.Views.SwitchContainerView",{_templates:{item:BetaJS.Templates.Cached["switch-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){this._inherited(BetaJS.Views.SwitchContainerView,"constructor",a),this.__selected=null},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:a.cid()})),a.setEl("[data-view-id='"+a.cid()+"']"),this.__selected=this.__selected||a,a.setVisibility(this.__selected==a)},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove(),this.__selected==a&&(this.__selected=null)},select:function(a){this.__selected=a,BetaJS.Objs.iter(this.children(),function(a){a.setVisibility(this.__selected==a)},this)},selected:function(){return this.__selected}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.TabbedView",{constructor:function(a){a=BetaJS.Objs.extend(a||{},{alignment:"vertical",positioning:"none"}),this._inherited(BetaJS.Views.TabbedView,"constructor",a),this.toolbar=this.addChild(new BetaJS.Views.ToolBarView),this.container=this.addChild(new BetaJS.Views.SwitchContainerView),this.toolbar.on("item:click",function(a){this.select(a)},this),a.tabs&&BetaJS.Objs.iter(a.tabs,function(a){this.addTab(a)},this)},addTab:function(a){a=BetaJS.Objs.extend(a,{selectable:!0,deselect_all:!0});var b=this.toolbar.addItem(a);return b.__tabView=this.container.addChild(a.view),a.view.__tabButton=b,a.selected&&this.select(b),b.__tabView},select:function(a){var b=null;return b=BetaJS.Types.is_string(a)?this.toolbar.itemByIdent(a).__tabView:a.__tabButton?a:a.__tabView,this.container.select(b),b.__tabButton.select(),this.trigger("select",b),b}}),BetaJS.Views.View.extend("BetaJS.Views.ButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["button-view-template"]},_css:function(){return{disabled:"","default":"",selected:""}},constructor:function(a){if(a=a||{},this._inherited(BetaJS.Views.ButtonView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"button_container_element","button"),this._setOptionProperty(a,"disabled",!1),this._setOptionProperty(a,"selected",!1),this._setOption(a,"selectable",!1),this._setOption(a,"deselect_all",!1),a.hotkey){var b={};b[a.hotkey]=function(){this.click()},this.add_module(new BetaJS.Views.Modules.Hotkeys({hotkeys:b}))}},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click [data-selector='button-inner']":"click"}])},click:function(){this.get("disabled")||(this.__selectable&&this.select(),this.trigger("click"))},_bindParent:function(a){a.on("deselect",function(){this.unselect()},this)},_unbindParent:function(a){a.off("deselect",this)},select:function(){this.__selectable&&(this.__deselect_all&&this.getParent().trigger("deselect"),this.getParent().trigger("select",this),this.set("selected",!0))},unselect:function(){this.__selectable&&this.set("selected",!1)},isSelected:function(){return this.get("selected")}}),BetaJS.Views.View.extend("BetaJS.Views.CheckBoxView",{_templates:{"default":BetaJS.Templates.Cached["check-box-view-template"]},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click input":"__click"}])},constructor:function(a){a=a||{},a.invalidate_on_change=!0,this._inherited(BetaJS.Views.CheckBoxView,"constructor",a),this._setOptionProperty(a,"checked",!1),this._setOptionProperty(a,"label","")},__click:function(){this.set("checked",this.$("input").is(":checked")),this.trigger("check",this.get("checked"))}}),BetaJS.Views.SwitchContainerView.extend("BetaJS.Views.InputLabelView",{constructor:function(a){this._inherited(BetaJS.Views.InputLabelView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOption(a,"edit_on_click",!0),this._setOption(a,"label_mode",!0),this._setOption(a,"read_only",!1),this.label=this.addChild(new BetaJS.Views.LabelView({label:this.binding("value"),el_classes:a.label_el_classes,children_classes:a.label_children_classes})),this.input=this.addChild(new BetaJS.Views.InputView({value:this.binding("value"),placeholder:this.binding("placeholder")})),this.__label_mode||this.select(this.input),this.input.on("leave enter_key",function(){this.label_mode()},this),this.__edit_on_click&&this.label.on("click",function(){this.edit_mode()},this)},is_label_mode:function(){return this.__label_mode},is_edit_mode:function(){return!this.__label_mode},label_mode:function(){this.is_label_mode()||(this.__label_mode=!0,this.select(this.label))},edit_mode:function(){this.is_edit_mode()||this.__read_only||(this.__label_mode=!1,this.select(this.input),this.input.focus(!0))}}),BetaJS.Views.View.extend("BetaJS.Views.InputView",{_dynamics:{"default":BetaJS.Templates.Cached["input-view-template"]},_events:function(){return[{"blur input":"__leaveEvent","keyup input":"__changeEvent","change input":"__changeEvent","input input":"__changeEvent","paste input":"__changeEvent"},{"keyup input":"__keyupEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.InputView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOptionProperty(a,"clear_after_enter",!1),this._setOptionProperty(a,"horizontal_fill",!1),this._setOptionProperty(a,"input_type","text")},__keyupEvent:function(a){var b=a.keyCode||a.which;13==b&&(this.trigger("enter_key",this.get("value")),this.get("clear_after_enter")&&this.set("value",""))},__leaveEvent:function(){this.trigger("leave")},__changeEvent:function(){this.trigger("change",this.get("value"))},focus:function(a){this.$("input").focus(),this.$("input").focus(),a&&this.$("input").select()}}),BetaJS.Views.View.extend("BetaJS.Views.LabelView",{_dynamics:{"default":BetaJS.Templates.Cached["label-view-template"]},_css:function(){return{label:"label-view-class"}},_events:function(){return[{click:"__clickEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.LabelView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"element","span")},__clickEvent:function(){this.trigger("click")}}),BetaJS.Views.View.extend("BetaJS.Views.LinkView",{_dynamics:{"default":BetaJS.Templates.Cached["link-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.LinkView,"constructor",a),this._setOptionProperty(a,"label","")},_events:function(){return this._inherited(BetaJS.Views.LinkView,"_events").concat([{"click a":"__click"}])},__click:function(){this.trigger("click")}}),BetaJS.Views.View.extend("BetaJS.Views.ProgressView",{_templates:{"default":BetaJS.Templates.Cached["progress-template"]},_css:function(){return{outer:"",inner:""}},constructor:function(a){this._inherited(BetaJS.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"horizontal",!0),this._setOptionProperty(a,"value",1),this.on("change:value",function(a){this.isActive()&&this.$("[data-selector='inner']").css(this.get("horizontal")?"width":"height",100*a+"%")},this),this.on("change:label",function(a){this.isActive()&&this.$("[data-selector='label']").html(a)},this)}}),BetaJS.Views.View.extend("BetaJS.Views.TextAreaView",{_dynamics:{"default":BetaJS.Templates.Cached["text-area-template"]},constructor:function(a){this._inherited(BetaJS.Views.TextAreaView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOptionProperty(a,"horizontal_resize",!1),this._setOptionProperty(a,"vertical_resize",!0),this._setOptionProperty(a,"horizontal_fill",!1),this._setOptionProperty(a,"readonly",!1),this.on("change:readonly",function(){this.get("readonly")?this.$("textarea").attr("readonly","readonly"):this.$("textarea").removeAttr("readonly")},this)},addLine:function(a){this.get("value")?this.set("value",this.get("value")+"\n"+a):this.set("value",a),this.scrollToEnd()},scrollToEnd:function(){var a=this.$("textarea").get(0);a.scrollTop=a.scrollHeight}}),BetaJS.Views.View.extend("BetaJS.Views.CustomListView",{_templates:function(){return{"default":BetaJS.Templates.Cached["list-view-template"],"item-container":BetaJS.Templates.Cached["list-view-item-container-template"]}},_supp:function(){return BetaJS.Objs.extend(this._inherited(BetaJS.Views.CustomListView,"_supp"),{list_item_attr:function(a){return this.attrs({"data-view-id":this.__context.cid(),"data-cid":BetaJS.Ids.objectId(a),"data-index":this.__context.__collection.getIndex(a)})}})},_notifications:{activate:"__activateItems",deactivate:"__deactivateItems"},_events:function(){return[{click:"__click"}]},constructor:function(a){if(this._inherited(BetaJS.Views.CustomListView,"constructor",a),this._setOption(a,"list_container_element","ul"),this._setOption(a,"list_container_attrs",{}),this._setOption(a,"list_container_classes",""),this._setOption(a,"item_container_element","li"),this._setOption(a,"item_container_classes",""),this._setOption(a,"selectable",!0),this._setOption(a,"multi_select",!1),this._setOption(a,"click_select",!1),this.__itemData={},"table"in a){var b=this.cls.parseType(a.table,"object");this.active_query=new BetaJS.Queries.ActiveQuery(b.active_query_engine(),{}),a.collection=this.active_query.collection(),a.destroy_collection=!0}if("compare"in a&&(a.compare=this.cls.parseType(a.compare,"function")),"collection"in a)this.__collection=a.collection,this.__destroy_collection="destroy_collection"in a?a.destroy_collection:!1,"compare"in a&&this.__collection.set_compare(a.compare);else{var c={};"objects"in a&&(c.objects=a.objects),"compare"in a&&(c.compare=a.compare),this.__collection=new BetaJS.Collections.Collection(c),this.__destroy_collection=!0}this.__collection.on("add",function(a){this._addItem(a)},this),this.__collection.on("remove",function(a){this._removeItem(a)},this),this.__collection.on("change",function(a){this._changeItem(a)},this),this.__collection.on("index",function(a,b){this.__updateItemIndex(a,b)},this),this.__collection.on("reindexed",function(a){this.__reIndexItem(a)},this),this.__collection.on("sorted",function(){this.__sort()},this),this.__collection.iterate(function(a){this._registerItem(a)},this)},destroy:function(){this.__collection.iterate(function(a){this._unregisterItem(a)},this),this.__collection.off(null,null,this),this.__destroy_collection&&this.__collection.destroy(),this._inherited(BetaJS.Views.CustomListView,"destroy")},_itemBySubElement:function(a){var b=a.closest("[data-view-id='"+this.cid()+"']");return 0===b.length?null:this.__collection.getById(b.attr("data-cid"))},__click:function(a){if(this.__click_select&&this.__selectable){var b=this._itemBySubElement(BetaJS.$(a.target));b&&this.select(b)}},collection:function(){return this.__collection},add:function(a){this.__collection.add(a)},remove:function(a){this.__collection.remove(a)},_render:function(){this.$selector_list=this._renderListContainer()},_renderListContainer:function(){return this.$el.html(this.evaluateTemplate("default",{list_container_element:this.__list_container_element,list_container_attrs:this.__list_container_attrs,list_container_classes:this.__list_container_classes})),this.$data({selector:"list"})},invalidate:function(){this.isActive()&&this.__deactivateItems(),this._inherited(BetaJS.Views.CustomListView,"invalidate"),this.isActive()&&this.__activateItems()},__activateItems:function(){this.__collection.iterate(function(a){this._activateItem(a)},this)},__deactivateItems:function(){this.__collection.iterate(function(a){this._deactivateItem(a)},this)},itemElement:function(a){return this.$data({"view-id":this.cid(),cid:BetaJS.Ids.objectId(a)},this.$selector_list)},_findIndexElement:function(a){return this.$data({"view-id":this.cid(),index:a},this.$selector_list)},_changeItem:function(){},__updateItemIndex:function(a,b){var c=this.itemElement(a);c.attr("data-index",b),this._updateItemIndex(a,c)},__reIndexItem:function(a){var b=this.itemElement(a),c=this.collection().getIndex(a);if(0===c)this.$selector_list.prepend(b);else{var d=this._findIndexElement(c-1);d.after(b)}},_updateItemIndex:function(){},__sort:function(){for(var a=this.collection().count()-1;a>=0;a--)this.$selector_list.prepend(this._findIndexElement(a))},itemData:function(a){return this.__itemData[a.cid()]},_registerItem:function(a){this.__itemData[a.cid()]={properties:new BetaJS.Properties.Properties({selected:!1,new_element:!1})}},_unregisterItem:function(a){this.__itemData[a.cid()]&&(this.__itemData[a.cid()].properties.destroy(),delete this.__itemData[a.cid()])},_activateItem:function(a){var b=this.evaluateTemplate("item-container",{item:a,item_container_element:this.__item_container_element,item_container_attrs:this.__item_container_attrs,item_container_classes:this.__item_container_classes}),c=this.__collection.getIndex(a);if(0===c)this.$selector_list.prepend(b);else{var d=this._findIndexElement(c-1);if(d.length>0)d.after(b);else{var e=this._findIndexElement(c+1);e.length>0?e.before(b):this.$selector_list.append(b)}}this.trigger("activate_item",a)},_deactivateItem:function(a){this.itemData(a).new_element=!1;var b=this.itemElement(a);b.remove()},_addItem:function(a){this._registerItem(a),this.isActive()&&(this.itemData(a).new_element=!0,this._activateItem(a))},_removeItem:function(a){this.isActive()&&this._deactivateItem(a),this._unregisterItem(a)},isSelected:function(a){return this.itemData(a).properties.get("selected")},select:function(a){var b=this.itemData(a);return this.__selectable&&!this.isSelected(a)&&(this.__multi_select||this.collection().iterate(function(a){this.unselect(a)},this),b.properties.set("selected",!0),this.trigger("select",a)),b},unselect:function(a){var b=this.itemData(a);return this.__selectable&&this.isSelected(a)&&(b.properties.set("selected",!1),this.trigger("unselect",a)),b}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.ListView",{constructor:function(a){a=a||{},"item_template"in a&&(a.templates={item:a.item_template}),"item_dynamic"in a&&(a.dynamics={item:a.item_dynamic}),this._inherited(BetaJS.Views.ListView,"constructor",a),this._setOption(a,"item_label","label"),this._setOption(a,"render_item_on_change",BetaJS.Types.is_defined(this.dynamics("item")))},_changeItem:function(a){this._inherited(BetaJS.Views.ListView,"_changeItem",a),this.__render_item_on_change&&this.isActive()&&this._renderItem(a)
},_activateItem:function(a){this._inherited(BetaJS.Views.ListView,"_activateItem",a),this._renderItem(a)},_renderItem:function(a){var b=this.itemElement(a),c=this.itemData(a).properties;this.templates("item")?b.html(this.evaluateTemplate("item",{item:a,properties:c})):this.dynamics("item")?this.evaluateDynamics("item",b,{item:a,properties:c},{name:"item-"+BetaJS.Ids.objectId(a)}):b.html(a.get(this.__item_label))},_deactivateItem:function(a){this.dynamics("item")&&this.dynamics("item").removeInstanceByName("item-"+BetaJS.Ids.objectId(a)),this._inherited(BetaJS.Views.ListView,"_deactivateItem",a)}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.SubViewListView",{_sub_view:BetaJS.Views.View,_sub_view_options:function(a){return{item:a,item_properties:this.itemData(a).properties}},_property_map:function(){},constructor:function(a){this._inherited(BetaJS.Views.SubViewListView,"constructor",a),"create_view"in a&&(this._create_view=a.create_view),"sub_view"in a&&(this._sub_view=this.cls.parseType(a.sub_view,"object")),"sub_view_options"in a&&(this._sub_view_options_param=a.sub_view_options),"property_map"in a&&(this._property_map_param=a.property_map)},_create_view:function(a){var b=BetaJS.Objs.extend(BetaJS.Types.is_function(this._property_map)?this._property_map.apply(this,[a]):this._property_map,BetaJS.Types.is_function(this._property_map_param)?this._property_map_param.apply(this,[a]):this._property_map_param),c=BetaJS.Objs.extend(BetaJS.Types.is_function(this._sub_view_options)?this._sub_view_options.apply(this,[a]):this._sub_view_options,BetaJS.Objs.extend(BetaJS.Types.is_function(this._sub_view_options_param)?this._sub_view_options_param.apply(this,[a]):this._sub_view_options_param||{},BetaJS.Objs.map(b,a.get,a)));return c.el=this.itemElement(a),new this._sub_view(c)},_activateItem:function(a){this._inherited(BetaJS.Views.SubViewListView,"_activateItem",a);var b=this._create_view(a);this.delegateEvents(null,b,"item",[b,a]),this.itemData(a).view=b,this.addChild(b)},_deactivateItem:function(a){var b=this.itemData(a).view;this.removeChild(b),b.destroy(),this._inherited(BetaJS.Views.SubViewListView,"_deactivateItem",a)}}),BetaJS.Classes.Module.extend("BetaJS.Views.Modules.ListViewAnimation",{_register:function(a){a.on("activate_item",function(b){if(a.itemData(b).new_element){var c=a.itemElement(b);c.css("display","none"),c.fadeIn()}},this)}},{__singleton:null,singleton:function(){return this.__singleton||(this.__singleton=new this({auto_destroy:!1})),this.__singleton}}),BetaJS.Views.View.extend("BetaJS.Views.OverlayView",{_templates:{"default":BetaJS.Templates.Cached["overlay-view-template"]},constructor:function(a){a=a||{},a.anchor=a.anchor||"absolute",a.visible="visible"in a?a.visible:!1,a.children_classes=a.children_classes||[],BetaJS.Types.is_string(a.children_classes)&&(a.children_classes=a.children_classes.split(" ")),a.children_classes.push("overlay-container-class"),this._inherited(BetaJS.Views.OverlayView,"constructor",a),this._setOption(a,"anchor","none"),this._setOption(a,"element",""),this._setOption(a,"overlay_left",0),this._setOption(a,"overlay_top",0),this._setOption(a,"overlay_align_vertical","top"),this._setOption(a,"overlay_align_horizontal","left"),this._setOption(a,"element_align_vertical","bottom"),this._setOption(a,"element_align_horizontal","left"),a.overlay_inner&&(a.overlay_inner.setEl('[data-selector="container"]'),this.overlay_inner=this.addChild(a.overlay_inner)),"hide_on_leave"in a&&!a.hide_on_leave||this.add_module(BetaJS.Views.Modules.HideOnLeave.singleton()),this.on("show",this._after_show,this)},_after_show:function(){if("none"!=this.__anchor){var a=this.$(".overlay-container-class"),b=a.outerWidth(),c=a.outerHeight(),d=this.__overlay_left,e=this.__overlay_top;"bottom"==this.__overlay_align_vertical?e-=c:"center"==this.__overlay_align_vertical&&(e-=Math.round(c/2)),"right"==this.__overlay_align_horizontal?d-=b:"center"==this.__overlay_align_horizontal&&(d-=Math.round(b/2));var f=this.$el;"element"==this.__anchor&&this.__element&&(f=this.__element,BetaJS.Types.is_string(f)?f=BetaJS.$(f):BetaJS.Class.is_class_instance(f)&&(f=f.$el)),("relative"==this.__anchor||"element"==this.__anchor)&&(element_width=f.outerWidth(),element_height=f.outerHeight(),d+=f.offset().left-BetaJS.$(window).scrollLeft(),e+=f.offset().top-BetaJS.$(window).scrollTop(),"bottom"==this.__element_align_vertical?e+=element_height:"center"==this.__element_align_vertical&&(e+=Math.round(element_height/2)),"right"==this.__element_align_horizontal?d+=element_width:"center"==this.__element_align_horizontal&&(d+=Math.round(element_width/2))),a.css("left",d+"px"),a.css("top",e+"px")}}}),BetaJS.Views.View.extend("BetaJS.Views.FullscreenOverlayView",{_templates:{"default":BetaJS.Templates.Cached["fullscreen-overlay-view-template"]},_events:function(){return[{'click [data-selector="outer"]':"unfocus",'touchstart [data-selector="outer"]':"unfocus"}]},constructor:function(a){a=a||{},a.el=a.el||"body",a.append_to_el="append_to_el"in a?a.append_to_el:!0,a.visible="visible"in a?a.visible:!1,this._inherited(BetaJS.Views.FullscreenOverlayView,"constructor",a),a.overlay_inner.setEl('[data-selector="inner"]'),this.overlay_inner=this.addChild(a.overlay_inner),this._setOption(a,"hide_on_unfocus",!0),this._setOption(a,"destroy_on_unfocus",!1),this.on("show",this._after_show,this),this.on("hide",this._after_hide,this)},_after_show:function(){var a=this.$('[data-selector="outer"]'),b=this.$('[data-selector="inner"]'),c=this.$('[data-selector="container"]');c.removeClass("fullscreen-overlay-float"),c.removeClass("fullscreen-overlay-fit");var d=a.outerWidth(),e=a.outerHeight(),f=b.outerWidth(),g=b.outerHeight(),h=Math.floor((d-f)/2),i=Math.floor((e-g)/2);h>=0&&i>=0?(c.css("left",h+"px"),c.css("top",i+"px"),c.addClass("fullscreen-overlay-float")):(c.css("left","0px"),c.css("top","0px"),c.addClass("fullscreen-overlay-fit")),BetaJS.$("body").addClass("fullscreen-overlay-body")},_after_hide:function(){BetaJS.$("body").removeClass("fullscreen-overlay-body")},unfocus:function(){this.__destroy_on_unfocus?this.destroy():this.__hide_on_unfocus&&this.hide()}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.FormControlView",{constructor:function(a){this._inherited(BetaJS.Views.FormControlView,"constructor",a),this._model=a.model,this._property=a.property,this._setOption(a,"validate_on_change",!1),this._setOption(a,"validate_on_show",!1),this._setOption(a,"error_classes",""),this.control_view=this.addChild(this._createControl(this._model,this._property,a.control_options||{})),this.label_view=this.addChild(new BetaJS.Views.LabelView(BetaJS.Objs.extend(a.label_options||{},{visible:!1}))),this.__validate_on_change&&this._model.on("change:"+this._property,this.validate,this),this.__validate_on_show&&this.on("show",this.validate,this),this._model.on("validate:"+this._property,this.validate,this)},validate:function(){if(this.isActive()){var a=this._model.validateAttr(this._property);this.label_view.setVisibility(!a),a?this.$el.removeClass(this.__error_classes):(this.$el.addClass(this.__error_classes),this.label_view.set("label",this._model.getError(this._property)))}},_createControl:function(){}}),BetaJS.Views.FormControlView.extend("BetaJS.Views.FormInputView",{_createControl:function(a,b,c){return new BetaJS.Views.InputView(BetaJS.Objs.extend(c,{value:a.binding(b)}))}}),BetaJS.Views.FormControlView.extend("BetaJS.Views.FormCheckBoxView",{_createControl:function(a,b,c){return new BetaJS.Views.CheckBoxView(BetaJS.Objs.extend(c,{checked:a.binding(b)}))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.ToolBarView",{_css:function(){return{divider:"divider",group:"group"}},constructor:function(a){a=BetaJS.Objs.extend({clear_float:!0},a||{}),this._inherited(BetaJS.Views.ToolBarView,"constructor",a),this.__group_by_ident={},this.__item_by_ident={},a.groups&&BetaJS.Objs.iter(a.groups,function(a){this.addGroup(a)},this),a.items&&BetaJS.Objs.iter(a.items,function(a){this.addItem(a)},this)},__group_parent_options:BetaJS.Objs.objectify(["group_ident","group_type","group_options"]),addGroup:function(a){var b={group_type:"container"},c={};BetaJS.Objs.iter(a||{},function(a,d){d in this.__group_parent_options?b[d]=a:c[d]=a},this);var d=null;if("container"==b.group_type){if(c.el_classes=this.css("group"),d=this.addChild(new BetaJS.Views.ListContainerView(c),b),b.group_ident){if(b.group_ident in this.__group_by_ident)throw"Group identifier already registered: "+b.group_ident;this.__group_by_ident[b.group_ident]=d}return d}if("divider"!=b.group_type)throw"Unknown group type: "+b.group_type;return c.el_classes=this.css("divider"),d=this.addChild(new BetaJS.Views.View(c),b)},__item_parent_options:BetaJS.Objs.objectify(["item_ident","item_type","item_group"]),addItem:function(a){var b={item_type:"ButtonView"},c={};BetaJS.Objs.iter(a||{},function(a,d){d in this.__item_parent_options?b[d]=a:c[d]=a},this),b.item_type in BetaJS.Views&&(b.item_type=BetaJS.Views[b.item_type]),BetaJS.Types.is_string(b.item_type)&&(b.item_type=BetaJS.Objs.Scopes.get(b.item_type,window));var d=this;if(b.item_group){if(!(b.item_group in this.__group_by_ident))throw"Unknown group identifier: "+b.item_group;d=this.__group_by_ident[b.item_group];var e=this.childOptions(d);c=BetaJS.Objs.extend(e.group_options||{},c)}var f=d.addChild(new b.item_type(c),b);if(this.delegateEvents(null,f,"item",[f,b]),b.item_ident&&this.delegateEvents(null,f,"item-"+b.item_ident,[f,b]),b.item_ident){if(b.item_ident in this.__item_by_ident)throw"Item identifier already registered: "+b.item_ident;this.__item_by_ident[b.item_ident]=f}return f},itemByIdent:function(a){return this.__item_by_ident[a]}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["video-player-image-template"]='  <div class="video-player-outer" style="width: {%= meta.width %}px; height: {%= meta.height %}px">   <div class="video-player-inner">    {% if (meta.image) { %}     <img class="video-player-content"      src="{%= meta.image %}"      width="{%= meta.fit_width %}"      height="{%= meta.fit_height %}"      style="max-width: {%= meta.fit_width %}px; width: {%= meta.fit_width %}px; max-height: {%= meta.fit_height %}px; height: {%= meta.fit_height %}px"/>    {% } %}   </div>   <div data-selector="play-button"></div>   <div data-selector="status"></div>  </div> ',BetaJS.Templates.Cached["video-player-play-template"]='  <div data-selector="player" class="video-player-outer" style="width: {%= meta.width %}px; height: {%= meta.height %}px">   <div class="video-player-inner" stylex="width: 100%; height: 100%">    <div class="video-player-content" data-selector="inner-player" style="width: 100%; height: 100%">     <div id="player-{%= id %}"></div>    </div>   </div>  </div> ',BetaJS.Views.View.extend("BetaJS.Views.VideoPlayerImageView",{_templates:{"default":BetaJS.Templates.Cached["video-player-image-template"]},_notifications:{activate:"__activatePlayer"},constructor:function(a){var b=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta);this.meta=b;var c=BetaJS.Objs.extend(BetaJS.Objs.clone(BetaJS.Types.is_function(BetaJS.Views.VideoPlayerImageView.defaultPlayButton)?BetaJS.Views.VideoPlayerImageView.defaultPlayButton():BetaJS.Views.VideoPlayerImageView.defaultPlayButton,1),a.styling||{});if(this._inherited(BetaJS.Views.VideoPlayerImageView,"constructor",a),c.play_button){BetaJS.Types.is_function(c.play_button_options)&&(c.play_button_options=c.play_button_options(b)),c.play_button_options.el="[data-selector='play-button']";var d=c.play_button_options;d.el_styles=d.el_styles||{},d.modules=d.modules||[],"center"==c.play_button_vertical_align?d.modules.push(BetaJS.Views.Modules.Centering.vertical()):"top"==c.play_button_vertical_align?d.el_styles.top=Math.floor(this.meta.height/50)+"px":"bottom"==c.play_button_vertical_align&&(d.el_styles.bottom=Math.floor(this.meta.height/50)+"px"),"center"==c.play_button_horizontal_align?d.modules.push(BetaJS.Views.Modules.Centering.horizontal()):"left"==c.play_button_horizontal_align?d.el_styles.left=Math.floor(this.meta.width/50)+"px":"right"==c.play_button_horizontal_align&&(d.el_styles.right=Math.floor(this.meta.width/50)+"px"),this.play_button=this.addChild(new c.play_button(d)),this.play_button.on("click",function(){this.trigger("play")},this)}this.status_view=this.addChild(new BetaJS.Views.LabelView({el_classes:"video-player-status",button_container_element:"div",el_styles:{"font-size":Math.round(Math.min(b.width,b.height)/20)+"px","line-height":Math.round(Math.min(b.width,b.height)/20+4)+"px"},vertical_center:!0,el:"[data-selector='status']",visible:!1}))},templateArguments:function(){return{meta:this.meta}},__updateDimensions:function(a,b){if(a/b!=this.meta.fit_width/this.meta.fit_height){var c=this.meta.asObject();c.video_width=a,c.video_height=b,this.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(c),this.invalidate(),this.$("img").css("top",Math.floor((this.meta.height-this.meta.fit_height)/2)+"px"),this.$("img").css("display","")}},__activatePlayer:function(){if(this.meta.updateDimensionByParent(this.$el.parent()),this.$el.width(this.meta.width),this.$el.height(this.meta.height),this.meta.image){this.$("img").css("top",Math.floor((this.meta.height-this.meta.fit_height)/2)+"px");var a=(this.$("img").get(0),new Image),b=this;a.onload=function(){b&&b.meta&&this.width&&this.height&&b.__updateDimensions(this.width,this.height)},a.onerror=function(){b.__image_error||(b.__image_error=!0,b.showStatus("Could not display cover shot.",!0),b.$("img").css("display","none"),b.trigger("image-error"))},a.src=this.meta.image}},showStatus:function(a,b){BetaJS.Types.is_undefined(b)&&(b=!0),this.status_view.set("label",a),this.status_view.show(),b&&this.play_button.hide()},hideStatus:function(){this.status_view.hide(),this.play_button.show()}}),BetaJS.Views.VideoPlayerImageView.defaultPlayButton={play_button:BetaJS.Views.LabelView,play_button_options:function(a){return{label:"&#9658;",el_classes:"view-player-play-label",el_styles:{"font-size":Math.floor(Math.min(a.width,a.height)/6)+"px","line-height":Math.floor(Math.min(a.width,a.height)/6)+"px",height:Math.floor(Math.min(a.width,a.height)/6)+"px",width:Math.floor(Math.min(a.width,a.height)/6)+"px"}}},play_button_vertical_align:"center",play_button_horizontal_align:"center"},BetaJS.Views.View.extend("BetaJS.Views.VideoPlayerPlayView",{_templates:{"default":BetaJS.Templates.Cached["video-player-play-template"]},_notifications:{activate:"__activatePlayer",deactivate:"detach"},constructor:function(a){this.raw_sources=a.sources,this.sources=BetaJS.Objs.map(a.sources,function(a){return BetaJS.Views.VideoPlayerView.Source.get(a)}),this.rules=a.rules||BetaJS.Views.VideoPlayerView._options.rules||[],this.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta),this.config=BetaJS.Objs.extend({auto_play:!1},a.config||{}),this._inherited(BetaJS.Views.VideoPlayerPlayView,"constructor",a)},templateArguments:function(){return{meta:this.meta,id:this.cid()}},__activatePlayer:function(){this.meta.updateDimensionByParent(this.$el.parent()),this.$el.width(this.meta.width),this.$el.height(this.meta.height),this.$("[data-selector='inner-player']").css("top",Math.floor((this.meta.height-this.meta.fit_height)/2)+"px"),this.trigger("ready_to_play"),this.config.auto_play&&this.play()},play:function(){this.player&&this.player.destroy(),this.player=null;var a=null,b=null;BetaJS.Objs.iter(this.rules,function(c){return BetaJS.Objs.iter(this.sources,function(d){return c.applies(d)?(a=c,b=d,!1):void 0},this)},this),a?(this.__source=b,this.__rule=a,this.trigger("select",b,a),this.player=a.new_player(b,"player-"+this.cid(),{auto_play:!0,width:this.meta.fit_width,height:this.meta.fit_height,video_width:this.meta.video_width,video_height:this.meta.video_height,image:this.meta.image}),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,this.player),this.player.attach()):this.trigger("error","Could not play video.")},detach:function(){this.player&&(this.player.destroy(),this.player=null)},source:function(){return this.__source},rule:function(){return this.__rule}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoPlayerView",{_notifications:{preactivate:"__preactivatePlayer",activate:"__activatePlayer"},constructor:function(a){a.alignment="vertical",a.positioning="none",this._inherited(BetaJS.Views.VideoPlayerView,"constructor",a);var b=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta);this.meta=b,this.image_view=this.addChild(new BetaJS.Views.VideoPlayerImageView({meta:this.meta,styling:a.styling})),this.config=a.config||{auto_play:!1},this.play_view=this.addChild(new BetaJS.Views.VideoPlayerPlayView({rules:a.rules,sources:a.sources,meta:this.meta,visible:!1})),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,this.play_view),this.image_view.on("play",function(){this.play()},this),this.image_view.on("image-error",function(){this.trigger("image-error")},this),this.on("error",function(a){this.image_view.show(),this.play_view.hide(),this.image_view.showStatus(a,!0)})},__preactivatePlayer:function(){this.meta.updateDimensionByParent(this.$el.parent()),this.$el.width(this.meta.width),this.$el.height(this.meta.height)},__activatePlayer:function(){this.config.auto_play&&this.play()},play:function(){this.image_view.hide(),this.play_view.show(),this.play_view.play()},stop:function(){this.play_view.detach(),this.play_view.hide(),this.image_view.show()},player:function(){return this.play_view}},{_options:{},setup:function(a){this._options=a}}),BetaJS.Views.VideoPlayerView.events=["play","params","error","select","pause","stop","ready_to_play"],BetaJS.Views.FullscreenOverlayView.extend("BetaJS.Views.OverlayVideoPlayerView",{constructor:function(a){if(a.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta),a.meta.width&&a.meta.height&&(BetaJS.$(window).width()<a.meta.width||BetaJS.$(window).height()<a.meta.height)){var b=.85*BetaJS.$(window).width(),c=b*a.meta.height/a.meta.width;a.meta.width=b,a.meta.height=c}a.meta=a.meta.asObject();var d=new BetaJS.Views.VideoPlayerView({rules:a.rules,sources:a.sources,meta:a.meta,config:a.config||{auto_play:!0},styling:a.styling});a.overlay_inner=d,this._inherited(BetaJS.Views.OverlayVideoPlayerView,"constructor",a),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,d),this.on("hide",function(){this.overlay_inner.stop()},this)},play:function(){this.overlay_inner.play()},player:function(){return this.overlay_inner.player()}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.ImageOverlayVideoPlayerView",{constructor:function(a){if(a.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta),a.meta.width&&a.meta.height&&(BetaJS.$(window).width()<a.meta.width||BetaJS.$(window).height()<a.meta.height)){var b=.85*BetaJS.$(window).width(),c=b*a.meta.height/a.meta.width;a.meta.width=b,a.meta.height=c}a.meta=a.meta.asObject(),a.alignment="vertical",a.positioning="none",this._inherited(BetaJS.Views.ImageOverlayVideoPlayerView,"constructor",a),this.overlay=this.addChild(new BetaJS.Views.OverlayVideoPlayerView({rules:a.rules,sources:a.sources,meta:a.meta,config:{auto_play:!1},styling:a.styling})),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,this.overlay);var d=BetaJS.Objs.clone(a.meta,1);this.image=this.addChild(new BetaJS.Views.VideoPlayerImageView({meta:BetaJS.Objs.extend(d,a.image_meta||{}),styling:a.styling})),this.image.on("play",function(){this.play()},this)},play:function(){this.overlay.show(),this.overlay.play()},player:function(){return this.overlay.player()}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.Source",{constructor:function(a){if(this._inherited(BetaJS.Views.VideoPlayerView.Source,"constructor"),this.priority=a.priority||0,this.video=a.video,this.streamer=a.streamer,this.protocol=a.protocol,this.secure=a.secure||!1,this.port=a.port,this.uri=a.uri,this.domain=a.domain,this.path=a.path,this.file=a.file,this.uri){var b=this.cls.decomposeUri(this.uri);this.protocol=b.protocol,this.domain=b.domain,b.port&&(this.port=b.port),this.path=b.path,this.file=b.file}this.video||(this.video=this.cls.videoByFile(this.file)),this.protocol&&!this.streamer&&(this.streamer=this.cls.streamerByProtocolAndVideo(this.protocol,this.video)),!this.protocol&&this.streamer&&(this.protocol=this.cls.protocolByStreamerAndSecure(this.streamer,this.secure)),this.secure=this.cls.secureByProtocol[this.protocol],this.port||(this.port=this.cls.portByProtocol[this.protocol]),this.uri||(this.uri=this.cls.composeUri(this.protocol,this.domain,this.port,this.path,this.file)),this.extension=this.cls.videoByFile(this.file)}},{decomposeUri:function(a){var b=BetaJS.Net.Uri.parse(a);return{protocol:b.protocol,port:b.port,domain:b.host,path:b.directory,file:b.file}},videoByFile:function(a){return BetaJS.Strings.last_after(a,".")},streamerByProtocolAndVideo:function(a,b){return"m3u8"==b?"hls":this.streamerByProtocol[a]},protocolByStreamerAndSecure:function(a,b){return"hls"==a&&(a="http"),b?a+"s":a},streamerByProtocol:{rtmp:"rtmp",rtmps:"rtmp",rtsp:"rtsp",rtsps:"rtsp",http:"http",https:"http"},secureByProtocol:{rtmp:!1,rtmps:!0,rtsp:!1,rtsps:!0,http:!1,https:!0},portByProtocol:{rtmp:1935,rtmps:443,rtsp:1935,rtsps:443,http:80,https:443},composeUri:function(a,b,c,d,e){return a+"://"+b+":"+c+"/"+d+e},get:function(a){return BetaJS.Class.is_class_instance(a)?a:new this(BetaJS.Types.is_string(a)?{uri:a}:a)}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.VideoMeta",{constructor:function(a){this._inherited(BetaJS.Views.VideoPlayerView.VideoMeta,"constructor"),a=BetaJS.Objs.extend({fit:"minimize",responsive:!1},a||{}),this.__update(a),this.width=a.width,this.height=a.height,this.video_width=a.video_width,this.video_height=a.video_height,this.fit_width=a.fit_width,this.fit_height=a.fit_height,this.fit=a.fit,this.image=a.image,this.responsive=a.responsive},__update:function(a){if(a.width&&a.height&&a.video_width&&a.video_height||(a.width&&a.height?a.video_width?a.video_height=Math.floor(a.height*a.video_width/a.width):a.video_height?a.video_width=Math.floor(a.width*a.video_height/a.width):(a.video_width=a.width,a.video_height=a.height):a.width?a.height=Math.floor(a.video_height*a.width/a.video_width):a.height?a.width=Math.floor(a.video_width*a.height/a.video_width):(a.width=a.video_width,a.height=a.video_height)),a.fit_width=a.video_width,a.fit_height=a.video_height,!(a.video_width==a.width&&a.video_height==a.height||"minimize"!=a.fit&&"maximize"!=a.fit)){var b=a.video_width/a.video_height,c=a.width/a.height;(c-b)*("maximize"==a.fit?1:-1)>=0?(a.fit_width=a.width,a.fit_height=Math.floor(a.width/b)):(a.fit_width=Math.floor(a.height*b),a.fit_height=a.height)}},asObject:function(){return{width:this.width,height:this.height,video_width:this.video_width,video_height:this.video_height,fit_width:this.fit_width,fit_height:this.fit_height,fit:this.fit,image:this.image,responsive:this.responsive}},updateDimensionByParent:function(a){if(this.responsive){var b=parseInt(a.css("width"),10);if(b){var c=parseInt(a.css("height"),10);c||(c=Math.floor(b*this.height/this.width)),this.width=b,this.height=c,this.__update(this)}}}},{get:function(a){return BetaJS.Class.is_class_instance(a)?a:new this(a)}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.PlayerRule",{constructor:function(a){this._inherited(BetaJS.Views.VideoPlayerView.PlayerRule,"constructor"),this.__player=a.player,this.__applies=a.applies,this.__options=a.options||{}},applies:function(a){return this.__applies?this.__applies.apply(this,[a]):!1},player:function(){return this.__player},new_player:function(a,b,c){return new this.__player(a,b,BetaJS.Objs.extend(c,this.__options))}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.Players.Player",[BetaJS.Events.EventsMixin,{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoPlayerView.Players.Player,"constructor"),this._source=a,this._id=b,this._options=c},destroy:function(){this.detach(),this._inherited(BetaJS.Views.VideoPlayerView.Players.Player,"destroy")},attach:function(){},detach:function(){}}],{playername:function(){return BetaJS.Strings.last_after(this.classname,".")},setup:function(a){this._options=a}}),BetaJS.Views.VideoPlayerView.Players.Player.extend("BetaJS.Views.VideoPlayerView.Players.ErrorPlayer",{attach:function(){var a=BetaJS.$("#"+this._id);a.html("<div class='error-player-inner'>"+(this._options.error?this._options.error:"Unknown Player Error")+"</div>");var b=a.parent(),c=a.children(),d=parseInt(b.css("width"),10),e=parseInt(b.css("height"),10);a.css("font-size",Math.floor((d+e)/50)+"px"),a.addClass("error-player-outer"),c.css("padding-left",Math.floor(d/20)+"px"),c.css("padding-right",Math.floor(d/20)+"px"),c.css("padding-top",Math.floor(e/20)+"px"),c.css("padding-bottom",Math.floor(e/20)+"px")}}),BetaJS.Views.VideoPlayerView.Players.Player.extend("BetaJS.Views.VideoPlayerView.Players.JWPlayer",{_params:function(){},attach:function(){this.cls.loadPlayer(function(){var a=this._params(),b=a.autostart;a.autostart=BetaJS.Browser.Info.isMobile()&&a.autostart,this.trigger("params",a),jwplayer(this._id).setup(a);var c=this;jwplayer(this._id).onPlay(function(){c.trigger("play")}),jwplayer(this._id).onPause(function(){c.trigger("pause")}),jwplayer(this._id).onComplete(function(){c.trigger("stop")}),jwplayer(this._id).onError(function(a){c.trigger("error",a.message)}),b&&!a.autostart&&jwplayer(this._id).play()},this)},detach:function(){try{BetaJS.Browser.Info.isInternetExplorer()||jwplayer(this._id).remove()}catch(a){}}},{loadPlayer:function(a,b){window.jwplayer?a.apply(b):BetaJS.Browser.Loader.loadScript(this._options.src,function(){this._options.key&&(jwplayer.key=this._options.key),a.apply(b)},this)}}),BetaJS.Views.VideoPlayerView.Players.JWPlayer.extend("BetaJS.Views.VideoPlayerView.Players.JWPlayer6",{_params:function(){var a={file:this._source.uri};"mp4"==this._source.video&&this._source.extension!=this._source.video&&(a.type="mp4");var b={sources:[a],width:this._options.width,height:this._options.height,image:this._options.image,autostart:this._options.auto_play,menubar:!1,stretching:"maximize"==this._options.fit?"uniform":""};return BetaJS.Browser.Info.flash().installed()&&(b.primary="flash"),this.cls._options.swfsrc&&(b.flashplayer=this.cls._options.swfsrc),b}}),BetaJS.Views.VideoPlayerView.Players.JWPlayer.extend("BetaJS.Views.VideoPlayerView.Players.JWPlayer5",{_params:function(){var a={mode:"html5",file:this._source.uri,image:this._options.image,width:this._options.width,height:this._options.height,menubar:!1,autostart:this._options.auto_play};return this.cls._options.swfsrc&&(a.flashplayer=this.cls._options.swfsrc),a}}),BetaJS.Views.VideoPlayerView.Players.JWPlayer5.Rules={oldiOSRules:[new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()&&BetaJS.Browser.Info.iOSversion().major<5},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer5}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()&&BetaJS.Browser.Info.iOSversion().major<5},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer5})]},BetaJS.Views.VideoPlayerView.Players.JWPlayer6.Rules={defaultRules:[new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()&&!BetaJS.Browser.Info.isInternetExplorer()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&BetaJS.Browser.Info.isAndroid()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&BetaJS.Browser.Info.isAndroid()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&(BetaJS.Browser.Info.flash().installed()||"flv"!=a.video)&&BetaJS.Browser.Info.isMobile()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&BetaJS.Browser.Info.isMobile()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&BetaJS.Browser.Info.isInternetExplorer()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"flv"==a.video&&BetaJS.Browser.Info.flash().installed()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&(BetaJS.Browser.Info.flash().installed()||"flv"!=a.video)},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"rtmp"==a.streamer&&BetaJS.Browser.Info.flash().installed()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"rtsp"==a.streamer},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6})]},BetaJS.Views.VideoPlayerView.Players.JWPlayer56={},BetaJS.Views.VideoPlayerView.Players.JWPlayer56.IncompatabilityRules=[new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(){var a=BetaJS.Browser.Info.flash();return a.installed()&&!a.versionAtLeast(10)},player:BetaJS.Views.VideoPlayerView.Players.ErrorPlayer,options:{error:'To play this video, you need to update your version of Flash. <a href="http://get.adobe.com/flashplayer">Click here to update</a>.'}}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(){var a=BetaJS.Browser.Info;if(a.isMobile())return!1;var b=a.flash();return b.installed()||!b.supported()?!1:a.isWindows()?!a.isInternetExplorer()||a.internetExplorerVersion()<=9:a.isFirefox()||a.isOpera()?!0:!1},player:BetaJS.Views.VideoPlayerView.Players.ErrorPlayer,options:{error:'To play this video, you need to install Flash. <a href="http://get.adobe.com/flashplayer">Click here to install</a>.'}})],BetaJS.Views.VideoPlayerView.Players.JWPlayer56.Rules=BetaJS.Views.VideoPlayerView.Players.JWPlayer56.IncompatabilityRules.concat(BetaJS.Views.VideoPlayerView.Players.JWPlayer5.Rules.oldiOSRules.concat(BetaJS.Views.VideoPlayerView.Players.JWPlayer6.Rules.defaultRules)),function(){var a={__recorders:{},get:function(b){return b in this.__recorders||(this.__recorders[b]=new a.Recorder(b)),this.__recorders[b]},remove:function(a){delete this.__recorders[a]},__events:function(a){return this.get(a).__events},events:["debug","init","error","microphone_state","camera_state","security_flash_access","player_state","recorder_state"],apicalls:["config_get","config_set","microphone_info","microphone_state","microphone_get","microphone_set","microphone_bind","camera_info","camera_state","camera_get","camera_set","camera_bind","device_info","device_state","security_info","security_flash_acquire","player_state","player_activate","player_deactivate","player_play","player_pause","player_resume","player_stop","recorder_state","recorder_activate","recorder_deactivate","recorder_start","recorder_stop","recorder_show_snapshots","recorder_hide_snapshots","recorder_select_snapshot","recorder_light_level"]};a.Recorder=function(a){this.__selector=a,this.__bound=!1,this.__events={},this.__ready_callback=[],this.__bind()},a.Recorder.prototype.jquery=function(){return window.BetaJS?window.BetaJS.$:$||jQuery},a.Recorder.prototype.__bind=function(){if(!this.__bound){var b=this.jquery();if(this.__$selector=b(this.__selector),this.__embed=BetaJS.Browser.FlashHelper.getFlashObject(this.__$selector),this.__$embed=b(this.__embed),this.__embed)for(this.__bound=!0,this.__ready=!1,i=0;i<a.events.length;++i)this.__add_event(a.events[i])
}},a.Recorder.prototype.api=function(){return this.__bind(),this.__embed&&this.__ready?this.__embed:null},a.Recorder.prototype.__add_event=function(a){var b=this;this.__events[a]=function(){if("init"==a){b.__ready=!0;for(var c=0;c<b.__ready_callback.length;++c){var d=b.__ready_callback[c];d.callback.apply(d.context||b)}}b.__$selector.trigger("recorder_"+a,arguments)}},a.Recorder.prototype.ready=function(a,b){this.__ready?a.apply(b||this):this.__ready_callback.push({callback:a,context:b})},a.Recorder.prototype.on=function(a,b,c){this.__$selector.on("recorder_"+a,b,c)},a.Recorder.prototype.off=function(a,b,c){this.__$selector.off("recorder_"+a,b,c)},BetaJS?(BetaJS.Apis=BetaJS.Apis||{},BetaJS.Apis.VideoRecorder=a):window.BetaJSVideoRecorder=a}.call(),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["tutorial-template"]='  <div class="main-tutorial">   <p class="heading">How to Record a Video</p>   <ul style="font-size:{%= fontsize %}%">    <li>     Enable your camera from the <a href="javascript: {}" data-selector="tutorial-flash">Adobe Flash Player Settings</a>. Check <strong>Allow</strong> and click <strong>Close</strong>.    </li>    <li>     Next, check the sound. Say something until the <strong>Mic</strong> light turns green.    </li>    <li>     Click on <strong>Record</strong> to start recording. <strong>Stop</strong> when you\'re done.    </li>    <li>     <strong>Select a thumbnail</strong> to use as the display image for your video. Not happy? <strong>Re-record</strong> to start over.    </li>   </ul>   <p>    <a href="javascript: {}" data-selector="tutorial-close">Ok, got it.</a>   </p>  </div>  <div class="flash-tutorial" style="display: none">   <div class="flash-tutorial-image"></div>   <p class="flash-back-link">    <a href="javascript: {}" data-selector="tutorial-main">Ok, will do.</a>   </p>  </div> ',BetaJS.Templates.Cached["initial-template"]='  <div class="inner-container">   <p class="center"><a href="javascript: {}" data-selector="record-video"><i class="bjs-icon-videocam hero-img"></i></a></p>   <a href="javascript: {}" class="btn-primary" data-selector="record-video">{%= BetaJS.Locales.get(\'video_recorder.record_video\') %}</a>   {% if (info_message) { %}   <p class=\'recorder-info-message\'>{%= info_message %}</p>   {% } %}   <p><a href="javascript: {}" data-selector="upload-video" style="display: {%= external_upload ? "inline" : "none"%}"><i class="bjs-icon-upload"></i> {%= BetaJS.Locales.get(\'video_recorder.external_upload\') %} &nbsp; </a><a href="javascript: {}" data-selector="start-tutorial" style="display:none"> <i class="fa fa-star"></i> {%= BetaJS.Locales.get(\'video_recorder.tutorial\') %} </a></p>   <div class="recorder-front-logo"></div>  </div> ',BetaJS.Templates.Cached["video-recorder-error-template"]='  <p class="error-label">{%= error %}</p>  <a href="javascript: {}" class="call-to-action" style="display: {%= call_to_action ? \'inline\' : \'none\' %}">{%= call_to_action %}</a> ',BetaJS.Templates.Cached["video-recorder-progress-template"]='  <p class="progress-label" {%= bind.inner(\'progress_label\') %}></p>  <i class="bjs-icon-spinner animate-spin progress-spinner"></i> ',BetaJS.Templates.Cached["video-recorder-device-popup-template"]='  {% for (var i = 0; i < items.length; ++i) { %}   <div class="radio">     <label>       <input type="radio" name="options-{%= supp.view_id %}" value="{%= i %}" {%= i == current ? \'checked\' : \'\' %}>       {%= items[i] %}     </label>   </div>  {% } %} ',BetaJS.Templates.Cached["video-uploader-upload-button-view-template"]='   <{%= button_container_element %} data-selector="button-inner" class="{%= supp.css("default") %}" style="color:white"    {%= bind.css_if("disabled", "disabled") %}>    <input type="file" name="file" class="video-uploader-upload-input" style="height:100%" {%= accept_string %} />    {%= label %}   </{%= button_container_element %}>  ',BetaJS.Templates.Cached["video-uploader-progress-template"]='   <p class="progress-label" {%= bind.inner(\'progress_label\') %}></p>   <i class="bjs-icon-spinner animate-spin progress-spinner"></i>  ',BetaJS.Templates.Cached["video-uploader-error-template"]='   <p class="error-label">{%= error %}</p>   <a href="javascript: {}" class="call-to-action" style="display: {%= call_to_action ? \'inline\' : \'none\' %}">{%= call_to_action %}</a>  ',BetaJS.Templates.Cached["video-uploader-upload-template"]='   <div class="inner-container">    <p class="center"><i class="fa {%= BetaJS.Browser.Info.isMobile() ? \'bjs-icon-videocam\' : \'bjs-icon-upload\' %} hero-img"></i></p>    <div data-selector="upload-video" style="position:relative"></div>    <p><a href="javascript: {}" data-selector="record-video" style="display: {%= external_record ? "inline" : "none"%}"><i class="fa bjs-icon-videocam"></i> {%= external_record_label %} &nbsp; </a></p>    <div class="recorder-front-logo"></div>   </div>   <p class="progress-label" {%= bind.inner(\'progress_label\') %} style="display:none"></p>   <i class="bjs-icon-spinner animate-spin progress-spinner" style="display:none"></i>  ',BetaJS.Views.View.extend("BetaJS.Views.SimpleVideoRecorder",{_notifications:{activate:"__attach",deactivate:"__detach"},constructor:function(a){this._inherited(BetaJS.Views.SimpleVideoRecorder,"constructor",a),this._setOption(a,"object",null),this._setOptionProperty(a,"recorder_width",640),this._setOptionProperty(a,"recorder_height",480),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"camera_width",this.get("recorder_width")),this._setOptionProperty(a,"camera_height",this.get("recorder_height")),this._setOptionProperty(a,"camera_fps",30),this._setOptionProperty(a,"recorder_bg_color","#333333"),this._setOptionProperty(a,"initial_image",""),this._setOptionProperty(a,"recorder_swf","betajs-video-recorder.swf"),this._setOptionProperty(a,"disable_swf_cache",!1),this._setOptionProperty(a,"flip_video",!1),this._setOptionProperty(a,"snapshots",0),this._setOptionProperty(a,"snapshots_post",""),this._setOptionProperty(a,"snapshots_quality",90),this._setOptionProperty(a,"snapshots_type","jpg"),this.set("snapshot_config",BetaJS.Objs.extend({margin_percentage:.2,frame_percentage:.9},a.snapshot_config||{})),this.set("play_stream",BetaJS.Objs.extend({file_type:"mp4",server:"",file:"",vcodec:"h264",cookie:""},a.play_stream||{})),this.set("record_stream",BetaJS.Objs.extend({file_type:"mp4",server:"",file:"",vcodec:"h264",acodec:"nellymoser",cookie:""},a.record_stream||{}))},__attach:function(){var a=this;this.__recorder=BetaJS.Apis.VideoRecorder.get(this.__object),this.__recorder.ready(function(){BetaJS.Objs.iter(BetaJS.Apis.VideoRecorder.events,function(b){this.__recorder.on(b,function(){var c=Array.prototype.slice.call(arguments,1);a.trigger.apply(a,[b].concat(c))})},this)},this)},__detach:function(){BetaJS.Apis.VideoRecorder.remove(this.__object),this.__object=null},recorder:function(){return this.__recorder},api:function(){return this.recorder().api()},_render:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.get("recorder_height")/this.get("recorder_width"))),this.set("recorder_width",a),this.set("recorder_height",b)}}if(this.__object)this.$el.html(""),BetaJS.$(this.__object).detach().appendTo(this.$el),this.set("recorder_width",this.$("object").outerWidth()),this.set("recorder_height",this.$("object").outerheight());else{var c="video-recorder-view-"+this.cid();this.__object="#"+c,BetaJS.Browser.FlashHelper.embedFlashObject(this.$el,{objectId:c,width:this.get("recorder_width"),height:this.get("recorder_height"),flashFile:this.get("recorder_swf"),forceReload:this.get("disable_swf_cache"),bgcolor:this.get("recorder_bg_color"),parentBgcolor:null===this.get("recorder_bg_color"),FlashVars:{camera_width:this.get("camera_width"),camera_height:this.get("camera_height"),camera_fps:this.get("camera_fps"),initial_image:this.get("initial_image"),flip_video:this.get("flip_video"),snapshots:this.get("snapshots"),snapshots_post:this.get("snapshots_post"),snapshots_type:this.get("snapshots_type"),snapshots_quality:this.get("snapshots_quality"),play_stream:this.get("play_stream"),record_stream:this.get("record_stream"),js_namespace:"BetaJS.Apis.VideoRecorder.__events('#"+c+"')."}})}}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRecorder",{_notifications:{activate:"__attach",deactivate:"__detach"},constructor:function(a){a=a||{},a.el_classes="video-recorder-outer",a.positioning="none",this._inherited(BetaJS.Views.VideoRecorder,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a),this._setOptionProperty(a,"recording_countdown",0),this._setOptionProperty(a,"type","recorder"),this._setOptionProperty(a,"player_remaining_time",!1),this._setOptionProperty(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_on_snapshots",!0),this._setOptionProperty(a,"rerecord_limit",!1),this.set("can_record",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>=0)},["allow_rerecord","rerecord_limit"])),this.set("can_rerecord",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>0)},["allow_rerecord","rerecord_limit"])),this._setOptionProperty(a,"time_limit",null),this._setOptionProperty(a,"device_test",!0),this._setOptionProperty(a,"first_screen",!0),this._setOptionProperty(a,"face_outline",!1),this._setOptionProperty(a,"disable_timer",!1),this._setOptionProperty(a,"disable_snapshots",!1),this._setOptionProperty(a,"immediate_playback",!1),this._setOptionProperty(a,"recorder_bg_color",null),this._setOptionProperty(a,"snapshots",0),this._setOptionProperty(a,"snapshots_post",""),this.get("disable_snapshots")&&this.set("snapshots_post",""),this._setOptionProperty(a,"snapshots_type","jpg"),this._setOptionProperty(a,"snapshots_quality",90),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"external_upload",!1),this._setOptionProperty(a,"play_stream",{}),this._setOptionProperty(a,"record_stream",{}),this._setOptionProperty(a,"margin_percentage",.3),this._setOptionProperty(a,"frame_percentage",.9),this.__simple_video_recorder=this.addChild(new BetaJS.Views.SimpleVideoRecorder({responsive:this.get("responsive"),recorder_width:a.recorder_width,recorder_height:a.recorder_height,camera_width:a.camera_width,camera_height:a.camera_height,camera_fps:a.camera_fps,recorder_swf:a.recorder_swf,disable_swf_cache:a.disable_swf_cache,recorder_bg_color:this.get("recorder_bg_color"),initial_image:a.initial_image,snapshots:a.snapshots,snapshots_post:a.snapshots_post,snapshots_type:a.snapshots_type,snapshots_quality:a.snapshots_quality,snapshot_config:{margin_percentage:this.get("margin_percentage"),frame_percentage:this.get("frame_percentage")},flip_video:a.flip_video,play_stream:a.play_stream||{},record_stream:a.record_stream||{},el_classes:"video-recorder-flash"})),this.__device_info=null,this.__device_state=null,this.events().on("init",function(a){this.__device_info=a.info,this.__device_state=a.state,this.__security_info=a.security},this),this.on("client_error",function(a){this.trigger("error","client",a)},this),this.on("server_error",function(a){this.trigger("error","server",a)},this),this.__waiting_for_flash_view=this.addChild(new BetaJS.Views.VideoRecorder.Views.WaitingForFlashView({parent:this,visible:!1,label:BetaJS.Locales.get("video_recorder.waiting_for_flash")})),this.__tutorial_view=this.addChild(new BetaJS.Views.VideoRecorder.Views.TutorialView({visible:!1,fontsize:Math.floor(100*a.recorder_width/640)})),this.__face_outline_view=this.addChild(new BetaJS.Views.View({parent:this,visible:!1,el_classes:"video-recorder-face-position"})),this.__state_host=this._auto_destroy(new BetaJS.States.Host),this.__state_host.view=this,this.__state_host.on("start",function(a){this.trigger("state",a),this.trigger("state:"+a)},this)},state:function(){return this.__state_host.state()},user_error:function(a){this.state().next("UserError",{error_msg:a})},events:function(){return this.__simple_video_recorder},recorderWidth:function(){return this.__simple_video_recorder.get("recorder_width")},recorderHeight:function(){return this.__simple_video_recorder.get("recorder_height")},_render:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.get("recorder_height")/this.get("recorder_width"))),this.set("recorder_width",a),this.set("recorder_height",b)}}this._inherited(BetaJS.Views.VideoRecorder,"_render")},__attach:function(){this.__time_started=BetaJS.Time.now(),this.$el.css("width",this.recorderWidth()+"px"),this.$el.css("height",this.recorderHeight()+"px"),this.__state_host.initialize("BetaJS.Views.VideoRecorder.States.Init"),this.__timer=new BetaJS.Timers.Timer({delay:25,fire:this.__timer,context:this})},__detach:function(){this.__timer.destroy(),this.__state_host.finalize()},__timer:function(){this.api()&&this.trigger("timer")},recorder:function(){return this.__simple_video_recorder.recorder()},api:function(){var a=this.recorder().api();if(a){var b=Math.floor(1e5*Math.random());try{a.echo(b)!=b&&(a=null)}catch(c){a=null}}return this.__api_is_active&&!a&&(this.__api_is_active=!1,this.state()&&!this.__dont_cancel&&this.state().next("WaitingForFlash")),this.__api_is_active=!!a,this.__api_was_active=this.__api_was_active||this.__api_is_active,a},device_info:function(a){return a&&(this.__device_info=this.api().device_info()),this.__device_info},device_state:function(a){return a&&(this.__device_state=this.api().device_state()),this.__device_state},security_info:function(a){return a&&(this.__security_info=this.api().security_info()),this.__security_info},stop:function(){this.api().player_stop()},play:function(){this.api().player_play()},stopRecord:function(){this.state().stop_recording&&this.state().stop_recording()}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.WaitingForFlashView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());a.el_classes="video-recorder-waiting-for-flash-view",a.el_styles={"font-size":Math.round(b/15)+"px","line-height":Math.round(b/14)+"px"},this._inherited(BetaJS.Views.VideoRecorder.Views.WaitingForFlashView,"constructor",a)}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.SecurityView",{constructor:function(a){var b=243,c=136,d=80,e=94,f=116;a.el_classes=["video-recorder-security-"+a.side+"-view"],a.html="left"==a.side?"&#9312;&#8594;":"&#8592;&#9313;";var g=a.parent.recorderWidth(),h=(a.parent.recorderHeight(),Math.floor((g-b)/2/2/2)),i="left"==a.side?(d+e)/2:f;a.el_styles={"font-size":h+"px","line-height":h+"px","margin-top":Math.floor(i-c/2-h/2)+"px","margin-left":"4px","margin-right":"4px"},this._inherited(BetaJS.Views.VideoRecorder.Views.SecurityView,"constructor",a)}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.ChromeArrowView",{constructor:function(a){a.el_classes=[BetaJS.Browser.Info.isWindows()?"video-recorder-chrome-arrow-view-windows":"video-recorder-chrome-arrow-view-default"],a.el_styles={top:"0px"},a.html="&#8593;",this._inherited(BetaJS.Views.VideoRecorder.Views.ChromeArrowView,"constructor",a)}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.CountdownView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());this._inherited(BetaJS.Views.VideoRecorder.Views.CountdownView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-countdown-view video-recorder-font",button_container_element:"div",el_styles:{width:Math.round(b/4)+"px",height:Math.round(b/4)+"px","line-height":Math.round(b/4)+"px","font-size":Math.round(b/8)+"px"},modules:[BetaJS.Views.Modules.Centering.both()]},a||{}))}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.TimerView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());this._inherited(BetaJS.Views.VideoRecorder.Views.TimerView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-timer-view video-recorder-font",button_container_element:"div",el_styles:{"line-height":Math.round(b/16)+"px","font-size":Math.round(b/16)+"px"}},a||{})),this._setOptionProperty(a,"format","mmm:ss"),this._setOptionProperty(a,"time",0),this._setOptionProperty(a,"max_time",null),this.set("label",this.computed(function(){var a=this.get("time");return this.get("max_time")&&(a=this.get("max_time")-a),BetaJS.Time.formatTime(a,this.get("format"))},["format","time","max_time"]))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.BlinkingRecordView",{constructor:function(a){Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());this._inherited(BetaJS.Views.VideoRecorder.Views.BlinkingRecordView,"constructor",BetaJS.Objs.extend({html:"<div></div>",children_classes:"video-recorder-blinking-record",children_styles:{width:"10px",height:"10px"}},a||{})),this.__timer=new BetaJS.Timers.Timer({delay:500,context:this,fire:this.__fire})},destroy:function(){this.__timer.destroy(),this._inherited(BetaJS.Views.VideoRecorder.Views.BlinkingRecordView,"destroy")},__fire:function(){this.isActive()&&this.$el.css("visibility","hidden"==this.$el.css("visibility")?"visible":"hidden")}}),BetaJS.Views.ButtonView.extend("BetaJS.Views.VideoRecorder.Views.BarButtonView",{constructor:function(a){var b=a.parent.recorderWidth(),c=a.parent.recorderHeight(),d=Math.round(Math.min(b,c)/15);this._inherited(BetaJS.Views.VideoRecorder.Views.BarButtonView,"constructor",BetaJS.Objs.extend({css:{"default":"video-recorder-bar-button-view",disabled:"video-recorder-bar-button-view-disabled"},button_container_element:"div",children_styles:{"line-height":d+"px","min-width":d+"px","font-size":Math.round(d/2)+"px"}},a||{}))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRecorder.Views.ButtonBarView",{constructor:function(a){a.parent.recorderWidth(),a.parent.recorderHeight();this._inherited(BetaJS.Views.VideoRecorder.Views.ButtonBarView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-button-bar-view",positioning:"float",modules:[BetaJS.Views.Modules.Centering.horizontal()]},a||{}))}}),BetaJS.Views.ProgressView.extend("BetaJS.Views.VideoRecorder.Views.ProgressBarView",{constructor:function(a){var b=a.parent.recorderHeight(),c=Math.round(b/12);this._inherited(BetaJS.Views.VideoRecorder.Views.ProgressBarView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-progress-bar",children_styles:{"font-size":c+"px","line-height":c+"px"},css:{outer:"video-recorder-progress-bar-outer",inner:"video-recorder-progress-bar-inner"}},a||{}))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRecorder.Views.SnapshotFramesView",{constructor:function(a){this._inherited(BetaJS.Views.VideoRecorder.Views.SnapshotFramesView,"constructor");for(var b=a.parent.get("margin_percentage"),c=1-b,d=a.parent.get("frame_percentage"),e=1-d,f=this,g=a.parent.recorderWidth(),h=a.parent.recorderHeight(),i=a.number,j=Math.ceil(Math.sqrt(i)),k=j,l=b/2*g,m=b/2*h,n=c*d*g/j,o=c*d*h/k,p=c*e*g/(j+1),q=c*e*h/(k+1),r=function(){f.trigger("click",this.get("index"))},s=0;k>s;++s)for(var t=0;j>t;++t){var u=t+s*j;i>u&&this.addChild(new BetaJS.Views.ButtonView({properties:{index:u},el_styles:{left:Math.floor(l+p*(t+1)+n*t-4)+"px",top:Math.floor(m+q*(s+1)+o*s-4)+"px",width:Math.floor(n)+"px",height:Math.floor(o)+"px"},el_classes:"video-recorder-snapshot-frame-view"+(BetaJS.Browser.Info.isInternetExplorer()?"-ie":""),button_container_element:"div",children_styles:{height:"100%"}})).on("click",r)}}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.TutorialView",{_templates:{"default":BetaJS.Templates.Cached["tutorial-template"]},_events:{"click [data-selector='tutorial-close']":"__close_tutorial","click [data-selector='tutorial-flash']":"__flash_tutorial","click [data-selector='tutorial-main']":"__main_tutorial"},constructor:function(a){a=a||{},a.el_classes=["video-recorder-tutorial"],this._inherited(BetaJS.Views.VideoRecorder.Views.TutorialView,"constructor",a),this._setOptionProperty(a,"fontsize",!1)},__close_tutorial:function(){this.hide()},__flash_tutorial:function(){this.$(".main-tutorial").hide(),this.$(".flash-tutorial").show()},__main_tutorial:function(){this.$(".flash-tutorial").hide(),this.$(".main-tutorial").show()}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.InitialView",{_templates:{"default":BetaJS.Templates.Cached["initial-template"]},_events:{"click [data-selector='record-video']":"__record_video","click [data-selector='upload-video']":"__upload_video","click [data-selector='start-tutorial']":"__start_tutorial"},constructor:function(a){a=a||{},a.el_classes=["video-recorder-initial"],this._inherited(BetaJS.Views.VideoRecorder.Views.InitialView,"constructor",a),this.set("info_message",a.info_message?a.info_message:""),this.set("external_upload",a.parent.get("external_upload"))},__record_video:function(){this.trigger("record")},__upload_video:function(){this.trigger("upload")},__start_tutorial:function(){this.trigger("tutorial")}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.ProgressView",{_dynamics:{"default":BetaJS.Templates.Cached["video-recorder-progress-template"]},constructor:function(a){a=a||{},a.el_classes=["video-recorder-progress"],this._inherited(BetaJS.Views.VideoRecorder.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"progress",0),this._setOptionProperty(a,"label","Label"),this.set("progress_label",this.computed(function(){return this.get("label")+(Math.floor(100*this.get("progress"))>0?": "+Math.floor(100*this.get("progress"))+"%":"...")},["progress","label"]))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.ErrorView",{_templates:{"default":BetaJS.Templates.Cached["video-recorder-error-template"]},_events:{"click .call-to-action":"__call_to_action"},constructor:function(a){a=a||{},a.el_classes=["video-recorder-error"],this._inherited(BetaJS.Views.VideoRecorder.Views.ErrorView,"constructor",a),this._setOptionProperty(a,"error",""),this._setOptionProperty(a,"call_to_action","")},__call_to_action:function(){this.trigger("call_to_action")}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.SimpleMessageView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());a.el_classes="video-recorder-simple-message-view",a.el_styles=BetaJS.Objs.extend({"font-size":Math.round(b/15)+"px","line-height":Math.round(b/14)+"px"},a.el_styles),this._inherited(BetaJS.Views.VideoRecorder.Views.MessageView,"constructor",a)}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.DevicePopupView",{_templates:{"default":BetaJS.Templates.Cached["video-recorder-device-popup-template"]},_events:{"change input":"__submit"},__submit:function(){this.trigger("submit",this.$el.find(":checked").val())}}),BetaJS.States.State.extend("BetaJS.Views.VideoRecorder.States.State",{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoRecorder.States.State,"constructor",a,b,c),this.__view=a.view,this.__views=[]},_:function(a){return BetaJS.Locales.get("video_recorder."+a)},view:function(){return this.__view},events:function(){return this.__view.events()},_start_time:function(){return this.__start_time},_elapsed_time:function(){return BetaJS.Time.ago(this.__start_time)},api:function(){return this.__view.api()},device_info:function(a){return this.__view.device_info(a)},device_state:function(a){return this.__view.device_state(a)},security_info:function(a){return this.__view.security_info(a)},_timer_state:function(){},_start_state:function(){},_end_state:function(){},_timer:function(){this._timer_state()},_start:function(){this.__start_time=BetaJS.Time.now(),this.__view.on("timer",function(){if(this._started&&!this._stopped)try{this._timer()}catch(a){}},this),this._start_state()},_end:function(){this._end_state(),BetaJS.Objs.iter(this.__views,function(a){a.destroy()},this),this.__view.events().off(null,null,this),this.__view.off(null,null,this)},addView:function(a,b){b=b||{},b.parent=this.__view;var c=this.__view.addChild(new a(b));return this.__views.push(c),c}}),BetaJS.Locales.register({flash_not_supported:"Sorry, you can't use this device to record your video (Flash is required).",flash_not_installed:'To record yourself on video, you need to install Flash. <a href="http://get.adobe.com/flashplayer">Click here to install</a>.',flash_old_version:'To record yourself on video, you need to update your version of Flash. <a href="http://get.adobe.com/flashplayer">Click here to update</a>.',no_camera:"Sorry, we could not detect a camera on your device. Please use a device with a working camera.",no_microphone:"Sorry, we could not detect a microphone on your device. Please use a device with a working microphone.",no_visual:"Sorry, we cannot see you.",no_sound:"Sorry, we cannot hear you.",browser_permission:"We need access to your camera and microphone.",microphone_test:"Testing Microphone...",camera_test:"Testing Camera...",say_something:"Say something so we can test your microphone.",also_try_different_camera:"You can also try to select a different camera.",try_different_camera:"Try to select a different camera.",try_different_microphone:"Try to select a different microphone.",record_label:"Record",recording_get_ready:"Get Ready...",uploading_label:"Uploading",microphone_settings:"Microphone settings",camera_settings:"Camera settings",camera_light_level:"Your lighting is fairly poor",external_upload:"Upload Video",tutorial:"New? Read the tutorial.",unsupported_video_type:"Please upload: %s",recording_start:"Go!",recording_starts_in:"Starts in",record_video:"Record your Video",stop_recording:"Stop",select_snapshot:"Pick a Thumbnail",uploading_video:"Your video is being uploaded",rerecord_label:"Re-record?",rerecord_confirm:"Are you sure you want to re-record your video?",abort_record:"Wait",rerecord_affirmation:"Don't worry, you can always re-record.",rerecord_multiple_affirmation:"Don't worry, you can re-record %d more times.",rerecord_double_affirmation:"Don't worry, you can re-record twice.",rerecord_single_affirmation:"Don't worry, you can re-record one more time.",rerecord_immediately:"Re-record",waiting_for_flash:"Waiting for Flash. Try clicking at the top of this box to activate.",select_file_action:"Upload your Video",select_file_action_mobile:"Record your Video",reselect_file_action:"Re-upload your Video",reselect_file_action_mobile:"Re-record your Video",external_record_label:"Record your Video",try_again:"Try again?",processing_label:"Processing",uploading_file_failed:"Uploading failed, please try again.",could_not_process_file:"We could not process your video, please try again.",device_unsupported:"Your device is currently not supported. We are very sorry."},"video_recorder"),BetaJS.Locales.register({flash_not_supported:"Dieses Ger&auml;t kann leider nicht verwendet werden (Flash wird ben&ouml;tigt).",flash_not_installed:'Um ein Video aufnehmen zu k&ouml;nnen, muss Flash installiert werden. <a href="http://get.adobe.com/flashplayer">Jetzt installieren</a>.',flash_old_version:'Um ein Video aufnehmen zu k&ouml;nnen, muss Flash aktualisiert werden. <a href="http://get.adobe.com/flashplayer">Jetzt aktualisieren</a>.',no_camera:"Wir konnten keine Kamera finden. Bitte verwenden Sie einen Computer mit installierter Kamera.",no_microphone:"Wir konnten kein Mikrofon finden. Bitte verwenden Sie einen Computer mit installierten Mikrofon.",no_visual:"Wir k&ouml;nnen leider kein Bild empfangen.",no_sound:"Wir k&ouml;nnen leider kein Audio h&ouml;ren.",browser_permission:"Wir ben&ouml;tigen Zugriff auf Ihre Kamera und Ihr Mikrofon.",microphone_test:"Teste Mikrofon...",camera_test:"Teste Kamera...",say_something:"Bitte sagen Sie etwas, damit wir Ihr Mikrofon testen k&ouml;nnen.",also_try_different_camera:"Sie k&ouml;nnen auch versuchen, eine andere Kamera auszuw&auml;hlen.",try_different_camera:"Versuchen Sie bitte eine andere Kamera auszuw&auml;hlen.",try_different_microphone:"Versuchen Sie bitte ein anderes Mikrofon auszuw&auml;hlen.",record_label:"Aufnehmen",recording_get_ready:"Und...",microphone_settings:"Mikrofoneinstellungen",camera_settings:"Kamera-Einstellungen",camera_light_level:"Lichtqualtit&auml; eingeschr&auml;nkt",uploading_label:"Hochladen",external_upload:"Video hochladen",tutorial:"Neu hier? Tutorial lesen (auf Englisch).",recording_start:"Los!",recording_starts_in:"Los geht's in",record_video:"Video aufnehmen",stop_recording:"Stopp",select_snapshot:"Bild ausw&auml;hlen",uploading_video:"Ihr video wird hochgeladen",rerecord_label:"Nochmal aufnehmen?",rerecord_confirm:"Sind Sie sicher, dass Sie Ihr Video noch einmal aufnehmen wollen?",abort_record:"Warte!",rerecord_affirmation:"Keine Sorge, Sie k&ouml;nnen immer wieder aufnehmen.",rerecord_multiple_affirmation:"Keine Sorge, Sie k&ouml;nnen %d weitere Aufnahmen anlegen.",rerecord_double_affirmation:"Keine Sorge, Sie k&ouml;nnen noch zwei weitere Versuche aufnehmen.",rerecord_single_affirmation:"Keine Sorge, Sie k&ouml;nnen noch einen weiteren Versuch aufnehmen.",rerecord_immediately:"Nochmal aufnehmen?",waiting_for_flash:"Flash reagiert nicht. Sie m&uuml;ssen m&ouml;glicherweise oberhalb dieser Nachricht clicken, um die Energiesparfeatures Ihres Browsers zu deaktivieren.",select_file_action:"Video hochladen",select_file_action_mobile:"Video aufnehmen",reselect_file_action:"Video erneut hochladen",reselect_file_action_mobile:"Video erneut aufnehmen",external_record_label:"Video aufnehmen",try_again:"Nochmal versuchen?",processing_label:"Verarbeiten",uploading_file_failed:"Hochladen fehlgeschlagen, bitte versuchen Sie es erneut.",could_not_process_file:"Wir konnten Ihr Video nicht verarbeiten, bitte versuchen Sie es erneut.",device_unsupported:"Ihr Ger&auml;t wird derzeit nicht unterst&uuml;tzt."},"de.video_recorder"),BetaJS.Locales.register({flash_not_supported:"Lo sentimos, no puede usar este dispositivo para grabar el video (se requiere Flash).",flash_not_installed:'Para grabarse en video, debe instalar Flash. <a href="http://get.adobe.com/flashplayer">Haga clic aqu&iacute; para instalar</a>.',flash_old_version:'Para grabarse en video, debe actualizar la versi&oacute;n de Flash. <a href="http://get.adobe.com/flashplayer">Haga clic aqu&iacute; para actualizar</a>.',no_camera:"Lo sentimos, no se detect&oacute; una c&aacute;mara en el dispositivo. Use un dispositivo con una c&aacute;mara que funcione.",no_microphone:"Lo sentimos, no se detect&oacute; un micr&oacute;fono en el dispositivo. Use un dispositivo con un micr&oacute;fono que funcione.",no_visual:"Lo sentimos, no podemos verlo.",no_sound:"Lo sentimos, no podemos escucharlo.",browser_permission:"Necesitamos acceso a su c&aacute;mara y micr&oacute;fono.",microphone_test:"Probando micr&oacute;fono...",camera_test:"Probando c&aacute;mara...",say_something:"Diga algo para que podamos probar su micr&oacute;fono.",also_try_different_camera:"Tambi&eacute;n puede tratar de seleccionar una c&aacute;mara diferente.",try_different_camera:"Trate de seleccionar una c&aacute;mara diferente.",try_different_microphone:"Trate de seleccionar un micr&oacute;fono diferente.",record_label:"Grabar",recording_get_ready:"Prep&aacute;rese...",uploading_label:"Cargando",microphone_settings:"Configuraci&oacute;n del micr&oacoute;fono",camera_settings:"Ajustes de la c&aacute;mara",camera_light_level:"La falta de iluminaci&oacoute;n",external_upload:"Quiero cargar un video.",tutorial:"New? Read the tutorial (english).",recording_start:"&iexcl;Ya!",recording_starts_in:"Comienza dentro de",record_video:"Grabar",stop_recording:"Parar.",select_snapshot:"Seleccione una instant&aacute;nea",uploading_video:"Su video se est&aacute; cargando",rerecord_label:"&iquest;Volver a grabar?",rerecord_confirm:"&iquest;Est&aacute; seguro de que desea volver a grabar su video?",abort_record:"&iexcl;Espere!",rerecord_affirmation:"No se preocupe, siempre puede volver a grabar.",rerecord_multiple_affirmation:"No se preocupe, puede volver a grabar %d m&aacute;s veces.",rerecord_double_affirmation:"No se preocupe, puede volver a grabar dos veces.",rerecord_single_affirmation:"No se preocupe, puede volver a grabar una vez m&aacute;s.",rerecord_immediately:"D&eacute;jeme volver a grabarlo.",waiting_for_flash:"Esperando que Flash se reactive. Es posible que deba hacer clic sobre este mensaje para desactivar las caracter&iacute;sticas de ahorro de energ&iacute;a del explorador.",select_file_action:"Seleccionar",select_file_action_mobile:"Grabar",reselect_file_action:"Reseleccionar",reselect_file_action_mobile:"Regrabar",external_record_label:"Grabar",try_again:"&iquest;Intentarlo de nuevo?",processing_label:"Procesamiento",uploading_file_failed:"Error al cargar, vuelva a intentarlo.",could_not_process_file:"No pudimos procesar su video, vuelva a intentarlo.",device_unsupported:"Actualmente su dispositivo no es compatible. Lo sentimos mucho."},"es.video_recorder"),BetaJS.Locales.register({flash_not_supported:"Ci dispiace, non &egrave; possibile utilizzare questo dispositivo per registrare il video (&egrave; necessario Flash).",flash_not_installed:'Per registrare un video &egrave; necessario installare Flash. <a href="http://get.adobe.com/flashplayer">Clicca qui per installarlo</a>.',flash_old_version:'Per registrare un video &egrave; necessario aggiornare la versione di Flash. <a href="http://get.adobe.com/flashplayer">Clicca qui per aggiornare</a>.',no_camera:"Ci dispiace, non abbiamo potuto rilevare una fotocamera sul dispositivo. Si prega di utilizzare un dispositivo con una fotocamera funzionante.",no_microphone:"Ci dispiace, non abbiamo potuto rilevare un microfono sul dispositivo. Si prega di utilizzare un dispositivo con un microfono funzionante.",no_visual:"Ci dispiace, non riusciamo a vederti.",no_sound:"Ci dispiace, non riusciamo a sentirti.",browser_permission:"Abbiamo bisogno di accedere alla tua fotocamera e al tuo microfono.",microphone_test:"Testando il microfono...",camera_test:"Testando la fotocamera...",say_something:"Di' qualcosa cosi da poter testare il microfono.",also_try_different_camera:"Puoi anche provare a selezionare un'altra fotocamera.",try_different_camera:"Prova a selezionare un'altra fotocamera.",try_different_microphone:"Prova a selezionare un altro microfono.",record_label:"Registra",recording_get_ready:"Preparati...",uploading_label:"Caricamento",microphone_settings:"Impostazioni del microfono",camera_settings:"Impostazioni della fotocamera",camera_light_level:"La scarsa illuminazione",external_upload:"Carica Video",tutorial:"Nuovo utente? Leggi il tutorial.",recording_start:"Vai!",recording_starts_in:"Inizia in",record_video:"Registra un Video",stop_recording:"Stop",select_snapshot:"Seleziona un'immagine",uploading_video:"Il tuo video &egrave; in fase di caricamento",rerecord_label:"Registrare di nuovo?",rerecord_confirm:"Sei sicuro di voler registrare nuovamente il video?",abort_record:"Attendere",rerecord_affirmation:"Non ti preoccupare, &egrave; possibile registrare nuovamente il video",rerecord_multiple_affirmation:"Non ti preoccupare, &egrave; possibile registrare il video altre %d volte.",rerecord_double_affirmation:"Non ti preoccupare, &egrave; possibile registrare il video altre due volte.",rerecord_single_affirmation:"Non ti preoccupare, &egrave; possibile reigistrare il video ancora una volta.",rerecord_immediately:"Registra di nuovo",waiting_for_flash:"In attesa di Flash. Potrebbe essere necessario cliccare sulla parte superiore del registratore per disattivare le funzioni di risparmio energetico del tuo browser.",select_file_action:"Carica il tuo Video",select_file_action_mobile:"Registra un Video",reselect_file_action:"Carica nuovamente il tuo Video",reselect_file_action_mobile:"Registra nuovamente un Video",external_record_label:"Registra un Video",try_again:"Riprova",processing_label:"Elaborazione in corso",uploading_file_failed:"Caricamento non riuscito, si prega di riprovare.",could_not_process_file:"Non abbiamo potuto elaborare il tuo video, si prega di riprovare.",device_unsupported:"Il tuo dispositivo non e' al momento supportato, ci scusiamo per l'inconveniente."},"it.video_recorder"),BetaJS.Locales.register({flash_not_supported:"Du kan inte anv&auml;nda denna enheten f&ouml;r att spela in din video (Flash kr&auml;vs).",flash_not_installed:'F&ouml;r att spela in dig sj&auml;lv kr&auml;vs det att du installerar Flash. <a href="http://get.adobe.com/flashplayer">Klicka h&auml;r f&ouml;r att installera</a>.',flash_old_version:'F&ouml;r att spela in dig sj&auml;lv kr&auml;vs det att du uppdaterar din version av Flash. <a href="http://get.adobe.com/flashplayer">Klicka h&auml;r f&ouml;r att uppdatera</a>.',no_camera:"Ingen kamera hittades. V&auml;nligen anv&auml;nd en enhet med fungerande kamera f&ouml;r att spela in din video.",no_microphone:"Ingen mikrofon hittades. V&auml;nligen anv&auml;nd en enhet med fungerande mikrofon f&ouml;r att spela in din video.",no_visual:"Ledsen, vi kan inte se dig.",no_sound:"Ledsen, vi kan inte h&ouml;ra dig.",browser_permission:"Vi beh&ouml;ver tillg&aring;ng till din kamera och mikrofon.",microphone_test:"Testar Mikrofon...",camera_test:"Testar Kamera...",say_something:"S&auml;g n&aring;nting s&aring; att vi kan testa mikrofonen.",also_try_different_camera:"Du kan &auml;ven testa att anv&auml;nda en annan kamera.",try_different_camera:"Testa att anv&auml;nda en annna kamera.",try_different_microphone:"Testa att anv&auml;nda en annan mikrofon.",record_label:"Spela in",recording_get_ready:"G&ouml;r dig redo...",uploading_label:"Laddar upp",microphone_settings:"Mikrofoninst&auml;llningar",camera_settings:"Kamerainst&auml;llningar",camera_light_level:"Din ljuss&auml;ttning &auml;r ganska d&aring;lig",external_upload:"Ladda upp video",tutorial:"Ny? L&auml;s guiden.",unsupported_video_type:"V&auml;nligen ladda upp: %s",recording_start:"K&ouml;r!",recording_starts_in:"Startar om",record_video:"Spela in din video",stop_recording:"Stopp",select_snapshot:"V&auml;lj en miniatyrbild",uploading_video:"Din video laddas upp",rerecord_label:"Omtagning?",rerecord_confirm:"Ã„r du s&auml;ker p&aring; att du vill g&ouml;ra omtagning p&aring; din video?",abort_record:"V&auml;nta",rerecord_affirmation:"Oroa dig inte, du kan alltid g&ouml;ra en omtagning",rerecord_multiple_affirmation:"Oroa dig inte, du kan g&ouml;ra omtagning %d g&aring;nger till.",rerecord_double_affirmation:"Oroa dig inte, du kan g&ouml;ra tv&aring; omtagningar till.",rerecord_single_affirmation:"Oroa dig inte, du kan g&ouml;ra en omtagning till.",rerecord_immediately:"Omtagning",waiting_for_flash:"V&auml;ntar p&aring; Flash. Testa att klicka p&aring; toppen av denna box f&ouml;r att aktivera.",select_file_action:"Ladda upp din video.",select_file_action_mobile:"Spela in din video.",reselect_file_action:"Ladda upp din video igen.",reselect_file_action_mobile:"Spela in din video igen",external_record_label:"Spela in din video",try_again:"F&ouml;rs&ouml;k igen?",processing_label:"Bearbetar",uploading_file_failed:"Uppladdning misslyckades, v&auml;nligen f&ouml;rs&ouml;k igen.",could_not_process_file:"Vi kunde inte bearbeta din video, v&auml;nligen f&ouml;rsk igen.",device_unsupported:"Tyv&auml;rr s&aring; st&ouml;ds inte din enhet f&ouml;r tillf&auml;llet. Vi ber om urs&auml;kt f&ouml;r detta."},"se.video_recorder"),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.WaitingForFlash",{_start_state:function(){this.view().__waiting_for_flash_view.show()
},_timer_state:function(){this.api()&&this.next("Init")},_end_state:function(){this.view().__waiting_for_flash_view.hide()}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.Init",{_start_state:function(){if(this.view().__dont_cancel=!1,this.view().__screen_height=window.innerHeight,!this.view().get("first_screen")||"player"==this.view().get("type")){var a=BetaJS.Browser.Info.flash();return a.installed()&&a.versionAtLeast(11)?this.next("FlashOkay"):this.next("FlashFailed"),void 0}var b=this.addView(BetaJS.Views.VideoRecorder.Views.InitialView,{parent:this.view()});b.on("record",function(){var a=BetaJS.Browser.Info.flash();a.installed()&&a.versionAtLeast(11)?this.next("FlashOkay"):this.next("FlashFailed")},this),b.on("upload",function(){this.view().trigger("external_upload")},this),b.on("tutorial",function(){this.view().__tutorial_view.show()},this)}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.ErrorState",{_locals:["error_message","call_to_action"],_start_state:function(){this.addView(BetaJS.Views.VideoRecorder.Views.ErrorView,{error:this._error_message,call_to_action:this._call_to_action})}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.FlashFailed",{_start_state:function(){var a=BetaJS.Browser.Info.flash();a.supported()?a.installed()?(this.view().trigger("client_error",this._("flash_old_version")),this.next("ErrorState",{error_message:this._("flash_old_version")})):(this.view().trigger("client_error",this._("flash_not_installed")),this.next("ErrorState",{error_message:this._("flash_not_installed")})):(this.view().trigger("client_error",this._("flash_not_supported")),this.next("ErrorState",{error_message:this._("flash_not_supported")}))}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.FlashOkay",{_timer_state:function(){this.api()&&this.device_info()&&this.device_state()&&this.next("Attached")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.Attached",{_start_state:function(){this.view().__dont_cancel=!1,"recorder"==this.view().get("type")?this.next("RecorderDeviceCheck"):this.next("PlayerReady")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderDeviceCheck",{_start_state:function(){this.device_info(!0).camera.has&&this.device_info().microphone.has?this.next("RecorderSecurityCheck"):this.next("RecorderDeviceFailed")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderDeviceFailed",{_start_state:function(){this.device_info().camera.has?(this.next("ErrorState",{error_message:this._("no_microphone")}),this.view().trigger("client_error",this._("no_microphone"))):(this.next("ErrorState",{error_message:this._("no_camera")}),this.view().trigger("client_error",this._("no_camera")))}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.UserError",{_locals:["error_msg"],_start_state:function(){this.next("ErrorState",{error_message:this._error_msg})}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderSecurityCheck",{_start_state:function(){return this.view().__screen_height=window.innerHeight,"granted"==this.security_info(!0).flash_access?(this.next("RecorderSecurityOkay"),void 0):(this.addView(BetaJS.Views.VideoRecorder.Views.SecurityView,{side:"left"}),this.addView(BetaJS.Views.VideoRecorder.Views.SecurityView,{side:"right"}),this.events().on("security_flash_access",function(a){"granted"==a&&this.next("RecorderSecurityOkay")},this),this.api().security_flash_acquire(),void 0)}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderSecurityOkay",{_start_state:function(){this.next("RecorderDeviceReady")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderDeviceReady",{_start_state:function(){var a=this;this.__added_arrow=!1,this.api().microphone_bind("test"),this.api().camera_bind("test"),this.view().get("face_outline")&&this.view().__face_outline_view.show(),this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.record_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("record_label"),el_classes:["video-recorder"],css:{"default":"btn-default"},children_styles:{position:"inherit"},el_styles:{"float":"right"},disabled:this.view().get("device_test")})),this.__message_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-message-under",visible:!1}),this.__message=this.addView(BetaJS.Views.LabelView,{el_classes:"video-recorder-message",visible:!1}),this.__set_message=function(a){this.__message.set("label",a),this.__message_under.setVisibility(!!a),this.__message.setVisibility(!!a)},this.cam_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:'<i class="bjs-icon-cog"></i>',el_classes:["video-recorder"],css:{"default":"btn-link",selected:"active"},children_styles:{position:"inherit"},el_styles:{"float":"left"}})),this.mic_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:'Mic <i class="bjs-icon-circle off"></i>',el_classes:["video-recorder"],css:{"default":"btn-link",selected:"active"},children_styles:{position:"inherit"},el_styles:{"float":"left"}}));var b=this.device_info(!0);this.mic_select_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.DevicePopupView({el_classes:"video-recorder input-options mic off",visible:!1,properties:{items:b.microphone.names,current:b.microphone.current}})),this.cam_select_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.DevicePopupView({el_classes:"video-recorder input-options settings",visible:!1,properties:{items:b.camera.names,current:b.camera.current}})),this.mic_button_view.on("click",function(){this.mic_button_view.set("selected",!this.mic_button_view.get("selected"))},this),this.cam_button_view.$el.on("click",function(){a.cam_button_view.set("selected",!a.cam_button_view.get("selected"))}),this.mic_button_view.on("change:selected",function(a){this.mic_select_view.setVisibility(a),a&&this.cam_button_view.set("selected",!1)},this),this.cam_button_view.on("change:selected",function(a){this.cam_select_view.setVisibility(a),a&&this.mic_button_view.set("selected",!1)},this),this.cam_select_view.on("submit",function(a){this.api().camera_set(a),this.api().camera_bind("test"),this.cam_button_view.set("selected",!1)},this),this.mic_select_view.on("submit",function(a){this.api().microphone_set(a),this.api().microphone_bind("test"),this.mic_button_view.set("selected",!1)},this),this.record_button_view.$el.on("mouseenter",function(){if(a._elapsed_time()>=2e3){{var b=a.device_state(!0);a.device_info().camera.count>1}if("active"!=b.camera.status)return a.__set_message(a._("try_different_camera")),void 0;if("active"!=b.microphone.status)return a.__set_message(a._("say_something")),void 0}if(!a.record_button_view.get("disabled")&&a.view().get("allow_rerecord")){var c=a.view().get("rerecord_limit");c===!1?a.__set_message(a._("rerecord_affirmation")):1==c?a.__set_message(a._("rerecord_single_affirmation")):2==c?a.__set_message(a._("rerecord_double_affirmation")):a.__set_message(a._("rerecord_multiple_affirmation").replace("%d",c))}}),this.record_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.record_button_view.on("click",function(){this.record()},this),this.cam_button_view.$el.on("mouseenter",function(){var b=a.device_state(!0),c=a.device_info().camera.count>1,d="active"==b.camera.status;if(d){var e=a.api().recorder_light_level();e>=100&&200>=e||1>=e||e>=254?a.__set_message(a._("camera_settings")):a.__set_message(a._("camera_light_level"))}else a._elapsed_time()<2e3&&a.chrome_view?a.__set_message(a._("browser_permission")):c?a.__set_message(a._("try_different_camera")):a.__set_message(a._("browser_permission"))}),this.cam_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.mic_button_view.$el.on("mouseenter",function(){var b=a.device_state(!0),c="active"==b.microphone.status;c?a.__set_message(a._("microphone_settings")):a._elapsed_time()<2e3?a.__set_message(a._("microphone_test")):a._elapsed_time()<8e3?a.__set_message(a._("say_something")):a.__set_message(a._("no_sound")+(a.device_info().microphone.count>1?" "+a._("try_different_microphone"):""))}),this.mic_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.__light_level=!0},record:function(){this.next("RecorderBeforeRecording")},_timer_state:function(){!this.chrome_view&&BetaJS.Browser.Info.isChrome()&&window.innerHeight!=this.view().__screen_height&&(this.view().get("face_outline")&&this.view().__face_outline_view.hide(),this.chrome_view=this.addView(BetaJS.Views.VideoRecorder.Views.ChromeArrowView));var a=this.device_state(!0),b="active"==a.camera.status,c="active"==a.microphone.status;c&&this.mic_button_view.$el.find("i").removeClass("off"),(b&&c||window.innerHeight==this.view().__screen_height)&&this.chrome_view&&(this.chrome_view.setVisibility(!1),this.view().get("face_outline")&&this.view().__face_outline_view.show()),b&&c&&this.record_button_view.set("disabled",!1);var d=this.api().recorder_light_level(),e=d>=100&&200>=d||1>=d||d>=254;e!=this.__light_level&&(this.__light_level=e,this.__light_level?this.cam_button_view.$el.find("button").html('<i class="bjs-icon-cog"></i>'):this.cam_button_view.$el.find("button").html('Light <i class="bjs-icon-circle off"></i>'))}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderBeforeRecording",{_start_state:function(){return this.api().microphone_bind("test"),this.api().camera_bind("test"),this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("abort_record"),el_classes:["video-recorder"],css:{"default":"btn-default on"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:this._("recording_starts_in")+" "+this.view().get("recording_countdown"),el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.stop_button_view.on("click",function(){this.next("RecorderDeviceReady")},this),this.view().get("recording_countdown")?void 0:(this.next("RecorderRecording"),void 0)},_timer_state:function(){var a=1e3*this.view().get("recording_countdown")-this._elapsed_time();a>0&&this.view().trigger("countdown",a),this.countdown_view.set("label",a>=0?this._("recording_starts_in")+" "+Math.ceil(a/1e3):this._("recording_get_ready")),0>=a&&this.next("RecorderRecording")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderRecording",{_start_state:function(){this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("recording_get_ready"),el_classes:["video-recorder"],css:{"default":"btn-default on"},children_styles:{position:"inherit"},el_styles:{"float":"right",visibility:"hidden"}})),this.__time=null,this.view().__dont_cancel=!0,this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:this._("recording_get_ready"),el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.timer_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.TimerView({parent:this.view(),max_time:this.view().get("time_limit")?1e3*this.view().get("time_limit"):null,time:0,visible:!1,el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"},el_classes:"video-recorder-font"})),this.blinking_record_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.BlinkingRecordView({parent:this.view(),visible:!1,el_styles:{"float":"left",padding:"20px"}})),this.stop_button_view.on("click",function(){this.stop_recording()},this),this.events().on("error",function(a){this.view().trigger("server_error",a),this.timer_view.hide(),this.blinking_record_view.hide(),this.countdown_view.hide(),this.api().recorder_stop(),this.next("ErrorState",{error_message:a})},this),this.events().on("recorder_state",function(a){"none"==a&&this.stop_button_view.set("disabled",!0),"connecting"==a&&this.stop_button_view.set("disabled",!0),"active"==a&&(this.stop_button_view.set("disabled",!0),this.api().recorder_start()),"recording"==a&&(this.stop_button_view.$el.css("visibility",""),this.stop_button_view.set("label",this._("recording_start")),this.stop_button_view.$el.children().css("background-color","green"),this.countdown_view.hide(),this.blinking_record_view.show(),this.view().get("disable_timer")||this.timer_view.show(),this.__time=BetaJS.Time.now())},this),this.api().recorder_activate()},_timer_state:function(){if(this.__time){var a=BetaJS.Time.now()-this.__time;this.timer_view.set("time",a),this.view().trigger("elapsed",a),this.view().get("time_limit")&&a>=1e3*this.view().get("time_limit")&&this.stop_recording(),a>1500&&(this.stop_button_view.$el.children().css("background-color",""),this.stop_button_view.set("disabled",!1),this.stop_button_view.set("label",this._("stop_recording")))}},stop_recording:function(){this.api().recorder_stop();var a=BetaJS.Time.now()-this.__time;if(this.view()._duration=a,this.view().__face_outline_view.hide(),this.view().trigger("recording_finished"),this.view().get("disable_snapshots")){var b=this.api().recorder_state();b.snapshots_count>0&&this.api().recorder_select_snapshot(Math.floor(b.snapshots_count/2)),this.next("RecorderUploading")}else this.next("RecorderSnapshotSelection")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderSnapshotSelection",{_start_state:function(){var a=this.api().recorder_state();return 0===a.snapshots_count?(this.next("RecorderUploading"),void 0):(this.api().recorder_show_snapshots(),this.view().get("can_record")&&this.view().get("rerecord_on_snapshots")&&(this.rerecord_button_view=this.addView(BetaJS.Views.ButtonView,{label:"&#8592; "+this._("rerecord_immediately"),el_classes:["video-recorder"],css:{"default":"btn-outline"},children_styles:{bottom:"-6px",left:"-6px"}}),this.rerecord_button_view.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().set("type","recorder"),this.view().trigger("recording_discarded"),this.api().recorder_hide_snapshots(),this.api().recorder_deactivate(),this.next("RecorderDeviceReady"))},this)),this.__message_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-message-under"}),this.__message=this.addView(BetaJS.Views.LabelView,{el_classes:"video-recorder-message",label:this._("select_snapshot")}),this.addView(BetaJS.Views.VideoRecorder.Views.SnapshotFramesView,{number:a.snapshots_count}).on("click",function(a){this.api().recorder_select_snapshot(a),this.next("RecorderUploading")},this),void 0)},_end_state:function(){this.api().recorder_hide_snapshots()}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderUploading",{_start_state:function(){var a=this.api().recorder_state();return"finished"==a.status&&(a.snapshot_uploaded||this.view().get("disable_snapshots"))?(this.__finished(),void 0):(this.__processing_view=this.addView(BetaJS.Views.VideoRecorder.Views.ProgressView,{label:this._("uploading_label"),progress:0}),this.__start_time=BetaJS.Time.now(),void 0)},_timer_state:function(){var a=this.api().recorder_state();if("finished"==a.status&&(a.snapshot_uploaded||this.view().get("disable_snapshots")))return this.__finished(),void 0;if("error"==a.status)return this.progress_bar_view.hide(),this.next("ErrorState",{error_message:a.error}),void 0;if(a.uploading_total>0&&a.elapsed_uploading_time>0&&a.uploading_transferred>0){var b=BetaJS.Time.now();if(this.__time){if(this.__uploading_transferred_last!=a.uploading_transferred){if(this.__uploading_transferred_last=a.uploading_transferred,this.__uploading_transferred_rate=a.uploading_transferred/a.elapsed_uploading_time,this.__last_delta_time=b-this.__delta_start,this.__last_delta_time>0){var c=a.uploading_transferred-this.__uploading_transferred_current;this.__uploading_transferred_rate=Math.max(this.__uploading_transferred_rate/2,this.__uploading_transferred_rate+c/this.__last_delta_time)}this.__delta_start=b}}else this.__time=b,this.__delta_start=b,this.__uploading_transferred_last=a.uploading_transferred,this.__uploading_transferred_current=a.uploading_transferred,this.__uploading_transferred_rate=a.uploading_transferred/a.elapsed_uploading_time;var d=b-this.__time;this.__uploading_transferred_rate>0&&d<=this.__last_delta_time&&(this.__uploading_transferred_current=Math.min(a.uploading_total,this.__uploading_transferred_current+this.__uploading_transferred_rate*d)),this.__time=b;{a.elapsed_uploading_time*(a.uploading_total-this.__uploading_transferred_current)/this.__uploading_transferred_current}this.__processing_view.set("progress",this.__uploading_transferred_current/a.uploading_total)}else if(!a.snapshot_uploaded){var e=BetaJS.Time.now();if(this.__snapshot_time){var f=e-this.__snapshot_time;if(f>0){var g=1-1/(1+Math.sqrt(Math.sqrt(f/1e3)));this.__processing_view.set("progress",g)}}else this.__snapshot_time=e}},__finished:function(){if(!this.__finished_called){this.__finished_called=!0,this.view().set("type","player"),this.view().get("rerecord_limit")!==!1&&this.view().set("rerecord_limit",this.view().get("rerecord_limit")-1);var a=Math.max(2e3-(BetaJS.Time.now()-this.__start_time),0),b=this;a>0?setTimeout(function(){b.__finished_finished()},a):b.__finished_finished()}},__finished_finished:function(){this.api().recorder_deactivate(),this.view().trigger("recording_submitted",{duration:this.view()._duration}),"next"in this&&this.next("Attached")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.PlayerReady",{_start_state:function(){var a=this.view().get("can_record");if(this.rerecord_button_view=this.addView(BetaJS.Views.ButtonView,{label:this._("rerecord_label"),el_classes:["video-recorder"],css:{"default":"btn-default"},children_styles:{top:"10px",left:"10px"},visible:a}),this.rerecord_button_view.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().set("type","recorder"),this.view().trigger("recording_discarded"),this.next("RecorderSecurityCheck"))},this),this.timer_view=this.addView(BetaJS.Views.VideoRecorder.Views.TimerView,{}),this.button_bar_view=this.addView(BetaJS.Views.VideoRecorder.Views.ButtonBarView,{}),this.play_button_view=this.button_bar_view.addChild(new BetaJS.Views.VideoRecorder.Views.BarButtonView({parent:this.view(),label:"<i class='bjs-icon-play'></i>"})),this.play_button_view.on("click",function(){this.__disconnectedPlayer&&(this.api().player_deactivate(),this.api().player_activate()),"paused"==this.api().player_state().status?this.api().player_resume():this.api().player_play()},this),this.pause_button_view=this.button_bar_view.addChild(new BetaJS.Views.VideoRecorder.Views.BarButtonView({parent:this.view(),label:"<i class='bjs-icon-pause'></i>",disabled:!0})),this.pause_button_view.on("click",function(){this.api().player_pause()},this),this.stop_button_view=this.button_bar_view.addChild(new BetaJS.Views.VideoRecorder.Views.BarButtonView({parent:this.view(),label:"<i class='bjs-icon-stop'></i>",disabled:!0})),this.stop_button_view.on("click",function(){this.stop_player()},this),this.events().on("error",function(a){this.view().trigger("server_error",a),this.button_bar_view.hide(),this.timer_view.hide(),this.next("ErrorState",{error_message:a})},this),this.events().on("player_state",function(b){"none"==b&&(this.play_button_view.set("disabled",!1),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a)),"connecting"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a)),"active"==b&&(this.play_button_view.set("disabled",!1),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a)),"playing"==b&&(this.view().trigger("player_play"),this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!1),this.stop_button_view.set("disabled",!1),this.rerecord_button_view.setVisibility(!1)),"paused"==b&&(this.play_button_view.set("disabled",!1),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!1),this.rerecord_button_view.setVisibility(a)),"finished"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!1),this.rerecord_button_view.setVisibility(a),this.api().player_stop(),this.view().trigger("stop")),"error"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a))},this),this.api().player_activate(),this.view().get("immediate_playback")){var b=this;setTimeout(function(){b.api().player_play()},500)}},stop_player:function(){this.api().player_stop()},_timer_state:function(){var a=this.api().player_state();if(this.__disconnectedPlayer=a.video_position>=0?!1:!0,!this.__disconnectedPlayer){var b=this.view().get("player_remaining_time")?a.video_remaining:a.video_position;this.timer_view.set("time",Math.floor(1e3*b))}},_end_state:function(){this.api().player_deactivate()}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoUploader",{_notifications:{activate:"__attach",deactivate:"__detach"},constructor:function(a){a=a||{},a.el_classes="video-recorder-outer",a.positioning="none",this._inherited(BetaJS.Views.VideoUploader,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a),this._setOptionProperty(a,"type","recorder"),this._setOptionProperty(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this.set("can_record",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>=0)},["allow_rerecord","rerecord_limit"])),this.set("can_rerecord",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>0)},["allow_rerecord","rerecord_limit"])),this._setOptionProperty(a,"allow_custom_file",!BetaJS.Browser.Info.isMobile()),this._setOptionProperty(a,"player_config",{}),this._setOptionProperty(a,"initial_image",""),this._setOptionProperty(a,"recorder_config",{}),this._setOptionProperty(a,"resumable",!1),this._setOptionProperty(a,"recorder_width",640),this._setOptionProperty(a,"recorder_height",480),this._setOptionProperty(a,"immediate_playback",!1),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"external_record",!1),this._setOptionProperty(a,"allowed_extensions",null),this.on("client_error",function(a){this.trigger("error","client",a)},this),this.on("server_error",function(a){this.trigger("error","server",a)},this),this.__state_host=this._auto_destroy(new BetaJS.States.Host),this.__state_host.view=this,this.__state_host.on("start",function(a){this.trigger("state",a),this.trigger("state:"+a)},this)},user_error:function(a){this.state().next("ErrorState",{error_message:a})},state:function(){return this.__state_host.state()},recorderWidth:function(){return this.get("recorder_width")},recorderHeight:function(){return this.get("recorder_height")},__attach:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.recorderHeight()/this.recorderWidth())),this.set("recorder_width",a),this.set("recorder_height",b)}}this.$el.css("width",this.recorderWidth()+"px"),this.$el.css("height",this.recorderHeight()+"px"),this.__state_host.initialize("BetaJS.Views.VideoUploader.States.Init"),this.__timer=new BetaJS.Timers.Timer({delay:100,fire:this.__timer,context:this})},__detach:function(){this.__timer.destroy(),this.__state_host.finalize()},__timer:function(){this.trigger("timer")},play:function(){this.player_view&&this.player_view.play&&this.player_view.play()},stop:function(){this.player_view&&this.player_view.stop&&this.player_view.stop()}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.Views.ButtonView.extend("BetaJS.Views.VideoUploader.Views.UploadButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["video-uploader-upload-button-view-template"]},constructor:function(a){a.el_classes="btn-primary",a.button_container_element="div",this._inherited(BetaJS.Views.VideoUploader.Views.UploadButtonView,"constructor",a),this._setOptionProperty(a,"allow_custom_file",!0),this._setOptionProperty(a,"form_fallback",!1),this.set("accept_string",this.computed(function(){var a=BetaJS.Browser.Info.isMobile(),b=this.get("allow_custom_file");return a===b?"accept='video/*,video/mp4'":a?"accept='video/*,video/mp4;capture=camcorder' capture":""},["allow_custom_file"]))},_events:function(){return this._inherited(BetaJS.Views.VideoUploader.Views.UploadButtonView,"_events").concat([{"change input":"__select_file"}])},__select_file:function(){this.trigger("select",this.$("input"))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoUploader.Views.ProgressView",{_dynamics:{"default":BetaJS.Templates.Cached["video-uploader-progress-template"]},constructor:function(a){a=a||{},a.el_classes=["video-uploader-progress"],this._inherited(BetaJS.Views.VideoUploader.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"progress",0),this._setOptionProperty(a,"label","Label"),this.set("progress_label",this.computed(function(){return this.get("label")+": "+Math.floor(100*this.get("progress"))+"%"},["progress","label"]))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoUploader.Views.ErrorView",{_templates:{"default":BetaJS.Templates.Cached["video-uploader-error-template"]},_events:{"click .call-to-action":"__call_to_action"},constructor:function(a){a=a||{},a.el_classes=["video-uploader-error"],this._inherited(BetaJS.Views.VideoUploader.Views.ErrorView,"constructor",a),this._setOptionProperty(a,"error",""),this._setOptionProperty(a,"call_to_action","")},__call_to_action:function(){this.trigger("call_to_action")}}),BetaJS.Views.View.extend("BetaJS.Views.VideoUploader.Views.UploadView",{_dynamics:{"default":BetaJS.Templates.Cached["video-uploader-upload-template"]},_events:{"click [data-selector='record-video']":"__record_video"},constructor:function(a){a=a||{},a.el_classes=["video-uploader-upload"],this._inherited(BetaJS.Views.VideoUploader.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"progress",0),this._setOptionProperty(a,"external_record",!1),this._setOptionProperty(a,"label","Label"),this.set("external_record_label",BetaJS.Locales.get("video_recorder.external_record_label")),this.set("progress_label",this.computed(function(){return this.get("label")+(this.get("progress")?": "+Math.floor(100*this.get("progress"))+"%":"...")},["progress","label"]))},__record_video:function(){this.trigger("record_video")},show_progress:function(){this.$(".inner-container").hide(),this.$(".progress-label").show(),this.$(".progress-spinner").show()}}),BetaJS.States.State.extend("BetaJS.Views.VideoUploader.States.State",{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoUploader.States.State,"constructor",a,b,c),this.__view=a.view,this.__views=[]},_:function(a){return BetaJS.Locales.get("video_recorder."+a)},view:function(){return this.__view},_start_time:function(){return this.__start_time},_elapsed_time:function(){return BetaJS.Time.ago(this.__start_time)},_timer_state:function(){},_start_state:function(){},_end_state:function(){},_timer:function(){this._timer_state()},_start:function(){this.__start_time=BetaJS.Time.now(),this.__view.on("timer",function(){if(this._started&&!this._stopped)try{this._timer()}catch(a){}},this),this._start_state()},_end:function(){this._end_state(),BetaJS.Objs.iter(this.__views,function(a){a.destroy()},this),this.__view.off(null,null,this)},addView:function(a,b){b=b||{},b.parent=this.__view;var c=this.__view.addChild(new a(b));return this.__views.push(c),c}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.Init",{_start_state:function(){"recorder"==this.view().get("type")?this.next("CheckState"):this.next("PlayerState")}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.CheckState",{__device_supported:function(){return BetaJS.Browser.Info.isiOS()&&BetaJS.Browser.Info.iOSversion().major<6?!1:!0},_start_state:function(){return BetaJS.Browser.Info.isiOS()&&8==BetaJS.Browser.Info.iOSversion().major&&!BetaJS.Browser.Info.iOSversion().minor&&!BetaJS.Browser.Info.iOSversion().revision&&BetaJS.Browser.Info.isSafari()?(this.next("ErrorState",{error_message:"<a href='http://blog.fineuploader.com/2014/09/10/ios8-presents-serious-issues-that-prevent-file-uploading/' target='_blank'>Mobile Upload of any media is broken on iOS 8 Safari</a>. Apple is working on this issue. Please upgrade your iOS version if possible or use a different browser like Chrome."}),void 0):(this.__device_supported()?this.next("UploaderState"):this.next("ErrorState",{error_message:this._("device_unsupported")}),void 0)}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.UploaderState",{_start_state:function(){this.__uploader_view=this.addView(BetaJS.Views.VideoUploader.Views.UploadView,{label:this._("uploading_label"),progress:0,external_record:this.view().get("external_record")}),this.__uploader_view.on("record_video",function(){this.view().trigger("external_record")},this),this.upload_button=this.__uploader_view.addChild(new BetaJS.Views.VideoUploader.Views.UploadButtonView({label:BetaJS.Browser.Info.isMobile()?this._(this.view().get("rerecording")?"reselect_file_action_mobile":"select_file_action_mobile"):this._(this.view().get("rerecording")?"reselect_file_action":"select_file_action"),allow_custom_file:this.view().get("allow_custom_file"),el:"[data-selector='upload-video']"}));var a=this;this.upload_button.on("select",function(b){if(this.view().get("allowed_extensions")){var c=b.val().toLowerCase(),d=!1;if(BetaJS.Objs.iter(this.view().get("allowed_extensions"),function(a){BetaJS.Strings.ends_with(c,"."+a.toLowerCase())&&(d=!0)}),!d)return this.next("ErrorState",{error_message:a._("unsupported_video_type").replace("%s",this.view().get("allowed_extensions").join(" / ")),call_to_action:a._("try_again")}),void 0}this.__uploader_view.show_progress(),this.next("BeforeUploadingState",{file:b})},this)}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.BeforeUploadingState",{_persistents:["file"],_start_state:function(){this.__uploader_view=this.addView(BetaJS.Views.VideoUploader.Views.UploadView,{label:this._("uploading_label"),progress:0,external_record:this.view().get("external_record")}),this.__uploader_view.show_progress()}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.UploadingState",{_locals:["file"],_start_state:function(){this.__uploader_view=this.addView(BetaJS.Views.VideoUploader.Views.UploadView,{label:this._("uploading_label"),progress:0,external_record:this.view().get("external_record")}),this.__uploader_view.show_progress(),this.view().set("file_size",null),this.view().trigger("recording_finished");
var a=BetaJS.Browser.Upload.FileUploader.create({url:this.view().get("recorder_config").submit,source:this._file.get(0),serverSupportChunked:this.view().get("resumable"),serverSupportPostMessage:!0,resumable:{withCredentials:!1,assembleUrl:this.view().get("recorder_config").submit,assembleResilience:10,assembleResilienceTimeout:1e3}});a.on("success",function(a){this.view().trigger("recording_uploaded",a),this.next("ProcessingState")},this).on("error",function(){this.view().trigger("server_error",this._("uploading_file_failed")),this.next("ErrorState",{error_message:this._("uploading_file_failed"),call_to_action:this._("try_again")})},this).on("progress",function(a,b){b&&(this.view().set("file_size",b),this.__uploader_view.set("progress",a/b))},this),this.view().trigger("uploading"),a.upload()}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.ProcessingState",{_start_state:function(){this.__processing_view=this.addView(BetaJS.Views.VideoUploader.Views.ProgressView,{label:this._("processing_label"),progress:0}),this.__time=BetaJS.Time.now(),this.__last_check=this.__time},_timer_state:function(){var a=BetaJS.Time.now(),b=1e3;this.view().get("file_size")&&1e3*this.view().get("file_size")>1e3&&(b=this.view().get("file_size")/1e3);var c=(a-this.__time)/b,d=1-1/(1+Math.sqrt(Math.sqrt(c)));this.__processing_view.set("progress",d);var e=this;a-this.__last_check>=1e3&&(this.__last_check=a,BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&(BetaJS.$.support.cors=!0),BetaJS.$.ajax({type:"GET",async:!0,url:this.view().get("recorder_config").state}).success(function(a){e.view().get("rerecord_limit")!==!1&&e.view().set("rerecord_limit",e.view().get("rerecord_limit")-1),e.view().trigger("recording_submitted",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("player_config",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("type","player"),e.next("Init")}).error(function(a){a.status!=BetaJS.Net.HttpHeader.HTTP_STATUS_PRECONDITION_FAILED&&(e.view().trigger("server_error",e._("could_not_process_file")),e.next("ErrorState",{error_message:e._("could_not_process_file"),call_to_action:e._("try_again")}))}))}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.ErrorState",{_locals:["error_message","call_to_action"],_start_state:function(){var a=this.addView(BetaJS.Views.VideoUploader.Views.ErrorView,{error:this._error_message,call_to_action:this._call_to_action});a.on("call_to_action",function(){this.next("UploaderState")},this)}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.PlayerState",{_start_state:function(){var a=this.view().get("player_config");if(this.player_view=this.addView(BetaJS.Views.VideoPlayerView,{sources:a.sources||[],meta:{responsive:this.view().get("responsive"),image:a.image||null,width:this.view().recorderWidth(),height:this.view().recorderHeight(),video_width:a.width||this.view().recorderWidth(),video_height:a.height||this.view().recorderHeight(),fit:"minimize"},el_styles:{left:"0px",top:"0px",position:"absolute"}}),this.view.player_view=this.player_view,this.player_view.on("stop",function(){this.view().trigger("stop")},this),this.player_view.on("error",function(a){this.view().trigger("server_error",a)},this),this.view().get("can_record")){var b=this.addView(BetaJS.Views.ButtonView,{el_classes:["video-recorder"],css:{"default":"btn-default"},children_styles:{top:"10px",right:"10px"},label:this._("rerecord_label")});b.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().trigger("recording_discarded"),this.view().set("type","recorder"),this.view().set("rerecording",!0),this.view().trigger("recording_discarded"),this.next("UploaderState"))},this)}this.view().get("immediate_playback")&&this.player_view.play()}}),BetaJS.Views.SingleContainerView.extend("BetaJS.Views.VideoSubmitter",{constructor:function(a){this._inherited(BetaJS.Views.SingleContainerView,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a||{}),this._setOption(a,"recorder_options",{}),this._setOption(a,"uploader_options",{}),this._setOption(a,"type","recorder"),this._setOption(a,"mode","recorder"),this._setOption(a,"width",640),this._setOption(a,"height",480),this._setOption(a,"responsive",!1),this._setOption(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this._setOption(a,"allow_to_switch",!1),this.__attach()},__attach:function(){"recorder"==this.__mode&&BetaJS.Browser.Info.isMobile()&&(this.__mode="uploader");var a=null;"recorder"==this.__mode?(a=this.setView(new BetaJS.Views.VideoRecorder(BetaJS.Objs.merge(this.__recorder_options,{type:this.__type,allow_rerecord:this.__allow_rerecord,external_upload:this.__allow_to_switch,recorder_width:this.__width,recorder_height:this.__height,responsive:this.__responsive,rerecord_limit:this.binding("rerecord_limit")},{}))),a.on("error",function(a,b){this.trigger("error",a,b)},this),a.on("recording_submitted",function(a){this.trigger("recording_submitted",a)},this),a.on("recording_discarded",function(){this.trigger("recording_discarded")},this),a.on("external_upload",function(){this.__mode="uploader",this.__attach()},this)):(a=this.setView(new BetaJS.Views.VideoUploader(BetaJS.Objs.merge(this.__uploader_options,{type:this.__type,allow_rerecord:this.__allow_rerecord,external_record:this.__allow_to_switch&&!BetaJS.Browser.Info.isMobile(),recorder_width:this.__width,recorder_height:this.__height,responsive:this.__responsive,rerecord_limit:this.binding("rerecord_limit")},{}))),a.on("error",function(a,b){this.trigger("error",a,b)},this),a.on("recording_submitted",function(a){this.trigger("recording_submitted",a)},this),a.on("recording_discarded",function(){this.trigger("recording_discarded")},this),a.on("external_record",function(){this.__mode="recorder",this.__attach()},this))}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRTCRecorder",{_notifications:{activate:"__attach",deactivate:"__detach"},constructor:function(a){a=a||{},a.el_classes="video-recorder-outer",a.el_styles={overflow:"hidden"},a.positioning="none",this._inherited(BetaJS.Views.VideoRTCRecorder,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a),this._setOptionProperty(a,"recording_countdown",0),this._setOptionProperty(a,"type","recorder"),this._setOptionProperty(a,"player_remaining_time",!1),this._setOptionProperty(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this.set("can_record",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>=0)},["allow_rerecord","rerecord_limit"])),this.set("can_rerecord",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>0)},["allow_rerecord","rerecord_limit"])),this._setOptionProperty(a,"time_limit",null),this._setOptionProperty(a,"device_test",!0),this._setOptionProperty(a,"first_screen",!0),this._setOptionProperty(a,"face_outline",!1),this._setOptionProperty(a,"resumable",!1),this._setOptionProperty(a,"recorder_config",{}),this._setOptionProperty(a,"player_config",{}),this._setOptionProperty(a,"recorder_width",640),this._setOptionProperty(a,"recorder_height",480),this._setOptionProperty(a,"camera_width",640),this._setOptionProperty(a,"camera_height",480),this._setOptionProperty(a,"immediate_playback",!1),this._setOptionProperty(a,"disable_timer",!1),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"external_upload",!1),this._setOptionProperty(a,"margin_percentage",.3),this._setOptionProperty(a,"frame_percentage",.9),this.on("client_error",function(a){this.trigger("error","client",a)},this),this.on("server_error",function(a){this.trigger("error","server",a)},this),this.__face_outline_view=this.addChild(new BetaJS.Views.View({parent:this,visible:!1,el_classes:"video-recorder-face-position"})),this.__video_view=this.addChild(new BetaJS.Views.View({parent:this,visible:!1,template:"<video style='width:100%; height:100%'></video>"})),this.__state_host=this._auto_destroy(new BetaJS.States.Host),this.__state_host.view=this,this.__state_host.on("start",function(a){this.trigger("state",a),this.trigger("state:"+a)},this)},state:function(){return this.__state_host.state()},user_error:function(a){this.state().next("UserError",{error_msg:a})},_render:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.get("recorder_height")/this.get("recorder_width"))),this.set("recorder_width",a),this.set("recorder_height",b)}}this._inherited(BetaJS.Views.VideoRTCRecorder,"_render")},__attach:function(){this.__time_started=BetaJS.Time.now(),this.$el.css("width",this.get("recorder_width")+"px"),this.$el.css("height",this.get("recorder_height")+"px"),this.__state_host.initialize("BetaJS.Views.VideoRTCRecorder.States.Init"),this.__timer=new BetaJS.Timers.Timer({delay:25,fire:this.__timer,context:this})},__detach:function(){this.__timer.destroy(),this.__state_host.finalize()},__timer:function(){this.trigger("timer")},recorderWidth:function(){return this.get("recorder_width")},recorderHeight:function(){return this.get("recorder_height")},stop:function(){this.player_view&&this.player_view.stop&&this.player_view.stop()},play:function(){this.player_view&&this.player_view.play&&this.player_view.play()},stopRecord:function(){this.state().stop_recording&&this.state().stop_recording()}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.State",{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoRTCRecorder.States.State,"constructor",a,b,c),this.__view=a.view,this.__views=[]},_:function(a){return BetaJS.Locales.get("video_recorder."+a)},view:function(){return this.__view},events:function(){return this.__view.events()},_start_time:function(){return this.__start_time},_elapsed_time:function(){return BetaJS.Time.ago(this.__start_time)},_timer_state:function(){},_start_state:function(){},_end_state:function(){},_timer:function(){this._timer_state()},_start:function(){this.__start_time=BetaJS.Time.now(),this.__view.on("timer",function(){if(this._started&&!this._stopped)try{this._timer()}catch(a){}},this),this._start_state()},_end:function(){this._end_state(),BetaJS.Objs.iter(this.__views,function(a){a.destroy()},this),this.__view.off(null,null,this)},addView:function(a,b){b=b||{},b.parent=this.__view;var c=this.__view.addChild(new a(b));return this.__views.push(c),c}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.Init",{_locals:["info_message"],_start_state:function(){if(this.view().__screen_height=window.innerHeight,!this.view().get("first_screen")||"player"==this.view().get("type"))return this.next("Attached"),void 0;var a=this.addView(BetaJS.Views.VideoRecorder.Views.InitialView,{parent:this.view(),info_message:this._info_message});a.on("record",function(){this.next("Attached")},this),a.on("upload",function(){this.view().trigger("external_upload")},this),a.on("tutorial",function(){this.view().__tutorial_view.show()},this)}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.ErrorState",{_locals:["error_message","call_to_action"],_start_state:function(){this.addView(BetaJS.Views.VideoRecorder.Views.ErrorView,{error:this._error_message,call_to_action:this._call_to_action})}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.Attached",{_start_state:function(){"recorder"==this.view().get("type")?this.next("RecorderDeviceCheck"):this.next("PlayerReady")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderDeviceCheck",{_start_state:function(){BetaJS.Media.WebRTC.RecorderWrapper.anySupport()?(this.view().__video_view.show(),this.view().recorderWrapper=BetaJS.Media.WebRTC.RecorderWrapper.create({video:this.view().__video_view.$("video").get(0),recordResolution:{width:this.view().get("camera_width"),height:this.view().get("camera_height")}}),this.view().recorderWrapper.bindMedia().success(function(){this.next("RecorderDeviceReady")},this).error(function(){this.view().set("first_screen",!0),this.next("Init",{info_message:this._("browser_permission")})},this)):this.next("RecorderDeviceFailed")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderDeviceFailed",{_start_state:function(){this.next("ErrorState",{error_message:this._("no_camera")}),this.view().trigger("client_error",this._("no_camera"))}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.UserError",{_locals:["error_msg"],_start_state:function(){this.next("ErrorState",{error_message:this._error_msg})}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderDeviceReady",{_start_state:function(){var a=this;this.view().get("face_outline")&&this.view().__face_outline_view.show(),this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.record_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("record_label"),el_classes:["video-recorder"],css:{"default":"btn-default"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.__message_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-message-under",visible:!1}),this.__message=this.addView(BetaJS.Views.LabelView,{el_classes:"video-recorder-message",visible:!1}),this.__set_message=function(a){this.__message.set("label",a),this.__message_under.setVisibility(!!a),this.__message.setVisibility(!!a)},this.record_button_view.$el.on("mouseenter",function(){var b=a.view().get("rerecord_limit");b===!1?a.__set_message(a._("rerecord_affirmation")):1==b?a.__set_message(a._("rerecord_single_affirmation")):2==b?a.__set_message(a._("rerecord_double_affirmation")):a.__set_message(a._("rerecord_multiple_affirmation").replace("%d",b))}),this.record_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.record_button_view.on("click",function(){this.record()},this)},record:function(){this.next("RecorderBeforeRecording")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderBeforeRecording",{_start_state:function(){return this.view().get("recording_countdown")?(this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("abort_record"),el_classes:["video-recorder"],css:{"default":"btn-default on"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:this._("recording_starts_in")+" "+this.view().get("recording_countdown"),el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.stop_button_view.on("click",function(){this.next("RecorderDeviceReady")},this),void 0):(this.next("RecorderRecording"),void 0)},_timer_state:function(){var a=1e3*this.view().get("recording_countdown")-this._elapsed_time();a>0&&this.view().trigger("countdown",a),this.countdown_view.set("label",a>=0?this._("recording_starts_in")+" "+Math.ceil(a/1e3):this._("recording_get_ready")),0>=a&&this.next("RecorderRecording")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderRecording",{_start_state:function(){this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("recording_get_ready"),el_classes:["video-recorder"],css:{"default":"btn-default on"},children_styles:{position:"inherit"},el_styles:{"float":"right",visibility:"hidden"}})),this.__time=null,this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:this._("recording_get_ready"),el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.timer_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.TimerView({parent:this.view(),max_time:this.view().get("time_limit")?1e3*this.view().get("time_limit"):null,time:0,visible:!1,el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"},el_classes:"video-recorder-font"})),this.blinking_record_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.BlinkingRecordView({parent:this.view(),visible:!1,el_styles:{"float":"left",padding:"20px"}})),this.stop_button_view.on("click",function(){this.stop_recording()},this),this.stop_button_view.set("disabled",!0),this.view().recorderWrapper.on("data",function(a,b){this.view().videoBlob=a,this.view().audioBlob=b,this.view().recorderWrapper.unbindMedia(),this.view().recorderWrapper.destroy(),this.view().trigger("recording_finished"),this.next("RecorderUploading")},this),this.view().recorderWrapper.startRecord(),this.stop_button_view.$el.css("visibility",""),this.stop_button_view.set("label",this._("recording_start")),this.stop_button_view.$el.children().css("background-color","green"),this.countdown_view.hide(),this.blinking_record_view.show(),this.view().get("disable_timer")||this.timer_view.show(),this.__time=BetaJS.Time.now()},_timer_state:function(){if(this.__time){var a=BetaJS.Time.now()-this.__time;this.timer_view.set("time",a),this.view().trigger("elapsed",a),this.view().get("time_limit")&&a>=1e3*this.view().get("time_limit")&&this.stop_recording(),a>1500&&(this.stop_button_view.$el.children().css("background-color",""),this.stop_button_view.set("disabled",!1),this.stop_button_view.set("label",this._("stop_recording")))}},stop_recording:function(){var a=BetaJS.Time.now()-this.__time;this.view()._duration=a,this.view().__face_outline_view.hide(),this.view().recorderWrapper.stopRecord()}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderUploading",{_start_state:function(){this.view().__video_view.hide(),this.__processing_view=this.addView(BetaJS.Views.VideoRecorder.Views.ProgressView,{label:this._("uploading_label"),progress:0});var a=new BetaJS.Browser.Upload.MultiUploader;a.addUploader(BetaJS.Browser.Upload.FileUploader.create({url:this.view().get("recorder_config").submit,source:this.view().videoBlob,serverSupportChunked:this.view().get("resumable"),serverSupportPostMessage:!1,resumable:{withCredentials:!1,assembleUrl:this.view().get("recorder_config").submit,assembleResilience:10,assembleResilienceTimeout:1e3}})),this.view().audioBlob&&a.addUploader(BetaJS.Browser.Upload.FileUploader.create({url:this.view().get("recorder_config").submit_audio,source:this.view().audioBlob,serverSupportChunked:this.view().get("resumable"),serverSupportPostMessage:!1,resumable:{withCredentials:!1,assembleUrl:this.view().get("recorder_config").submit_audio,assembleResilience:10,assembleResilienceTimeout:1e3}})),a.on("success",function(a){this.view().trigger("recording_uploaded",a),this.next("ProcessingState")},this).on("error",function(){this.view().trigger("server_error","Error"),this.next("ErrorState",{error_message:"Error"})},this).on("progress",function(a,b){b&&(this.view().set("file_size",b),this.__processing_view.set("progress",a/b))},this),this.view().trigger("uploading"),a.upload()}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.ProcessingState",{_start_state:function(){this.__processing_view=this.addView(BetaJS.Views.VideoUploader.Views.ProgressView,{label:this._("processing_label"),progress:0}),this.__time=BetaJS.Time.now(),this.__last_check=this.__time},_timer_state:function(){var a=BetaJS.Time.now(),b=1e3;this.view().get("file_size")&&1e3*this.view().get("file_size")>1e3&&(b=this.view().get("file_size")/1e3);var c=(a-this.__time)/b,d=1-1/(1+Math.sqrt(Math.sqrt(c)));this.__processing_view.set("progress",d);var e=this;a-this.__last_check>=1e3&&(this.__last_check=a,BetaJS.$.ajax({type:"GET",async:!0,url:this.view().get("recorder_config").state}).success(function(a){e.view().get("rerecord_limit")!==!1&&e.view().set("rerecord_limit",e.view().get("rerecord_limit")-1),e.view().trigger("recording_submitted",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("player_config",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("type","player"),e.next("Init")}).error(function(a){a.status!=BetaJS.Net.HttpHeader.HTTP_STATUS_PRECONDITION_FAILED&&(e.view().trigger("server_error",e._("could_not_process_file")),e.next("ErrorState",{error_message:e._("could_not_process_file"),call_to_action:e._("try_again")}))}))}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.PlayerReady",{_start_state:function(){var a=this.view().get("player_config");if(this.player_view=this.addView(BetaJS.Views.VideoPlayerView,{sources:a.sources||[],meta:{responsive:this.view().get("responsive"),image:a.image||null,width:this.view().recorderWidth(),height:this.view().recorderHeight(),video_width:a.width||this.view().recorderWidth(),video_height:a.height||this.view().recorderHeight(),fit:"minimize"},el_styles:{left:"0px",top:"0px",position:"absolute"}}),this.view.player_view=this.player_view,this.player_view.on("stop",function(){this.view().trigger("stop")},this),this.player_view.on("error",function(a){this.view().trigger("server_error",a)},this),this.view().get("can_record")){var b=this.addView(BetaJS.Views.ButtonView,{el_classes:["video-recorder"],css:{"default":"btn-default"},children_styles:{top:"10px",right:"10px"},label:this._("rerecord_label")});b.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().trigger("recording_discarded"),this.view().set("type","recorder"),this.view().set("rerecording",!0),this.view().trigger("recording_discarded"),this.next("RecorderDeviceCheck"))},this)}this.view().get("immediate_playback")&&this.player_view.play()}});var ZiggeoApi=ZiggeoApi||function(){var a="assets.ziggeo.com";try{BetaJS.Browser.Loader.findScript("assets-cdn.ziggeo.com")&&(a="assets-cdn.ziggeo.com")}catch(b){}return{token:"",Styles:{play_button_class:"ziggeo-play-button",play_button_vertical_align:"center",play_button_horizontal_align:"center"},Options:{global_error_message:null,enable_webserver_playback:!0,enable_wowza_playback:!0,enable_wowza_recording:!0,recording_type:"mp4",image_type:"jpg",vcodec:"h264",session_cookie_prefix:"i07af2jp98rvoctt26y5egy3",runtime:{}},Config:{jwplayer6_key:"zB2MBHKdnnQ5gr7Y/W+isBwTNs1NmamS6WsU3cnVdoI=",revision:"1437514521",webrtc:!1,resumable:!1,rtmp80:!1,cdn:!1},Uris:{get:function(a){var b=this[a];BetaJS.Types.is_function(b)&&(b=b());var c=!1;try{c=-1!=location.protocol.indexOf("https")}catch(d){}var e=-1!=a.indexOf("rtmp"),f=(e?"rtmp":"http")+(c?"s":"");if(e&&(f="rtmp"),e&&ZiggeoApi.Config.rtmp80){var g=b.indexOf("/");b=b.substring(0,g)+":80/"+b.substring(g+1)}return f+"://"+b},jwplayer6_src:a+"/vendors/jwplayer/jwplayer.js",jwplayer6_swfsrc:a+"/vendors/jwplayer/jwplayer.flash.swf",jwplayer5_src:a+"/vendors/jwplayer/jwplayer-old.js",jwplayer5_swfsrc:a+"/vendors/jwplayer/player.swf",recorder_swfsrc:a+"/js/betajs-video-recorder.swf",assets_url:a,embed_api_url:"embed.ziggeo.com",embed_playback_url:function(){return ZiggeoApi.Config.cdn?"embed-cdn.ziggeo.com":"embed.ziggeo.com"},wowza_http_play_url:"wowza.ziggeo.com/vod/_definst_",wowza_rtmp_play_url:"wowza.ziggeo.com/vod/_definst_",wowza_rtmp_record_url:"wowza.ziggeo.com/record/_definst_"},Params:{width:{type:"int",def:640},height:{type:"int",def:480},recording_width:{type:"int",def:640},recording_height:{type:"int",def:480},responsive:{type:"bool",def:!1},popup_width:{type:"int",def:640},popup_height:{type:"int",def:480},popup:{type:"bool",def:!1},video:{type:"string",def:null},face_outline:{type:"bool",def:!1},stream:{type:"string",def:null},modes:{type:"array",def:null},tags:{type:"array",def:null},effect_profile:{type:"array",def:null},data:{type:"json",def:null},perms:{type:"array",def:null},disable_first_screen:{type:"bool",def:!1},disable_device_test:{type:"bool",def:!1},disable_timer:{type:"bool",def:!1},disable_snapshots:{type:"bool",def:!1},hide_rerecord_on_snapshots:{type:"bool",def:!1},auto_crop:{type:"bool",def:!1},key:{type:"string",def:null},limit:{type:"int",def:null},countdown:{type:"int",def:3},input_bind:{type:"string",def:null},form_accept:{type:"string",def:null},id:{type:"string",def:null},immediate_playback:{type:"bool",def:!1},server_auth:{type:"string",def:null},client_auth:{type:"string",def:null},rerecordings:{type:"int",def:null},expiration_days:{type:"int",def:null},video_profile:{type:"string",def:null},meta_profile:{type:"string",def:null},stream_width:{type:"int",def:null},stream_height:{type:"int",def:null},title:{type:"string",def:null},description:{type:"string",def:null},allowed_extensions:{type:"array",def:null},default_image_selector:{type:"float",def:null},apitoken:{type:"string",def:null},enforce_duration:{type:"bool",def:!1}}}}.call(this);"undefined"!=typeof module&&"exports"in module&&("undefined"!=typeof BetaJS&&module.exports==BetaJS?BetaJS.ZiggeoApi=ZiggeoApi:module.exports=ZiggeoApi);try{BetaJS.$(document).ready(function(){if(ZiggeoApi.language&&(BetaJS.Locales.language=ZiggeoApi.language),ZiggeoApi.token){BetaJS.Browser.Loader.loadScript(ZiggeoApi.Uris.get("embed_api_url")+"/v1/applications/"+ZiggeoApi.token+"/support/session");try{BetaJS.$.ajax({url:ZiggeoApi.Uris.get("embed_api_url")+"/v1/applications/"+ZiggeoApi.token+"/support/runtime"}).fail(function(a){a&&a.status&&(503==a.status?(ZiggeoApi.Options.global_error_message="We are maintaining our service. Videos will be back soon.",ZiggeoApi.Embed._update_runtime()):404==a.status&&(ZiggeoApi.Options.global_error_message="We cannot recognize your api key. Please make sure to specify it in your website's header.",ZiggeoApi.Embed._update_runtime()))}).done(function(a){try{"string"==typeof a&&(a=JSON.parse(a)),ZiggeoApi.Options.runtime=a,a.testing_application&&BetaJS.Browser.Loader.loadStyles(ZiggeoApi.Uris.get("assets_url")+"/css/ziggeo-testing.css")}catch(b){}})}catch(a){}}})}catch(e){}ZiggeoApi.Connect={_ajax:BetaJS.Server?new BetaJS.Server.Net.HttpAjax:new BetaJS.Browser.JQueryAjax,_get:function(a,b,c,d,e,f){return this._request("GET",a,b,c,d,e,!1,f)},_getJSON:function(a,b,c,d,e,f){return this._requestJSON("GET",a,b,c,d,e,f)},_post:function(a,b,c,d,e,f){return this._request("POST",a,b,c,d,e,!1,f)},_postJSON:function(a,b,c,d,e,f){return this._requestJSON("POST",a,b,c,d,e,f)},_destroy:function(a,b,c,d,e,f){return this._request("DELETE",a,b,c,d,e,!1,f)},_destroyJSON:function(a,b,c,d,e,f){return this._requestJSON("DELETE",a,b,c,d,e,f)},_uri:function(a,b){return ZiggeoApi.Uris.get("embed_api_url")+this._path(a,b)},_path:function(a,b){return b=b||ZiggeoApi.token,"/v1/applications/"+b+a},_requestJSON:function(a,b,c,d,e,f,g){return this._request(a,b,c,d,e,f,!0,g)},__cookieName:function(){return ZiggeoApi.Options.session_cookie_prefix+document.location.hostname.replace(/\./g,"_")+ZiggeoApi.token},_request:function(a,b,c,d,e,f,g,h){var i={};d&&BetaJS.Objs.extend(i,d);try{var j=ZiggeoApi.Connect.__cookieName();i[j]=BetaJS.Browser.Cookies.get(j)}catch(k){}b=BetaJS.Net.Uri.appendUriParams(b,i);var l={method:a,data:f,uri:this._uri(b,h)};return BetaJS.Browser&&BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&(l.decodeType="json"),c?this._ajax.asyncCall(l).success(function(a){if(c&&c.success){if(g)try{var b=JSON.parse(a);a=b}catch(d){}e.push(a),c.success.apply(this,e)}},c.context||this).error(function(a){c&&c.failure&&(e.push(a),c.failure.apply(this,e))},c.context||this):this._ajax.syncCall(l)}},ZiggeoApi.Streams=BetaJS.Objs.extend(ZiggeoApi.Streams||{},{destroy:function(a,b,c,d,e){return ZiggeoApi.Connect._destroy("/videos/"+a+"/streams/"+b,c,d,[a,b],null,e)},create:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams",c,d,[a,b],b,e)},accept:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/accept",c,d,[a,b],null,e)},_image_attach:function(a,b,c,d,e,f){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/imageattach",d,e,[a,b,c],c,f)},_audio_attach:function(a,b,c,d,e,f){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/audioattach",d,e,[a,b,c],c,f)},_recorder_submit:function(a,b,c,d,e,f){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/recordersubmit",d,e,[a,b,c],c,f)},_uploader_state:function(a,b,c,d,e){return ZiggeoApi.Connect._getJSON("/videos/"+a+"/streams/"+b+"/uploaderstate",c,d,[a,b],null,e)}}),ZiggeoApi.Streams=BetaJS.Objs.extend(ZiggeoApi.Streams||{},{sources:function(a,b,c){c=c||ZiggeoApi.token;var d="/applications/"+c+"/videos/"+a+"/streams/"+b+"/video.mp4";return[ZiggeoApi.Uris.get("embed_playback_url")+"/v1"+d,ZiggeoApi.Uris.get("wowza_http_play_url")+d+"/playlist.m3u8"]},image:function(a,b,c){return c=c||ZiggeoApi.token,ZiggeoApi.Uris.get("embed_playback_url")+"/v1/applications/"+c+"/videos/"+a+"/streams/"+b+"/image"},source:function(a,b,c){var d=this.sources(a,b,c);return d[1]}}),ZiggeoApi.Videos=BetaJS.Objs.extend(ZiggeoApi.Videos||{},{index:function(a,b,c,d){return ZiggeoApi.Connect._getJSON("/videos/",b,c,[a],a,d)},destroy:function(a,b,c,d){return ZiggeoApi.Connect._destroy("/videos/"+a,b,c,[a],null,d)},create:function(a,b,c,d){return ZiggeoApi.Connect._postJSON("/videos",b,c,[a],a,d)},update:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a,c,d,[a,b],b,e)},_playback:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/playback",c,d,[a,b],b,e)},get:function(a,b,c,d){return ZiggeoApi.Connect._getJSON("/videos/"+a,b,c,[a],null,d)}}),ZiggeoApi.Videos=BetaJS.Objs.extend(ZiggeoApi.Videos||{},{sources:function(a,b){b=b||ZiggeoApi.token;var c="/applications/"+b+"/videos/"+a+"/video.mp4",d=[];return ZiggeoApi.Options.enable_webserver_playback&&d.push(ZiggeoApi.Uris.get("embed_playback_url")+"/v1"+c),ZiggeoApi.Options.enable_wowza_playback&&d.push(ZiggeoApi.Uris.get("wowza_http_play_url")+c+"/playlist.m3u8"),d},image:function(a,b){return b=b||ZiggeoApi.token,ZiggeoApi.Uris.get("embed_playback_url")+"/v1/applications/"+b+"/videos/"+a+"/image"},source:function(a,b){var c=this.sources(a,b);return c[1]}}),ZiggeoApi.Events=new BetaJS.Events.Events,ZiggeoApi.Support={message:function(a,b){return jQuery.ajax({type:"POST",async:!1,crossDomain:!0,dataType:"json",url:"//"+ZiggeoApi.Uris.embed_api_url+"/v1/applications/"+ZiggeoApi.token+"/support/message?subject="+encodeURIComponent(a),data:b})}},BetaJS.Properties.Properties.extend("ZiggeoApi.Views.ViewData",{constructor:function(a,b){this._inherited(ZiggeoApi.Views.ViewData,"constructor"),options={};for(var c in ZiggeoApi.Params)options[c]=c in a?BetaJS.Views.View.parseType(a[c],ZiggeoApi.Params[c].type):ZiggeoApi.Params[c].def?ZiggeoApi.Params[c].def:null;b=b||{},this.set("apitoken",options.apitoken?options.apitoken:ZiggeoApi.token),this.set("popup",b.popup?!0:!1),this.set("intermediate_token",a.intermediate_token),this.set("embed_popup",options.popup?!0:!1),this.set("disable_first_screen",options.disable_first_screen?!0:!1),this.set("disable_device_test",options.disable_device_test?!0:!1),this.set("disable_timer",options.disable_timer?!0:!1),this.set("disable_snapshots",options.disable_snapshots?!0:!1),this.set("hide_rerecord_on_snapshots",options.hide_rerecord_on_snapshots?!0:!1),this.set("face_outline",options.face_outline?!0:!1),this.set("enforce_duration",options.enforce_duration?!0:!1),this.set("video_profile",options.video_profile),this.set("meta_profile",options.meta_profile),this.set("auto_crop",options.auto_crop?!0:!1),this.set("title",options.title),this.set("description",options.description),this.set("error",b.error?b.error:null),this.set("width",options.width),this.set("height",options.height),this.set("recording_width",options.recording_width),this.set("recording_height",options.recording_height),this.set("stream_width",options.stream_width),this.set("stream_height",options.stream_height),this.set("immediate_playback",options.immediate_playback?!0:!1),this.set("responsive",options.responsive?!0:!1),this.set("expiration_days",options.expiration_days?options.expiration_days:null),this.set("countdown","countdown"in options?Math.max(0,options.countdown):3),this.set("popup_width",options.popup_width),this.set("popup_height",options.popup_height),this.set("input_bind",options.input_bind),this.set("form_accept",options.form_accept),this.set("server_auth",options.server_auth),this.set("client_auth",options.client_auth),this.set("rerecordings",options.rerecordings?options.rerecordings:!1),this.set("auth_params",this.computed(function(){var a="domain="+location.hostname;
return this.get("client_auth")?a+="&client_auth="+this.get("client_auth"):this.get("server_auth")?a+="&server_auth="+this.get("server_auth"):this.get("intermediate_token")&&(a+="&intermediate_token="+this.get("intermediate_token")),a},["server_auth","client_auth","intermediate_token"])),this.set("auth",this.computed(function(){return this.get("client_auth")?{client_auth:this.get("client_auth"),domain:location.hostname}:this.get("server_auth")?{server_auth:this.get("server_auth"),domain:location.hostname}:this.get("intermediate_token")?{intermediate_token:this.get("intermediate_token"),domain:location.hostname}:{}},["server_auth","client_auth","intermediate_token"])),this.set("id",options.id),this.set("key",options.key?options.key:null),this.set("tags",options.tags?options.tags:[]),this.set("effect_profile",options.effect_profile?options.effect_profile:[]),this.set("allowed_extensions",options.allowed_extensions?options.allowed_extensions:null),this.set("default_image_selector",options.default_image_selector?options.default_image_selector:null),this.set("data",options.data?BetaJS.Types.is_string(options.data)?JSON.parse(options.data):options.data:{}),options.perms=options.perms||{},this.set("force_overwrite",BetaJS.Objs.contains_value(options.perms,"forceoverwrite")),this.set("allow_upload",BetaJS.Objs.contains_value(options.perms,"allowupload")),this.set("allow_record",!BetaJS.Objs.contains_value(options.perms,"forbidrecord")&&!BetaJS.Browser.Info.isMobile()&&ZiggeoApi.Options.enable_wowza_recording),this.set("allow_switch",!BetaJS.Objs.contains_value(options.perms,"forbidswitch")&&this.get("allow_upload")&&this.get("allow_record")),this.set("allow_rerecord",!BetaJS.Objs.contains_value(options.perms,"forbidrerecord")),this.set("submit_mode",this.get("allow_record")?"recorder":"uploader"),this.set("video",{token:options.video}),this.set("stream",{token:options.stream}),this.set("time_limit",options.limit);var d=.85*BetaJS.$(window).width()/this.get("popup_width"),e=.85*BetaJS.$(window).height()/this.get("popup_height"),f=Math.min(d,e);if(1>f&&(this.set("popup_width",Math.floor(this.get("popup_width")*f)),this.set("popup_height",Math.floor(this.get("popup_height")*f))),this.set("player_params",this.computed(function(){return(this.get("stream_width")?"stream_width="+this.get("stream_width"):"")+"&"+(this.get("stream_height")?"stream_height="+this.get("stream_height"):"")+"&"+(this.get("effect_profile")?"effect_profile="+this.get("effect_profile").toString():"")},["stream_width","stream_height"])),this.set("actual_width",this.computed(function(){return this.get("popup")?this.get("popup_width"):this.get("width")},["width","popup_width","popup"])),this.set("actual_height",this.computed(function(){return this.get("popup")?this.get("popup_height"):this.get("height")},["height","popup_height","popup"])),this.set("image",this.computed(function(){var a=null;return this.get("video").token&&(a=this.get("stream").token?ZiggeoApi.Streams.image(this.get("video").token,this.get("stream").token,this.get("apitoken"))+"?"+this.get("auth_params")+"&"+this.get("player_params"):ZiggeoApi.Videos.image(this.get("video").token,this.get("apitoken"))+"?"+this.get("auth_params")+"&"+this.get("player_params")),a},["video","stream","auth_params","player_params"])),this.set("sources",this.computed(function(){var a=null;if(this.get("video").token){a=this.get("stream").token?ZiggeoApi.Streams.sources(this.get("video").token,this.get("stream").token,this.get("apitoken")):ZiggeoApi.Videos.sources(this.get("video").token,this.get("apitoken"));for(var b=0;b<a.length;++b)a[b]=a[b]+"?"+this.get("auth_params")+"&"+this.get("player_params")}return a},["video","stream","auth_params","player_params"])),this.set("mode","error"),options.modes=options.modes||[],!this.get("error"))if(0===options.modes.length)this.set("mode",this.get("video").token?"player":"recorder");else if(1==options.modes.length)this.set("mode",options.modes[0]);else if(BetaJS.Objs.contains_value(options.modes,"rerecorder")&&BetaJS.Objs.contains_value(options.modes,"player"))this.set("error","You cannot combine player and rerecorder");else{var g=BetaJS.Objs.contains_value(options.modes,"rerecorder")?"rerecorder":"player";try{var h=ZiggeoApi.Videos.get(this.get("video").token,null,this.get("auth"),this.get("apitoken"));this.set("video",h),this.set("mode",g)}catch(i){this.set("key",BetaJS.Strings.strip_start(this.get("video").token,"_")),this.set("video",{token:null}),this.set("mode","recorder")}}this.get("video").token&&!this.get("key")&&BetaJS.Strings.starts_with(this.get("video").token,"_")&&this.set("key",BetaJS.Strings.strip_start(this.get("video").token,"_")),this.set("createparams",this.computed(function(){return{max_duration:this.get("time_limit"),tags:this.get("tags").join(","),effect_profile:this.get("effect_profile").join(","),data:JSON.stringify(this.get("data")),key:this.get("key"),expiration_days:this.get("expiration_days"),auto_crop:this.get("auto_crop"),force_overwrite:this.get("force_overwrite"),default_image_selector:this.get("default_image_selector"),video_profile:this.get("video_profile"),meta_profile:this.get("meta_profile"),title:this.get("title"),description:this.get("description"),enforce_duration:this.get("enforce_duration")}},["tags","key","title","description","data","time_limit","enforce_duration"])),this.set("uriparams",this.computed(function(){return BetaJS.Net.Uri.encodeUriParams(this.get("createparams"))},["createparams"]))}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["ziggeo-view-error-template"]="  <div class='view-player-not-ready-outer' style='width: {%= width %}px; height: {%= height %}px'>   <div class='view-player-not-ready-inner' style='font-size:{%= Math.floor((width + height) / 40) %}px; padding-left:{%= Math.floor(width / 10) %}px; padding-right:{%= Math.floor(width / 10) %}px'>    {%= error %}   </div>  </div> ",BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoErrorView",{_templates:{"default":BetaJS.Templates.Cached["ziggeo-view-error-template"]},constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoErrorView,"constructor",a),this.view_data=a.view_data,this._setOptionProperty(a,"width",this.view_data.get("actual_width")),this._setOptionProperty(a,"height",this.view_data.get("actual_height")),this.set("error",this.view_data.get("error")?this.view_data.get("error"):"An unknown error has occurred")}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoPlayerView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoPlayerView,"constructor",a),this.view_data=a.view_data,this.view=this.view_data.get("embed_popup")?this.addChild(new BetaJS.Views.ImageOverlayVideoPlayerView({el:"",sources:this.view_data.get("sources"),meta:{video_width:this.view_data.get("popup_width"),video_height:this.view_data.get("popup_height"),image:this.view_data.get("image"),fit:"minimize"},image_meta:{width:this.view_data.get("width"),height:this.view_data.get("height"),image:this.view_data.get("image"),fit:"maximize",responsive:this.view_data.get("responsive")}})):this.addChild(new BetaJS.Views.VideoPlayerView({el:"",sources:this.view_data.get("sources"),meta:{video_width:this.view_data.get("actual_width"),video_height:this.view_data.get("actual_height"),image:this.view_data.get("image"),fit:"maximize",responsive:this.view_data.get("responsive")}})),this.view.on("image-error",function(){var a=this;ZiggeoApi.Videos.get(this.view_data.get("video").token,{success:function(){a.view.image_view.showStatus("The video is not ready. It is processing or under moderation.")},failure:function(b,c){a.view.image_view.showStatus(c.status_text())}},this.view_data.get("auth"),this.view_data.get("apitoken"))},this),this.view.on("play",function(){ZiggeoApi.Config.cdn&&ZiggeoApi.Videos._playback(this.view_data.get("video").token,{}),ZiggeoApi.Events.triggerAsync("play",this.view_data.getAll())},this).on("pause",function(){ZiggeoApi.Events.triggerAsync("pause",this.view_data.getAll())},this).on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this).on("error",function(a){this.view_data.set("error",a),ZiggeoApi.Events.triggerAsync("error_player",this.view_data.getAll()),BetaJS.Views.VideoPlayerView.on_error(this.view,this.view_data.getAll())},this).on("ready_to_play",function(){this.view_data.__ready_to_play_triggered||ZiggeoApi.Events.triggerAsync("ready_to_play",this.view_data.getAll()),this.view_data.__ready_to_play_triggered=!0},this)},play:function(){this.view.play()},stop:function(){this.view.stop()},stopRecord:function(){}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoRecorderView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoRecorderView,"constructor",a),this.view_data=a.view_data,this.set("submittable","rerecorder"==this.view_data.get("mode"));var b=null;"rerecorder"==this.view_data.get("mode")&&(b="applications/"+this.view_data.get("apitoken")+"/videos/"+this.view_data.get("video").token,this.view_data.get("stream").token&&(b+="/streams/"+this.view_data.get("stream").token),b+="/video.mp4?"+this.view_data.get("auth_params")),this.view=this.addChild(new BetaJS.Views.VideoRecorder({recorder_swf:ZiggeoApi.Uris.get("recorder_swfsrc")+"?v="+ZiggeoApi.Config.revision,el:"",play_stream:{file_type:ZiggeoApi.Options.recording_type,server:ZiggeoApi.Uris.get("wowza_rtmp_play_url"),vcodec:ZiggeoApi.Options.vcodec,cookie:ZiggeoApi.Connect.__cookieName(),file:b},record_stream:{file_type:ZiggeoApi.Options.recording_type,server:ZiggeoApi.Uris.get("wowza_rtmp_record_url"),vcodec:ZiggeoApi.Options.vcodec,acodec:"speex",cookie:ZiggeoApi.Connect.__cookieName()},type:"rerecorder"==this.view_data.get("mode")?"player":"recorder",first_screen:!this.view_data.get("disable_first_screen"),disable_timer:this.view_data.get("disable_timer"),disable_snapshots:this.view_data.get("disable_snapshots"),face_outline:this.view_data.get("face_outline"),device_test:!this.view_data.get("disable_device_test"),allow_rerecord:this.view_data.get("allow_rerecord"),immediate_playback:this.view_data.get("immediate_playback"),rerecord_limit:this.view_data.binding("rerecordings"),recorder_width:this.view_data.get("actual_width"),recorder_height:this.view_data.get("actual_height"),camera_width:this.view_data.get("recording_width"),camera_height:this.view_data.get("recording_height"),rerecord_on_snapshots:!this.view_data.get("hide_rerecord_on_snapshots"),responsive:this.view_data.get("responsive"),snapshots_type:ZiggeoApi.Options.image_type,snapshots_quality:70,external_upload:this.view_data.get("allow_switch"),time_limit:this.view_data.get("time_limit"),recording_countdown:this.view_data.get("countdown"),initial_image:"rerecorder"==this.view_data.get("mode")?this.view_data.get("image"):null})),this.view.on("state:RecorderBeforeRecording",function(){var a=this;this.view.state().suspend();var b=function(){var b="applications/"+a.view_data.get("apitoken"),c="/videos/"+a.view_data.get("video").token+"/streams/"+a.view_data.get("stream").token;a.view.set("snapshots_post",ZiggeoApi.Connect._uri(c+"/imageattach")+"?"+a.view_data.get("auth_params")),a.view.get("play_stream").file=b+c+"/video.mp4?"+a.view_data.get("auth_params"),a.view.get("record_stream").file=b+c+"/video.mp4?"+a.view_data.get("auth_params"),a.view.api().config_set("snapshots_post",a.view.get("snapshots_post")),a.view.api().config_set("play_stream_file",a.view.get("play_stream").file),a.view.api().config_set("record_stream_file",a.view.get("record_stream").file),a.__update_form_input(),a.view.state().resume()},c=function(b){a.view.user_error(BetaJS.Types.is_string(b.data())&&b.data()?b.data():"Could not create video."),a.view.trigger("error","user_error",b.json()),a.view.state().resume()};this.view_data.get("video").token?ZiggeoApi.Streams.create(this.view_data.get("video").token,{flash_recording:!0},{success:function(c,d,e){a.view_data.set("stream",e),b(e)},failure:function(a,b,d){c(d)}},this.view_data.get("auth"),this.view_data.get("apitoken")):ZiggeoApi.Videos.create(BetaJS.Objs.extend({flash_recording:!0},this.view_data.get("createparams")),{success:function(c,d){a.view_data.set("video",d.video),a.view_data.set("stream",d.stream),b(d)},failure:function(a,b){c(b)}},this.view_data.get("auth"),this.view_data.get("apitoken"))},this),this.view.on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this),this.view.on("state:RecorderDeviceReady",function(){ZiggeoApi.Events.triggerAsync("ready_to_record",this.view_data.getAll())},this),this.view.on("state:RecorderRecording",function(){ZiggeoApi.Events.triggerAsync("recording",this.view_data.getAll())},this),this.view.on("state:RecorderUploading",function(){ZiggeoApi.Events.triggerAsync("uploading",this.view_data.getAll())},this),this.view.on("recording_submitted",function(a){this.view_data.get("video").duration=a.duration/1e3,this.view_data.get("stream").duration=this.view_data.get("video").duration,this.view.state().suspend();var b=10,c=function(){ZiggeoApi.Streams._recorder_submit(this.view_data.get("video").token,this.view_data.get("stream").token,this.view_data.get("uriparams"),{success:function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("uploaded",this.view_data.getAll()),ZiggeoApi.Events.triggerAsync("submitted",this.view_data.getAll()),this.view.state().resume()},failure:function(a,d){0>=b?(this.view.user_error(BetaJS.Types.is_string(d.data())?d.data():"Could not submit video"),this.view.trigger("error","user_error",d.json())):(b--,c.apply(this))},context:this},this.view_data.get("auth"))};c.apply(this)},this),this.view.on("recording_discarded",function(){this.set("submittable",!1),ZiggeoApi.Events.triggerAsync("discarded",this.view_data.getAll())},this),this.view.on("recording_finished",function(){ZiggeoApi.Events.triggerAsync("finished",this.view_data.getAll())},this),this.view.on("external_upload",function(){this.set("submittable",!1),this.trigger("external_upload")},this),this.view.on("error",function(a,b){this.view_data.set("error",b),ZiggeoApi.Events.triggerAsync("error_recorder",this.view_data.getAll()),BetaJS.Views.VideoSubmitter.on_error(this.view,this.view_data.getAll())},this),this.view.on("countdown",function(a){ZiggeoApi.Events.triggerAsync("countdown",a,this.view_data.getAll())},this),this.view.on("elapsed",function(a){ZiggeoApi.Events.triggerAsync("elapsed",a,this.view_data.getAll())},this),this.view.on("player_play",function(){ZiggeoApi.Events.triggerAsync("play",this.view_data.getAll())},this)},record:function(){this.view.state().record()},_notifications:{activate:"__activate_view",deactivate:"__deactivate_view"},__activate_view:function(){if(this.__update_form_input(),this.view_data.get("form_accept")){var a=this;BetaJS.$(this.view_data.get("form_accept")).on("submit."+this.cid(),function(){return a.get("submittable")})}},__deactivate_view:function(){if(this.view_data.get("form_accept")){BetaJS.$(this.view_data.get("form_accept")).off("submit."+this.cid())}},__update_form_input:function(){if(this.view_data.get("input_bind")&&this.view_data.get("video")&&this.view_data.get("video").token){var a=BetaJS.$("[name='"+this.view_data.get("input_bind")+"']");a.length>0?a.val(this.view_data.get("video").token):this.$el.parent().append("<input type='hidden' id='"+this.view_data.get("input_bind")+"' name='"+this.view_data.get("input_bind")+"' value='"+this.view_data.get("video").token+"' />")}},stop:function(){this.view.stop()},play:function(){this.view.play()},stopRecord:function(){this.view.stopRecord()}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoRTCRecorderView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoRTCRecorderView,"constructor",a),this.view_data=a.view_data;this.view_data.get("auth_params");this.set("submittable","rerecorder"==this.view_data.get("mode")),this.view=this.addChild(new BetaJS.Views.VideoRTCRecorder({el:"",type:"rerecorder"==this.view_data.get("mode")?"player":"recorder",el_styles:{"background-color":"#333333"},allow_custom_file:this.view_data.get("allow_upload"),allow_rerecord:this.view_data.get("allow_rerecord"),rerecord_limit:this.view_data.binding("rerecordings"),external_upload:this.view_data.get("allow_switch"),recorder_width:this.view_data.get("actual_width"),recorder_height:this.view_data.get("actual_height"),camera_width:this.view_data.get("recording_width"),camera_height:this.view_data.get("recording_height"),immediate_playback:this.view_data.get("immediate_playback"),responsive:this.view_data.get("responsive"),resumable:!!ZiggeoApi.Config.resumablex,disable_timer:this.view_data.get("disable_timer"),time_limit:this.view_data.get("time_limit"),recording_countdown:this.view_data.get("countdown"),player_config:{image:this.view_data.get("image"),sources:this.view_data.get("sources")}})),this.view.on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this),this.view.on("state:RecorderDeviceReady",function(){ZiggeoApi.Events.triggerAsync("ready_to_record",this.view_data.getAll())},this);var b=this;this.view.on("state:RecorderBeforeRecording",function(){this.view.state().suspend();var a=function(){var a=("applications/"+b.view_data.get("apitoken"),"/videos/"+b.view_data.get("video").token+"/streams/"+b.view_data.get("stream").token),c=b.view.get("recorder_config");c.submit=ZiggeoApi.Connect._uri(a+"/videoattach")+"?"+b.view_data.get("auth_params"),c.submit_audio=ZiggeoApi.Connect._uri(a+"/audioattach")+"?"+b.view_data.get("auth_params"),c.state=ZiggeoApi.Connect._uri(a+"/uploaderstate")+"?"+b.view_data.get("auth_params"),b.__update_form_input(),b.view.state().resume()},c=function(a){b.view.user_error(BetaJS.Types.is_string(a.data())&&a.data()?a.data():"Could not create video."),b.view.trigger("error","user_error",a.json()),b.view.state().resume()};this.view_data.get("video").token?ZiggeoApi.Streams.create(this.view_data.get("video").token,{},{success:function(c,d,e){b.view_data.set("stream",e),a(e)},failure:function(a,b,d){c(d)}},this.view_data.get("auth"),this.view_data.get("apitoken")):ZiggeoApi.Videos.create(BetaJS.Objs.extend({create_stream:!0},this.view_data.get("createparams")),{success:function(c,d){b.view_data.set("video",d.video),b.view_data.set("stream",d.stream),a(d)},failure:function(a,b){c(b)}},this.view_data.get("auth"),this.view_data.get("apitoken"))},this),this.view.on("recording_uploaded",function(){ZiggeoApi.Events.triggerAsync("uploaded",this.view_data.getAll()),this.view.state().suspend();var a=10,b=function(){ZiggeoApi.Streams._recorder_submit(this.view_data.get("video").token,this.view_data.get("stream").token,this.view_data.get("uriparams"),{success:function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("uploaded",this.view_data.getAll()),this.view.state().resume()},failure:function(c,d){0>=a?(this.view.user_error(BetaJS.Types.is_string(d.data())?d.data():"Could not submit video"),this.view.trigger("error","user_error",d.json())):(a--,b.apply(this))},context:this},this.view_data.get("auth"))};b.apply(this)},this),this.view.on("state:RecorderRecording",function(){ZiggeoApi.Events.triggerAsync("recording",this.view_data.getAll())},this),this.view.on("state:RecorderUploading",function(){ZiggeoApi.Events.triggerAsync("uploading",this.view_data.getAll())},this),this.view.on("recording_submitted",function(){ZiggeoApi.Events.triggerAsync("submitted",this.view_data.getAll())},this),this.view.on("recording_discarded",function(){this.set("submittable",!1),ZiggeoApi.Events.triggerAsync("discarded",this.view_data.getAll())},this),this.view.on("recording_finished",function(){ZiggeoApi.Events.triggerAsync("finished",this.view_data.getAll())},this),this.view.on("external_upload",function(){this.set("submittable",!1),this.trigger("external_upload")},this),this.view.on("error",function(a,b){this.view_data.set("error",b),ZiggeoApi.Events.triggerAsync("error_recorder",this.view_data.getAll()),BetaJS.Views.VideoSubmitter.on_error(this.view,this.view_data.getAll())},this)},_notifications:{activate:"__activate_view",deactivate:"__deactivate_view"},__activate_view:function(){if(this.__update_form_input(),this.view_data.get("form_accept")){var a=this;BetaJS.$(this.view_data.get("form_accept")).on("submit."+this.cid(),function(){return a.get("submittable")})}},__deactivate_view:function(){if(this.view_data.get("form_accept")){BetaJS.$(this.view_data.get("form_accept")).off("submit."+this.cid())}},__update_form_input:function(){if(this.view_data.get("input_bind")&&this.view_data.get("video")&&this.view_data.get("video").token){var a=BetaJS.$("[name='"+this.view_data.get("input_bind")+"']");a.length>0?a.val(this.view_data.get("video").token):this.$el.parent().append("<input type='hidden' id='"+this.view_data.get("input_bind")+"' name='"+this.view_data.get("input_bind")+"' value='"+this.view_data.get("video").token+"' />")}},record:function(){this.view.state().record()},play:function(){this.view.play()},stop:function(){this.view.stop()},stopRecord:function(){this.view.stopRecord()}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoUploaderView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoUploaderView,"constructor",a),this.view_data=a.view_data;this.view_data.get("auth_params");this.set("submittable","rerecorder"==this.view_data.get("mode")),this.view=this.addChild(new BetaJS.Views.VideoUploader({el:"",type:"rerecorder"==this.view_data.get("mode")?"player":"recorder",el_styles:{"background-color":"#333333"},allow_custom_file:this.view_data.get("allow_upload"),allow_rerecord:this.view_data.get("allow_rerecord"),rerecord_limit:this.view_data.binding("rerecordings"),external_record:this.view_data.get("allow_switch"),recorder_width:this.view_data.get("actual_width"),recorder_height:this.view_data.get("actual_height"),immediate_playback:this.view_data.get("immediate_playback"),allowed_extensions:BetaJS.Browser.Info.isMobile()?null:this.view_data.get("allowed_extensions"),responsive:this.view_data.get("responsive"),resumable:!!ZiggeoApi.Config.resumablex,player_config:{image:this.view_data.get("image"),sources:this.view_data.get("sources")}})),this.view.on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this),this.view.on("state:UploaderState",function(){ZiggeoApi.Events.triggerAsync("ready_to_record",this.view_data.getAll())},this);var b=this;this.view.on("state:BeforeUploadingState",function(){var a=function(){var a=("applications/"+b.view_data.get("apitoken"),"/videos/"+b.view_data.get("video").token+"/streams/"+b.view_data.get("stream").token),c=b.view.get("recorder_config");c.submit=ZiggeoApi.Connect._uri(a+"/videoattach")+"?"+b.view_data.get("auth_params"),c.state=ZiggeoApi.Connect._uri(a+"/uploaderstate")+"?"+b.view_data.get("auth_params"),b.__update_form_input(),b.view.state().next("UploadingState")},c=function(a){b.view.user_error(BetaJS.Types.is_string(a.data())&&a.data()?a.data():"Could not create video."),b.view.trigger("error","user_error",a.json())};this.view_data.get("video").token?ZiggeoApi.Streams.create(this.view_data.get("video").token,{},{success:function(c,d,e){b.view_data.set("stream",e),a(e)},failure:function(a,b,d){c(d)}},this.view_data.get("auth"),this.view_data.get("apitoken")):ZiggeoApi.Videos.create(BetaJS.Objs.extend({create_stream:!0},this.view_data.get("createparams")),{success:function(c,d){b.view_data.set("video",d.video),b.view_data.set("stream",d.stream),a(d)},failure:function(a,b){c(b)}},this.view_data.get("auth"),this.view_data.get("apitoken"))},this),this.view.on("recording_uploaded",function(){ZiggeoApi.Events.triggerAsync("uploaded",this.view_data.getAll()),this.view.state().suspend();var a=10,b=function(){ZiggeoApi.Streams._recorder_submit(this.view_data.get("video").token,this.view_data.get("stream").token,this.view_data.get("uriparams"),{success:function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("uploaded",this.view_data.getAll()),this.view.state().resume()},failure:function(c,d){0>=a?(this.view.user_error(BetaJS.Types.is_string(d.data())?d.data():"Could not submit video"),this.view.trigger("error","user_error",d.json())):(a--,b.apply(this))},context:this},this.view_data.get("auth"))};b.apply(this)},this),this.view.on("uploading",function(){ZiggeoApi.Events.triggerAsync("uploading",this.view_data.getAll())},this),this.view.on("recording_submitted",function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("submitted",this.view_data.getAll())},this),this.view.on("recording_discarded",function(){this.set("submittable",!1),ZiggeoApi.Events.triggerAsync("discarded",this.view_data.getAll())},this),this.view.on("external_record",function(){this.set("submittable",!1),this.trigger("external_record")},this),this.view.on("recording_finished",function(){ZiggeoApi.Events.triggerAsync("finished",this.view_data.getAll())},this),this.view.on("error",function(a,b){this.view_data.set("error",b),ZiggeoApi.Events.triggerAsync("error_recorder",this.view_data.getAll()),BetaJS.Views.VideoSubmitter.on_error(this.view,this.view_data.getAll())},this)},_notifications:{activate:"__activate_view",deactivate:"__deactivate_view"},__activate_view:function(){if(this.__update_form_input(),this.view_data.get("form_accept")){var a=this;BetaJS.$(this.view_data.get("form_accept")).on("submit."+this.cid(),function(){return a.get("submittable")})}},__deactivate_view:function(){if(this.view_data.get("form_accept")){BetaJS.$(this.view_data.get("form_accept")).off("submit."+this.cid())}},__update_form_input:function(){if(this.view_data.get("input_bind")&&this.view_data.get("video")&&this.view_data.get("video").token){var a=BetaJS.$("[name='"+this.view_data.get("input_bind")+"']");a.length>0?a.val(this.view_data.get("video").token):this.$el.parent().append("<input type='hidden' id='"+this.view_data.get("input_bind")+"' name='"+this.view_data.get("input_bind")+"' value='"+this.view_data.get("video").token+"' />")}},play:function(){this.view.play()},stop:function(){this.view.stop()},stopRecord:function(){}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoView",{_notifications:{preactivate:"__preactivate_view"},constructor:function(a){a=a||{},this.original_options=a,this.view_data=new ZiggeoApi.Views.ViewData(a,a.params),this.view_data.get("responsive")||(a.el_styles={width:this.view_data.get("width"),height:this.view_data.get("height")}),this._inherited(ZiggeoApi.Views.ZiggeoView,"constructor",a),this.view_data.get("id")&&(ZiggeoApi.Embed.__ids[this.view_data.get("id")]=this),ZiggeoApi.Embed.__views[this.cid()]=this,this.__attach()},destroy:function(){delete ZiggeoApi.Embed.__views[this.cid()],this.view_data.get("id")&&ZiggeoApi.Embed.__ids[this.view_data.get("id")]==this&&delete ZiggeoApi.Embed.__ids[this.view_data.get("id")],this._inherited(ZiggeoApi.Views.ZiggeoView,"destroy")},__preactivate_view:function(){if(this.view_data.get("responsive")){var a=parseInt(this.$el.parent().parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().parent().css("height"),10);b||(b=Math.floor(a*this.view_data.get("height")/this.view_data.get("width"))),this.$el.parent().css("width",a+"px"),this.$el.parent().css("height",b+"px"),this.$el.parent().css("display","inline-block")}}},__attach:function(){this.view&&this.view.destroy();var a=ZiggeoApi.Views.ZiggeoErrorView;return ZiggeoApi.Options.global_error_message?(this.view_data.set("error",ZiggeoApi.Options.global_error_message),this.view=this.addChild(new a({el:"",view_data:this.view_data})),void 0):("player"==this.view_data.get("mode")?a=ZiggeoApi.Views.ZiggeoPlayerView:("recorder"==this.view_data.get("mode")||"rerecorder"==this.view_data.get("mode"))&&(a="recorder"==this.view_data.get("submit_mode")?ZiggeoApi.Views.ZiggeoRecorderView:ZiggeoApi.Views.ZiggeoUploaderView),a==ZiggeoApi.Views.ZiggeoRecorderView&&ZiggeoApi.Config.webrtc&&BetaJS.Media.WebRTC.RecorderWrapper.anySupport()&&(a=ZiggeoApi.Views.ZiggeoRTCRecorderView),this.view=this.addChild(new a({el:"",view_data:this.view_data})),this.view.on("external_upload external_record",function(){this.view_data.set("submit_mode","recorder"==this.view_data.get("submit_mode")?"uploader":"recorder"),this.__attach()},this),void 0)},play:function(){this.view.play()},record:function(){this.view.record()},stop:function(){this.view.stop()},stopRecord:function(){this.view.stopRecord()},hidePopup:function(){var a=this.getParent();a&&"unfocus"in a&&a.unfocus()},reset:function(){this.view_data=new ZiggeoApi.Views.ViewData(this.original_options,this.original_options.params),this.__attach()},hide_popup:function(){this.hidePopup()}}),ZiggeoApi.Embed={__ids:{},__views:{},popup:function(a,b){var c=new ZiggeoApi.Views.ZiggeoView(BetaJS.Objs.extend(a||{},{params:BetaJS.Objs.extend(b||{},{popup:!0})}));return new BetaJS.Views.FullscreenOverlayView({overlay_inner:c,destroy_on_unfocus:!0}).activate().show(),c},embed:function(a,b,c){return new ZiggeoApi.Views.ZiggeoView(BetaJS.Objs.extend(b||{},{el:a,params:BetaJS.Objs.extend(c||{},{popup:!1})})).activate()},get:function(a){return this.__ids[a]},_update_runtime:function(){for(var a in this.__views)this.__views[a].__attach()}},BetaJS.Views.ActiveDom.registerViewAlias("ziggeo",ZiggeoApi.Views.ZiggeoView),BetaJS.Views.ActiveDom.registerPrefixAlias("ziggeo"),BetaJS.Views.ActiveDom.activate(),BetaJS.Views.VideoPlayerView.Players.JWPlayer6.setup({src:ZiggeoApi.Uris.get("jwplayer6_src"),swfsrc:ZiggeoApi.Uris.get("jwplayer6_swfsrc"),key:ZiggeoApi.Config.jwplayer6_key}),BetaJS.Views.VideoPlayerView.Players.JWPlayer5.setup({src:ZiggeoApi.Uris.get("jwplayer5_src"),swfsrc:ZiggeoApi.Uris.get("jwplayer5_swfsrc")}),BetaJS.Views.VideoPlayerView.setup({rules:BetaJS.Views.VideoPlayerView.Players.JWPlayer5.Rules.oldiOSRules.concat(BetaJS.Views.VideoPlayerView.Players.JWPlayer6.Rules.defaultRules)}),BetaJS.Views.VideoPlayerImageView.defaultPlayButton=function(){return{play_button:BetaJS.Views.LabelView,play_button_options:function(){return{label:"<i class='bjs-icon-play'></i>",el_classes:"view-player-play-label "+ZiggeoApi.Styles.play_button_class}},play_button_vertical_align:ZiggeoApi.Styles.play_button_vertical_align,play_button_horizontal_align:ZiggeoApi.Styles.play_button_horizontal_align}},BetaJS.Views.VideoPlayerView.on_error=function(a,b){var c={message:b.error,location:document.location+"",browser:JSON.stringify(BetaJS.Browser.Info.getNavigator()),flash:BetaJS.Browser.Info.flash().installed()?BetaJS.Browser.Info.flash().version():!1,uri:player.player().source()?player.player().source().uri:!1,player:player.player().rule()?player.player().rule().player().playername():!1,sources:player.player().raw_sources,data:b};console.log(c)},BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&BetaJS.Browser.Loader.inlineStyles(".ziggeo-play-button { background-image: none; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ZiggeoApi.Uris.get("assets_url")+"/img/button_play_hover.png',sizingMethod='scale'); }"),BetaJS.Views.VideoUploader.setup({allow_custom_file:!0}),BetaJS.Views.VideoSubmitter.setup({allow_rerecord:!0,allow_to_switch:!1,mode:"recorder"}),BetaJS.Views.VideoRecorder.setup({disable_swf_cache:!1,recording_countdown:5,allow_rerecord:!0,snapshots:4,flip_video:!0,player_remaining_time:!0,camera_width:640,camera_height:480}),BetaJS.Views.VideoSubmitter.on_error=function(a,b){var c={message:b.error,location:document.location+"",browser:JSON.stringify(BetaJS.Browser.Info.getNavigator()),flash:BetaJS.Browser.Info.flash().installed()?BetaJS.Browser.Info.flash().version():!1,view_data:b};console.log(c)};